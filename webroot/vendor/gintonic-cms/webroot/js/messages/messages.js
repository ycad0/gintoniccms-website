define(["jquery","jqueryvalidate","messages/bootstrap-tokenfield.min"],function(e){var e=require("jquery"),t=require("jqueryvalidate"),n=require("messages/bootstrap-tokenfield.min");e(document).ready(function(){function t(t){t&&typeof messageDivHeight!="undefined"?e(".chat-msg-inner").scrollTop(messageDivHeight+100):typeof e(".chat-msg-inner div.chat-message:last").offset()!="undefined"&&(messageDivHeight=e(".chat-msg-inner div.chat-message:last").offset().top,e(".chat-msg-inner").scrollTop(messageDivHeight))}function n(){e(".delete-message").on("click",function(t){t.preventDefault();var n=e(this);confirm("Do you want to delete this message ?")&&e.ajax({url:n.attr("href"),dataType:"json",success:function(e){typeof e.status!="undefined"&&e.status==="success"&&(n.parent().addClass("deleted-message-color"),n.parent().html('This message has been removed.&nbsp;&nbsp;&nbsp;<i class="fa fa-trash-o"></i>'))}})})}jQuery("#MessageComposeForm").validate({errorClass:"text-danger",rules:{body:{required:!0}},messages:{body:{required:"Please enter something."}},errorPlacement:function(e,t){e.insertAfter(t.parent("div"))}}),t(),e(".messageForm").submit(function(r){r.preventDefault(),e.ajax({url:e(this).attr("action"),dataType:"json",type:"post",data:e(this).serialize(),success:function(r){r.status&&(e(".chat-msg-inner").append(r.content),t(!0),e(".delete-message").unbind("click"),n())}})}),n();var r=jQuery(".user-tokens").data("value");e(".tokenfield").tokenInput("/gintonic_c_m_s/messages/setUserCommaSepList",{theme:"facebook",prePopulate:r,preventDuplicates:!0,hintText:"Enter existing user email address",noResultsText:"No user found.",searchingText:"Searching..."}),e(".change-message-status").on("click",function(t){t.preventDefault();var n=e(this),r=e(this).data("status");alert(r),params=0,r=="read"&&(params=1),e.ajax({url:e(this).attr("href")+"/"+params,dataType:"json",success:function(e){typeof e.status!="undefined"&&e.status==="success"&&(r==="read"?(n.parent().removeClass("text-info"),n.text("unread"),n.data("status","unread")):(n.parent().addClass("text-info"),n.text("read"),n.data("status","read")))}})})})});