/*! bootstrap3-wysihtml5-bower 2014-09-26 */

var wysihtml5,Base,Handlebars;Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&!function(){var e=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return e.get.call(this)},set:function(t){return e.set.call(this,t)}})}(),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),wysihtml5={version:"0.4.15",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"﻿",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46},function(e,t){"function"==typeof define&&define.amd?define(e):t.rangy=e()}(function(){function e(e,t){var n=typeof e[t];return n==x||n==S&&!!e[t]||"unknown"==n}function t(e,t){return typeof e[t]==S&&!!e[t]}function n(e,t){return typeof e[t]!=T}function r(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function i(e){return e&&A(e,L)&&M(e,k)}function s(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function o(n){t(window,"console")&&e(window.console,"log")&&window.console.log(n)}function u(e,t){t?window.alert(e):o(e)}function a(e){D.initialized=!0,D.supported=!1,u("Rangy is not supported on this page in your browser. Reason: "+e,D.config.alertOnFail)}function f(e){u("Rangy warning: "+e,D.config.alertOnWarn)}function l(e){return e.message||e.description||e+""}function c(){var t,n,r,u,f,c,h,d,v;if(!D.initialized){if(n=!1,r=!1,e(document,"createRange")&&(t=document.createRange(),A(t,C)&&M(t,N)&&(n=!0)),u=s(document),!u||"body"!=u.nodeName.toLowerCase())return a("No body element found"),void 0;if(u&&e(u,"createTextRange")&&(t=u.createTextRange(),i(t)&&(r=!0)),!n&&!r)return a("Neither Range nor TextRange are available"),void 0;D.initialized=!0,D.features={implementsDomRange:n,implementsTextRange:r};for(h in _)(f=_[h])instanceof p&&f.init(f,D);for(d=0,v=y.length;v>d;++d)try{y[d](D)}catch(m){c="Rangy init listener threw an exception. Continuing. Detail: "+l(m),o(c)}}}function h(e){e=e||window,c();for(var t=0,n=b.length;n>t;++t)b[t](e)}function p(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function d(e,t,n,r){var i=new p(t,n,function(e){if(!e.initialized){e.initialized=!0;try{r(D,e),e.supported=!0}catch(n){var i="Module '"+t+"' failed to load: "+l(n);o(i)}}});_[t]=i}function v(){}function m(){}var g,y,b,w,E,S="object",x="function",T="undefined",N=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],C=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],k=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],L=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],A=r(e),O=r(t),M=r(n),_={},D={version:"1.3alpha.20140804",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:A,areHostObjects:O,areHostProperties:M,isTextRange:i,getBody:s},features:{},modules:_,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==T?!0:rangyAutoInitialize}};return D.fail=a,D.warn=f,{}.hasOwnProperty?D.util.extend=function(e,t,n){var r,i,s;for(s in t)t.hasOwnProperty(s)&&(r=e[s],i=t[s],n&&null!==r&&"object"==typeof r&&null!==i&&"object"==typeof i&&D.util.extend(r,i,!0),e[s]=i);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e}:a("hasOwnProperty not supported"),function(){var e,t,n=document.createElement("div");n.appendChild(document.createElement("span")),e=[].slice;try{1==e.call(n.childNodes,0)[0].nodeType&&(t=function(t){return e.call(t,0)})}catch(r){}t||(t=function(e){var t,n,r=[];for(t=0,n=e.length;n>t;++t)r[t]=e[t];return r}),D.util.toArray=t}(),e(document,"addEventListener")?g=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?g=function(e,t,n){e.attachEvent("on"+t,n)}:a("Document does not have required addEventListener or attachEvent method"),D.util.addListener=g,y=[],D.init=c,D.addInitListener=function(e){D.initialized?e(D):y.push(e)},b=[],D.addShimListener=function(e){b.push(e)},D.shim=D.createMissingNativeApi=h,p.prototype={init:function(){var e,t,n,r,i=this.dependencies||[];for(e=0,t=i.length;t>e;++e){if(r=i[e],n=_[r],!(n&&n instanceof p))throw Error("required module '"+r+"' not found");if(n.init(),!n.supported)throw Error("required module '"+r+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){D.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){D.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return Error("Error in Rangy "+this.name+" module: "+e)}},D.createModule=function(e){var t,n,r;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]),r=d(!1,e,n,t),D.initialized&&r.init()},D.createCoreModule=function(e,t,n){d(!0,e,t,n)},D.RangePrototype=v,D.rangePrototype=new v,D.selectionPrototype=new m,w=!1,E=function(){w||(w=!0,!D.initialized&&D.config.autoInitialize&&c())},typeof window==T?(a("No window found"),void 0):typeof document==T?(a("No document found"),void 0):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",E,!1),g(window,"load",E),D.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==P||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function r(e){var t=e.parentNode;return 1==t.nodeType?t:null}function i(e){for(var t=0;e=e.previousSibling;)++t;return t}function s(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function o(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(M(r,n))return n;return null}function u(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function a(e,t){return u(e,t,!0)}function f(e,t,n){for(var r,i=n?e:e.parentNode;i;){if(r=i.parentNode,r===t)return i;i=r}return null}function l(e){var t=e.nodeType;return 3==t||4==t||8==t}function c(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function h(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function p(e,t,n){var r,s,o=e.cloneNode(!1);if(o.deleteData(0,t),e.deleteData(t,e.length-t),h(o,e),n)for(r=0;s=n[r++];)s.node==e&&s.offset>t?(s.node=o,s.offset-=t):s.node==e.parentNode&&s.offset>i(e)&&++s.offset;return o}function d(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=P)return e.ownerDocument;if(typeof e.document!=P)return e.document;if(e.parentNode)return d(e.parentNode);throw t.createError("getDocument: no document found for node")}function v(e){var n=d(e);if(typeof n.defaultView!=P)return n.defaultView;if(typeof n.parentWindow!=P)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=P)return e.contentDocument;if(typeof e.contentWindow!=P)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function g(e){if(typeof e.contentWindow!=P)return e.contentWindow;if(typeof e.contentDocument!=P)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function y(e){return e&&H.isHostMethod(e,"setTimeout")&&H.isHostObject(e,"document")}function b(e,t,n){var r;if(e?H.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):d(e):y(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r}function w(e){for(var t;t=e.parentNode;)e=t;return e}function E(e,n,r,s){var u,a,l,c,h;if(e==r)return n===s?0:s>n?-1:1;if(u=f(r,e,!0))return n<=i(u)?-1:1;if(u=f(e,r,!0))return i(u)<s?-1:1;if(a=o(e,r),!a)throw Error("comparePoints error: nodes have no common ancestor");if(l=e===a?a:f(e,a,!0),c=r===a?a:f(r,a,!0),l===c)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(h=a.firstChild;h;){if(h===l)return-1;if(h===c)return 1;h=h.nextSibling}}function S(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function x(e){if(!e)return"[No node]";if(_&&S(e))return"[Broken node]";if(l(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+i(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function T(e){for(var t,n=d(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function N(e){this.root=e,this._next=e}function C(e){return new N(e)}function k(e,t){this.node=e,this.offset=t}function L(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var A,O,M,_,D,P="undefined",H=e.util;H.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),H.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method"),A=document.createElement("div"),H.areHostMethods(A,["insertBefore","appendChild","cloneNode"]||!H.areHostObjects(A,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),H.isHostProperty(A,"innerHTML")||t.fail("Element is missing innerHTML property"),O=document.createTextNode("test"),H.areHostMethods(O,["splitText","deleteData","insertData","appendData","cloneNode"]||!H.areHostObjects(A,["previousSibling","nextSibling","childNodes","parentNode"])||!H.areHostProperties(O,["data"]))||t.fail("Incomplete Text Node implementation"),M=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},_=!1,function(){var t,n=document.createElement("b");n.innerHTML="1",t=n.firstChild,n.innerHTML="<br>",_=S(t),e.features.crashyTextNodes=_}(),typeof window.getComputedStyle!=P?D=function(e,t){return v(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=P?D=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),N.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild,e)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},k.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},L.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},L.prototype.toString=function(){return this.message},e.dom={arrayContains:M,isHtmlNamespace:n,parentElement:r,getNodeIndex:i,getNodeLength:s,getCommonAncestor:o,isAncestorOf:u,isOrIsAncestorOf:a,getClosestAncestorIn:f,isCharacterDataNode:l,isTextOrCommentNode:c,insertAfter:h,splitDataNode:p,getDocument:d,getWindow:v,getIframeWindow:g,getIframeDocument:m,getBody:H.getBody,isWindow:y,getContentDocument:b,getRootContainer:w,comparePoints:E,isBrokenNode:S,inspectNode:x,getComputedStyleProperty:D,fragmentFromNodeChildren:T,createIterator:C,DomPosition:k},e.DOMException=L}),D.createCoreModule("DomRange",["DomUtil"],function(e){function t(e,t){return 3!=e.nodeType&&(ot(e,t.startContainer)||ot(e,t.endContainer))}function n(e){return e.document||ut(e.startContainer)}function r(e){return new nt(e.parentNode,st(e))}function i(e){return new nt(e.parentNode,st(e)+1)}function s(e,t,n){var r=11==e.nodeType?e.firstChild:e;return it(t)?n==t.length?et.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:ft(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function o(e,t,r){if(T(e),T(t),n(t)!=n(e))throw new rt("WRONG_DOCUMENT_ERR");var i=at(e.startContainer,e.startOffset,t.endContainer,t.endOffset),s=at(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return r?0>=i&&s>=0:0>i&&s>0}function u(e){var t,r,i,s;for(i=n(e.range).createDocumentFragment();r=e.next();){if(t=e.isPartiallySelectedSubtree(),r=r.cloneNode(!t),t&&(s=e.getSubtreeIterator(),r.appendChild(u(s)),s.detach()),10==r.nodeType)throw new rt("HIERARCHY_REQUEST_ERR");i.appendChild(r)}return i}function a(e,t,n){var r,i,s,o;for(n=n||{stop:!1};s=e.next();)if(e.isPartiallySelectedSubtree()){if(t(s)===!1)return n.stop=!0,void 0;if(o=e.getSubtreeIterator(),a(o,t,n),o.detach(),n.stop)return}else for(r=et.createIterator(s);i=r.next();)if(t(i)===!1)return n.stop=!0,void 0}function f(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),f(t),t.detach()):e.remove()}function l(e){for(var t,r,i=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),r=e.getSubtreeIterator(),t.appendChild(l(r)),r.detach()):e.remove(),10==t.nodeType)throw new rt("HIERARCHY_REQUEST_ERR");i.appendChild(t)}return i}function c(e,t,n){var r,i,s=!!t&&!!t.length,o=!!n;return s&&(r=RegExp("^("+t.join("|")+")$")),i=[],a(new p(e,!1),function(t){var u,a;(!s||r.test(t.nodeType))&&(!o||n(t))&&(u=e.startContainer,t==u&&it(u)&&e.startOffset==u.length||(a=e.endContainer,t==a&&it(a)&&0==e.endOffset||i.push(t)))}),i}function h(e){var t=void 0===e.getName?"Range":e.getName();return"["+t+"("+et.inspectNode(e.startContainer)+":"+e.startOffset+", "+et.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function p(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&it(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||it(this.sc)?lt(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||it(this.ec)?lt(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function d(e){return function(t,n){for(var r,i=n?t:t.parentNode;i;){if(r=i.nodeType,ht(e,r))return i;i=i.parentNode}return null}}function v(e,t){if(R(e,t))throw new rt("INVALID_NODE_TYPE_ERR")}function m(e,t){if(!ht(t,e.nodeType))throw new rt("INVALID_NODE_TYPE_ERR")}function g(e,t){if(0>t||t>(it(e)?e.length:e.childNodes.length))throw new rt("INDEX_SIZE_ERR")}function y(e,t){if(I(e,!0)!==I(t,!0))throw new rt("WRONG_DOCUMENT_ERR")}function b(e){if(q(e,!0))throw new rt("NO_MODIFICATION_ALLOWED_ERR")}function w(e,t){if(!e)throw new rt(t)}function E(e){return dt&&et.isBrokenNode(e)||!ht(H,e.nodeType)&&!I(e,!0)}function S(e,t){return t<=(it(e)?e.length:e.childNodes.length)}function x(e){return!!e.startContainer&&!!e.endContainer&&!E(e.startContainer)&&!E(e.endContainer)&&S(e.startContainer,e.startOffset)&&S(e.endContainer,e.endOffset)}function T(e){if(!x(e))throw Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function N(e,t){var n,r,i,s,o;T(e),n=e.startContainer,r=e.startOffset,i=e.endContainer,s=e.endOffset,o=n===i,it(i)&&s>0&&s<i.length&&ft(i,s,t),it(n)&&r>0&&r<n.length&&(n=ft(n,r,t),o?(s-=r,i=n):i==n.parentNode&&s>=st(n)&&s++,r=0),e.setStartAndEnd(n,r,i,s)}function C(e){T(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function k(e){e.START_TO_START=V,e.START_TO_END=$,e.END_TO_END=J,e.END_TO_START=K,e.NODE_BEFORE=Q,e.NODE_AFTER=G,e.NODE_BEFORE_AND_AFTER=Y,e.NODE_INSIDE=Z}function L(e){k(e),k(e.prototype)}function A(e,t){return function(){var n,r,s,o,u,f,l;return T(this),n=this.startContainer,r=this.startOffset,s=this.commonAncestorContainer,o=new p(this,!0),n!==s&&(u=lt(n,s,!0),f=i(u),n=f.node,r=f.offset),a(o,b),o.reset(),l=e(o),o.detach(),t(this,n,r,n,r),l}}function O(n,s){function o(e,t){return function(n){m(n,P),m(pt(n),H);var s=(e?r:i)(n);(t?u:a)(this,s.node,s.offset)}}function u(e,t,n){var r=e.endContainer,i=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((pt(t)!=pt(r)||1==at(t,n,r,i))&&(r=t,i=n),s(e,t,n,r,i))}function a(e,t,n){var r=e.startContainer,i=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((pt(t)!=pt(r)||-1==at(t,n,r,i))&&(r=t,i=n),s(e,r,i,t,n))}var c=function(){};c.prototype=e.rangePrototype,n.prototype=new c,tt.extend(n.prototype,{setStart:function(e,t){v(e,!0),g(e,t),u(this,e,t)},setEnd:function(e,t){v(e,!0),g(e,t),a(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],r=t,i=n;switch(e.length){case 3:i=e[2];break;case 4:r=e[2],i=e[3]}s(this,t,n,r,i)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(e){T(this),e?s(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):s(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){v(e,!0),s(this,e,0,e,ct(e))},selectNode:function(e){v(e,!1),m(e,P);var t=r(e),n=i(e);s(this,t.node,t.offset,n.node,n.offset)},extractContents:A(l,s),deleteContents:A(f,s),canSurroundContents:function(){var e,n;return T(this),b(this.startContainer),b(this.endContainer),e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this),e.detach(),!n},splitBoundaries:function(){N(this)},splitBoundariesPreservingPositions:function(e){N(this,e)},normalizeBoundaries:function(){var e,t,n,r,i,o,u,a,f;T(this),e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,i=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},o=function(i){var s,o,u=i.previousSibling;u&&u.nodeType==i.nodeType&&(e=i,s=i.length,t=u.length,i.insertData(0,u.data),u.parentNode.removeChild(u),e==n?(r+=t,n=e):n==i.parentNode&&(o=st(i),r==o?(n=i,r=s):r>o&&r--))},u=!0,it(n)?n.length==r&&i(n):(r>0&&(a=n.childNodes[r-1],a&&it(a)&&i(a)),u=!this.collapsed),u?it(e)?0==t&&o(e):t<e.childNodes.length&&(f=e.childNodes[t],f&&it(f)&&o(f)):(e=n,t=r),s(this,e,t,n,r)},collapseToPoint:function(e,t){v(e,!0),g(e,t),this.setStartAndEnd(e,t)}}),L(n)}function M(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:et.getCommonAncestor(e.startContainer,e.endContainer)}function _(e,t,n,r,i){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=i,e.document=et.getDocument(t),M(e)}function D(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,M(this)}var P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et=e.dom,tt=e.util,nt=et.DomPosition,rt=e.DOMException,it=et.isCharacterDataNode,st=et.getNodeIndex,ot=et.isOrIsAncestorOf,ut=et.getDocument,at=et.comparePoints,ft=et.splitDataNode,lt=et.getClosestAncestorIn,ct=et.getNodeLength,ht=et.arrayContains,pt=et.getRootContainer,dt=e.features.crashyTextNodes;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,it(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!it(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e,t,r,i,s,o;return this.isSingleCharacterDataNode?(e=this.range.cloneRange(),e.collapse(!1)):(e=new D(n(this.range)),t=this._current,r=t,i=0,s=t,o=ct(t),ot(t,this.sc)&&(r=this.sc,i=this.so),ot(t,this.ec)&&(s=this.ec,o=this.eo),_(e,r,i,s,o)),new p(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},P=[1,3,4,5,7,8,10],H=[2,9,11],B=[5,6,10,12],j=[1,3,4,5,7,8,10,11],F=[1,3,4,5,7,8],I=d([9,11]),q=d(B),R=d([6,10,12]),U=document.createElement("style"),z=!1;try{U.innerHTML="<b>x</b>",z=3==U.firstChild.nodeType}catch(vt){}e.features.htmlParsingConforms=z,W=z?function(e){var t,n=this.startContainer,r=ut(n);if(!n)throw new rt("INVALID_STATE_ERR");return t=null,1==n.nodeType?t=n:it(n)&&(t=et.parentElement(n)),t=null===t||"HTML"==t.nodeName&&et.isHtmlNamespace(ut(t).documentElement)&&et.isHtmlNamespace(t)?r.createElement("body"):t.cloneNode(!1),t.innerHTML=e,et.fragmentFromNodeChildren(t)}:function(e){var t=n(this),r=t.createElement("body");return r.innerHTML=e,et.fragmentFromNodeChildren(r)},X=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],V=0,$=1,J=2,K=3,Q=0,G=1,Y=2,Z=3,tt.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){var n,r,i,s,o,u;return T(this),y(this.startContainer,t.startContainer),o=e==K||e==V?"start":"end",u=e==$||e==V?"start":"end",n=this[o+"Container"],r=this[o+"Offset"],i=t[u+"Container"],s=t[u+"Offset"],at(n,r,i,s)},insertNode:function(e){if(T(this),m(e,j),b(this.startContainer),ot(e,this.startContainer))throw new rt("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){var e,t,r;return T(this),this.collapsed?n(this).createDocumentFragment():this.startContainer===this.endContainer&&it(this.startContainer)?(e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t):(r=new p(this,!0),e=u(r),r.detach(),e)},canSurroundContents:function(){var e,n;return T(this),b(this.startContainer),b(this.endContainer),e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this),e.detach(),!n},surroundContents:function(e){if(m(e,F),!this.canSurroundContents())throw new rt("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){var e,t,r;for(T(this),e=new D(n(this)),t=X.length;t--;)r=X[t],e[r]=this[r];return e},toString:function(){var e,t,n;return T(this),e=this.startContainer,e===this.endContainer&&it(e)?3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"":(t=[],n=new p(this,!0),a(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join(""))},compareNode:function(e){var t,n,r,i;if(T(this),t=e.parentNode,n=st(e),!t)throw new rt("NOT_FOUND_ERR");return r=this.comparePoint(t,n),i=this.comparePoint(t,n+1),0>r?i>0?Y:Q:i>0?G:Z},comparePoint:function(e,t){return T(this),w(e,"HIERARCHY_REQUEST_ERR"),y(e,this.startContainer),at(e,t,this.startContainer,this.startOffset)<0?-1:at(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:W,toHtml:function(){return C(this)},intersectsNode:function(e,t){var r,i,s,o;return T(this),w(e,"NOT_FOUND_ERR"),ut(e)!==n(this)?!1:(r=e.parentNode,i=st(e),w(r,"NOT_FOUND_ERR"),s=at(r,i,this.endContainer,this.endOffset),o=at(r,i+1,this.startContainer,this.startOffset),t?0>=s&&o>=0:0>s&&o>0)},isPointInRange:function(e,t){return T(this),w(e,"HIERARCHY_REQUEST_ERR"),y(e,this.startContainer),at(e,t,this.startContainer,this.startOffset)>=0&&at(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return o(this,e,!1)},intersectsOrTouchesRange:function(e){return o(this,e,!0)},intersection:function(e){var t,n,r;return this.intersectsRange(e)?(t=at(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=at(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange(),-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r):null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==at(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==at(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new rt("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==Z},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,ct(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t,n,r=this.cloneRange();return r.selectNode(e),t=r.getNodes([3]),t.length>0?(r.setStart(t[0],0),n=t.pop(),r.setEnd(n,n.length),this.containsRange(r)):this.containsNodeContents(e)},getNodes:function(e,t){return T(this),c(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r,i,s,o=n(this),u=e.createRange(o);return t=t||et.getBody(o),u.selectNodeContents(t),r=this.intersection(u),i=0,s=0,r&&(u.setEnd(r.startContainer,r.startOffset),i=(""+u).length,s=i+(""+r).length),{start:i,end:s,containerNode:t}},moveToBookmark:function(e){var t,n,r,i,s,o,u,a=e.containerNode,f=0;for(this.setStart(a,0),this.collapse(!0),t=[a],r=!1,i=!1;!i&&(n=t.pop());)if(3==n.nodeType)s=f+n.length,!r&&e.start>=f&&e.start<=s&&(this.setStart(n,e.start-f),r=!0),r&&e.end>=f&&e.end<=s&&(this.setEnd(n,e.end-f),i=!0),f=s;else for(u=n.childNodes,o=u.length;o--;)t.push(u[o])},getName:function(){return"DomRange"},equals:function(e){return D.rangesEqual(this,e)},isValid:function(){return x(this)},inspect:function(){return h(this)},detach:function(){}}),O(D,_),tt.extend(D,{rangeProperties:X,RangeIterator:p,copyComparisonConstants:L,createPrototypeRange:O,inspect:h,toHtml:C,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=D}),D.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,i,s,o,u,a,f,l=e.dom,c=e.util,h=l.DomPosition,p=e.DomRange,d=l.getBody,v=l.getContentDocument,m=l.isCharacterDataNode;e.features.implementsDomRange&&!function(){function r(e){for(var t,n=y.length;n--;)t=y[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function i(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!=n,o=e.endContainer!==r||e.endOffset!=i,u=!e.equals(e.nativeRange);(s||o||u)&&(e.setEnd(r,i),e.setStart(t,n))}var s,o,u,a,f,h,m,g,y=p.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,r(this)},p.createPrototypeRange(n,i),s=n.prototype,s.selectNode=function(e){this.nativeRange.selectNode(e),r(this)},s.cloneContents=function(){return this.nativeRange.cloneContents()},s.surroundContents=function(e){this.nativeRange.surroundContents(e),r(this)},s.collapse=function(e){this.nativeRange.collapse(e),r(this)},s.cloneRange=function(){return new n(this.nativeRange.cloneRange())},s.refresh=function(){r(this)},s.toString=function(){return""+this.nativeRange},u=document.createTextNode("test"),d(document).appendChild(u),a=document.createRange(),a.setStart(u,0),a.setEnd(u,0);try{a.setStart(u,1),s.setStart=function(e,t){this.nativeRange.setStart(e,t),r(this)},s.setEnd=function(e,t){this.nativeRange.setEnd(e,t),r(this)},o=function(e){return function(t){this.nativeRange[e](t),r(this)}}}catch(b){s.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}r(this)},s.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}r(this)},o=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(i){this.nativeRange[t](n),this.nativeRange[e](n)}r(this)}}}s.setStartBefore=o("setStartBefore","setEndBefore"),s.setStartAfter=o("setStartAfter","setEndAfter"),s.setEndBefore=o("setEndBefore","setStartBefore"),s.setEndAfter=o("setEndAfter","setStartAfter"),s.selectNodeContents=function(e){this.setStartAndEnd(e,0,l.getNodeLength(e))},a.selectNodeContents(u),a.setEnd(u,3),f=document.createRange(),f.selectNodeContents(u),f.setEnd(u,4),f.setStart(u,2),s.compareBoundaryPoints=-1==a.compareBoundaryPoints(a.START_TO_END,f)&&1==a.compareBoundaryPoints(a.END_TO_START,f)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},h=document.createElement("div"),h.innerHTML="123",m=h.firstChild,g=d(document),g.appendChild(h),a.setStart(m,1),a.setEnd(m,2),a.deleteContents(),"13"==m.data&&(s.deleteContents=function(){this.nativeRange.deleteContents(),r(this)},s.extractContents=function(){var e=this.nativeRange.extractContents();return r(this),e}),g.removeChild(h),g=null,c.isHostMethod(a,"createContextualFragment")&&(s.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),d(document).removeChild(u),s.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=v(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange&&(i=function(e){var t,n,r,i=e.parentElement(),s=e.duplicate();return s.collapse(!0),t=s.parentElement(),s=e.duplicate(),s.collapse(!1),n=s.parentElement(),r=t==n?t:l.getCommonAncestor(t,n),r==i?r:l.getCommonAncestor(i,r)},s=function(e){return 0==e.compareEndPoints("StartToEnd",e)},o=function(e,t,n,r,i){var s,o,u,a,f,c,p,d,v,g,y,b,w,E,S,x,T=e.duplicate();if(T.collapse(n),s=T.parentElement(),l.isOrIsAncestorOf(t,s)||(s=t),!s.canHaveHTML)return o=new h(s.parentNode,l.getNodeIndex(s)),{boundaryPosition:o,nodeInfo:{nodeIndex:o.offset,containerElement:o.node}};for(u=l.getDocument(s).createElement("span"),u.parentNode&&u.parentNode.removeChild(u),f=n?"StartToStart":"StartToEnd",g=i&&i.containerElement==s?i.nodeIndex:0,y=s.childNodes.length,b=y,w=b;;){if(w==y?s.appendChild(u):s.insertBefore(u,s.childNodes[w]),T.moveToElementText(u),a=T.compareEndPoints(f,e),0==a||g==b)break;if(-1==a){if(b==g+1)break;g=w}else b=b==g+1?g:w;w=Math.floor((g+b)/2),s.removeChild(u)}if(v=u.nextSibling,-1==a&&v&&m(v)){if(T.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(v.data))for(S=T.duplicate(),x=S.text.replace(/\r\n/g,"\r").length,E=S.moveStart("character",x);-1==(a=S.compareEndPoints("StartToEnd",S));)E++,S.moveStart("character",1);else E=T.text.length;d=new h(v,E)}else c=(r||!n)&&u.previousSibling,p=(r||n)&&u.nextSibling,d=p&&m(p)?new h(p,0):c&&m(c)?new h(c,c.data.length):new h(s,l.getNodeIndex(u));return u.parentNode.removeChild(u),{boundaryPosition:d,nodeInfo:{nodeIndex:w,containerElement:s}}},u=function(e,t){var n,r,i,s,o=e.offset,u=l.getDocument(e.node),a=d(u).createTextRange(),f=m(e.node);return f?(n=e.node,r=n.parentNode):(s=e.node.childNodes,n=o<s.length?s[o]:null,r=e.node),i=u.createElement("span"),i.innerHTML="&#feff;",n?r.insertBefore(i,n):r.appendChild(i),a.moveToElementText(i),a.collapse(!t),r.removeChild(i),f&&a[t?"moveStart":"moveEnd"]("character",o),a},r=function(e){this.textRange=e,this.refresh()},r.prototype=new p(document),r.prototype.refresh=function(){var e,t,n,r=i(this.textRange);s(this.textRange)?t=e=o(this.textRange,r,!0,!0).boundaryPosition:(n=o(this.textRange,r,!0,!1),e=n.boundaryPosition,t=o(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},p.copyComparisonConstants(r),a=function(e){var t,n,r;return e.collapsed?u(new h(e.startContainer,e.startOffset),!0):(t=u(new h(e.startContainer,e.startOffset),!0),n=u(new h(e.endContainer,e.endOffset),!1),r=d(p.getRangeDocument(e)).createTextRange(),r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r)},r.rangeToTextRange=a,r.prototype.toTextRange=function(){return a(this)},e.WrappedTextRange=r,(!e.features.implementsDomRange||e.config.preferTextRange)&&(f=function(){return this}(),void 0===f.Range&&(f.Range=r),e.createNativeRange=function(e){return e=v(e,t,"createNativeRange"),d(e).createTextRange()},e.WrappedRange=r)),e.createRange=function(n){return n=v(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=v(e,t,"createRangyRange"),new p(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addShimListener(function(t){var n=t.document;void 0===n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),D.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function r(e,n){if(e){if(C.isWindow(e))return e;if(e instanceof g)return e.win;var r=C.getContentDocument(e,t,n);return C.getWindow(r)}return window}function i(e){return r(e,"getWinSelection").getSelection()}function s(e){return r(e,"getDocSelection").document.selection}function o(e){var t=!1;return e.anchorNode&&(t=1==C.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function u(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function a(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function f(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function l(t){var n;return t instanceof A?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof O?n=t.nativeRange:H.implementsDomRange&&t instanceof C.getWindow(t.startContainer).Range&&(n=t),n}function c(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!C.isAncestorOf(e[0],e[t]))return!1;return!0}function h(e){var n=e.getNodes();if(!c(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function p(e){return!!e&&void 0!==e.text}function d(e,t){var n=new O(t);e._ranges=[n],u(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function v(t){var n,r,i,s;if(t._ranges.length=0,"None"==t.docSelection.type)f(t);else if(n=t.docSelection.createRange(),p(n))d(t,n);else{for(t.rangeCount=n.length,i=j(n.item(0)),s=0;s<t.rangeCount;++s)r=e.createRange(i),r.selectNode(n.item(s)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,u(t,t._ranges[t.rangeCount-1],!1)}}function m(e,n){var r,i,s=e.docSelection.createRange(),o=h(n),u=j(s.item(0)),a=F(u).createControlRange();for(r=0,i=s.length;i>r;++r)a.add(s.item(r));try{a.add(o)}catch(f){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),v(e)}function g(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function y(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function b(e,t){for(var n,r,i=tt.length;i--;)if(n=tt[i],r=n.selection,"deleteAll"==t)y(r);else if(n.win==e)return"delete"==t?(tt.splice(i,1),!0):r;return"deleteAll"==t&&(tt.length=0),null}function w(e,n){var r,i,s,o=j(n[0].startContainer),u=F(o).createControlRange();for(r=0,s=n.length;s>r;++r){i=h(n[r]);try{u.add(i)}catch(a){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}u.select(),v(e)}function E(e,t){if(e.win.document!=j(t))throw new M("WRONG_DOCUMENT_ERR")}function S(t){return function(n,r){var i;this.rangeCount?(i=this.getRangeAt(0),i["set"+(t?"Start":"End")](n,r)):(i=e.createRange(this.win.document),i.setStartAndEnd(n,r)),this.setSingleRange(i,this.isBackward())}}function x(e){var t,n,r=[],i=new _(e.anchorNode,e.anchorOffset),s=new _(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(t=0,n=e.rangeCount;n>t;++t)r[t]=A.inspect(e.getRangeAt(t));return"["+o+"(Ranges: "+r.join(", ")+")(anchor: "+i.inspect()+", focus: "+s.inspect()+"]"}var T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut;if(e.config.checkSelectionRanges=!0,T="boolean",N="number",C=e.dom,k=e.util,L=k.isHostMethod,A=e.DomRange,O=e.WrappedRange,M=e.DOMException,_=C.DomPosition,H=e.features,B="Control",j=C.getDocument,F=C.getBody,I=A.rangesEqual,q=L(window,"getSelection"),R=k.isHostObject(document,"selection"),H.implementsWinGetSelection=q,H.implementsDocSelection=R,U=R&&(!q||e.config.preferTextRange),U?(D=s,e.isSelectionValid=function(e){var t=r(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||j(n.createRange().parentElement())==t}):q?(D=i,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=D,z=D(),W=e.createNativeRange(document),X=F(document),V=k.areHostProperties(z,["anchorNode","focusNode","anchorOffset","focusOffset"]),H.selectionHasAnchorAndFocus=V,$=L(z,"extend"),H.selectionHasExtend=$,J=typeof z.rangeCount==N,H.selectionHasRangeCount=J,K=!1,Q=!0,G=$?function(t,n){var r=A.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(l(i)),t.extend(n.startContainer,n.startOffset)}:null,k.areHostMethods(z,["addRange","getRangeAt","removeAllRanges"])&&typeof z.rangeCount==N&&H.implementsDomRange&&!function(){var t,n,r,i,s,u,a,f,l,c,h,p=window.getSelection();if(p){for(t=p.rangeCount,n=t>1,r=[],i=o(p),s=0;t>s;++s)r[s]=p.getRangeAt(s);for(u=F(document),a=u.appendChild(document.createElement("div")),a.contentEditable="false",f=a.appendChild(document.createTextNode("   ")),l=document.createRange(),l.setStart(f,1),l.collapse(!0),p.addRange(l),Q=1==p.rangeCount,p.removeAllRanges(),n||(c=window.navigator.appVersion.match(/Chrome\/(.*?) /),c&&parseInt(c[1])>=36?K=!1:(h=l.cloneRange(),l.setStart(f,0),h.setEnd(f,3),h.setStart(f,2),p.addRange(l),p.addRange(h),K=2==p.rangeCount)),u.removeChild(a),p.removeAllRanges(),s=0;t>s;++s)0==s&&i?G?G(p,r[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),p.addRange(r[s])):p.addRange(r[s])}}(),H.selectionSupportsMultipleRanges=K,H.collapsedNonEditableSelectionsSupported=Q,Y=!1,X&&L(X,"createControlRange")&&(Z=X.createControlRange(),k.areHostProperties(Z,["item","add"])&&(Y=!0)),H.implementsControlRange=Y,P=V?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1},L(z,"getRangeAt")?et=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:V&&(et=function(t){var n=j(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),g.prototype=e.selectionPrototype,tt=[],nt=function(e){var t,n,i;return e&&e instanceof g?(e.refresh(),e):(e=r(e,"getNativeSelection"),t=b(e),n=D(e),i=R?s(e):null,t?(t.nativeSelection=n,t.docSelection=i,t.refresh()):(t=new g(n,i,e),tt.push({win:e,selection:t})),t)},e.getSelection=nt,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(C.getIframeWindow(n))},rt=g.prototype,!U&&V&&k.areHostMethods(z,["removeAllRanges","addRange"]))rt.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),f(this)},it=function(e,t){G(e.nativeSelection,t),e.refresh()},rt.addRange=J?function(t,r){var i,s;Y&&R&&this.docSelection.type==B?m(this,t):n(r)&&$?it(this,t):(K?i=this.rangeCount:(this.removeAllRanges(),i=0),this.nativeSelection.addRange(l(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==i+1?(e.config.checkSelectionRanges&&(s=et(this.nativeSelection,this.rangeCount-1),s&&!I(s,t)&&(t=new O(s))),this._ranges[this.rangeCount-1]=t,u(this,t,ut(this.nativeSelection)),this.isCollapsed=P(this)):this.refresh())}:function(e,t){n(t)&&$?it(this,e):(this.nativeSelection.addRange(l(e)),this.refresh())},rt.setRanges=function(e){if(Y&&R&&e.length>1)w(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}};else{if(!(L(z,"empty")&&L(W,"select")&&Y&&U))return t.fail("No means of selecting a Range or TextRange was found"),!1;rt.removeAllRanges=function(){var e,t,n;try{this.docSelection.empty(),"None"!=this.docSelection.type&&(this.anchorNode?e=j(this.anchorNode):this.docSelection.type==B&&(t=this.docSelection.createRange(),t.length&&(e=j(t.item(0)))),e&&(n=F(e).createTextRange(),n.select(),this.docSelection.empty()))}catch(r){}f(this)},rt.addRange=function(t){this.docSelection.type==B?m(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,u(this,t,!1))},rt.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?w(this,e):t&&this.addRange(e[0])}}if(rt.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new M("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()},U)st=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=F(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==B?v(t):p(n)?d(t,n):f(t)};else if(L(z,"getRangeAt")&&typeof z.rangeCount==N)st=function(t){if(Y&&R&&t.docSelection.type==B)v(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;r>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));u(t,t._ranges[t.rangeCount-1],ut(t.nativeSelection)),t.isCollapsed=P(t)}else f(t)};else{if(!V||typeof z.isCollapsed!=T||typeof W.collapsed!=T||!H.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;st=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=et(n,0),e._ranges=[t],e.rangeCount=1,a(e),e.isCollapsed=P(e)):f(e)}}rt.refresh=function(e){var t,n=e?this._ranges.slice(0):null,r=this.anchorNode,i=this.anchorOffset;if(st(this),e){if(t=n.length,t!=this._ranges.length)return!0;if(this.anchorNode!=r||this.anchorOffset!=i)return!0;for(;t--;)if(!I(n[t],this._ranges[t]))return!0;return!1}},ot=function(e,t){var n,r,i=e.getAllRanges();for(e.removeAllRanges(),n=0,r=i.length;r>n;++n)I(t,i[n])||e.addRange(i[n]);e.rangeCount||f(e)},rt.removeRange=Y&&R?function(e){var t,n,r,i,s,o,u,a;if(this.docSelection.type==B){for(t=this.docSelection.createRange(),n=h(e),r=j(t.item(0)),i=F(r).createControlRange(),o=!1,u=0,a=t.length;a>u;++u)s=t.item(u),s!==n||o?i.add(t.item(u)):o=!0;i.select(),v(this)}else ot(this,e)}:function(e){ot(this,e)},!U&&V&&H.implementsDomRange?(ut=o,rt.isBackward=function(){return ut(this)}):ut=rt.isBackward=function(){return!1},rt.isBackwards=rt.isBackward,rt.toString=function(){var e,t,n=[];for(e=0,t=this.rangeCount;t>e;++e)n[e]=""+this._ranges[e];return n.join("")},rt.collapse=function(t,n){E(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},rt.collapseToStart=function(){if(!this.rangeCount)throw new M("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},rt.collapseToEnd=function(){if(!this.rangeCount)throw new M("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},rt.selectAllChildren=function(t){E(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},rt.deleteFromDocument=function(){var e,t,n,r,i;if(Y&&R&&this.docSelection.type==B){for(e=this.docSelection.createRange();e.length;)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount&&(n=this.getAllRanges(),n.length)){for(this.removeAllRanges(),r=0,i=n.length;i>r;++r)n[r].deleteContents();this.addRange(n[i-1])}},rt.eachRange=function(e,t){for(var n=0,r=this._ranges.length;r>n;++n)if(e(this.getRangeAt(n)))return t},rt.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},rt.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},rt.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t))}),n},rt.setStart=S(!0),rt.setEnd=S(!1),e.rangePrototype.select=function(e){nt(this.getDocument()).setSingleRange(this,e)},rt.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},rt.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},rt.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},rt.moveToBookmark=function(t){var n,r,i,s=[];for(n=0;r=t.rangeBookmarks[n++];)i=e.createRange(this.win),i.moveToBookmark(r),s.push(i);t.backward?this.setSingleRange(s[0],"backward"):this.setRanges(s)},rt.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(A.toHtml(t))}),e.join("")},H.implementsTextRange&&(rt.getNativeTextRange=function(){var n,r;if(n=this.docSelection){if(r=n.createRange(),p(r))return r;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),rt.getName=function(){return"WrappedSelection"},rt.inspect=function(){return x(this)},rt.detach=function(){b(this.win,"delete"),y(this)},g.detachAll=function(){b(null,"deleteAll")},g.inspect=x,g.isDirectionBackward=n,e.Selection=g,e.selectionPrototype=rt,e.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return nt(e)}),e=null})}),D)},this),function(e,t){"function"==typeof define&&define.amd?define(["rangy"],e):e(t.rangy)}(function(e){e.createModule("SaveRestore",["WrappedRange"],function(e,t){function n(e,t){return(t||document).getElementById(e)}function r(e,t){var n,r="selectionBoundary_"+ +(new Date)+"_"+(""+Math.random()).slice(2),i=d.getDocument(e.startContainer),s=e.cloneRange();return s.collapse(t),n=i.createElement("span"),n.id=r,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(i.createTextNode(v)),s.insertNode(n),n}function i(e,r,i,s){var o=n(i,e);o?(r[s?"setStartBefore":"setEndBefore"](o),o.parentNode.removeChild(o)):t.warn("Marker element has been removed. Cannot restore selection.")}function s(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function o(t,n){var i,s,o=e.DomRange.getRangeDocument(t),u=""+t;return t.collapsed?(s=r(t,!1),{document:o,markerId:s.id,collapsed:!0}):(s=r(t,!1),i=r(t,!0),{document:o,startMarkerId:i.id,endMarkerId:s.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+u+"', new text: '"+t+"'"}})}function u(r,s){var o,u,a,f=r.document;return void 0===s&&(s=!0),o=e.createRange(f),r.collapsed?(u=n(r.markerId,f),u?(u.style.display="inline",a=u.previousSibling,a&&3==a.nodeType?(u.parentNode.removeChild(u),o.collapseToPoint(a,a.length)):(o.collapseBefore(u),u.parentNode.removeChild(u))):t.warn("Marker element has been removed. Cannot restore selection.")):(i(f,o,r.startMarkerId,!0),i(f,o,r.endMarkerId,!1)),s&&o.normalizeBoundaries(),o}function a(t,r){var i,u,a,f,l=[];for(t=t.slice(0),t.sort(s),a=0,f=t.length;f>a;++a)l[a]=o(t[a],r);for(a=f-1;a>=0;--a)i=t[a],u=e.DomRange.getRangeDocument(i),i.collapsed?i.collapseAfter(n(l[a].markerId,u)):(i.setEndBefore(n(l[a].endMarkerId,u)),i.setStartAfter(n(l[a].startMarkerId,u)));return l}function f(n){var r,i,s,o;return e.isSelectionValid(n)?(r=e.getSelection(n),i=r.getAllRanges(),s=1==i.length&&r.isBackward(),o=a(i,s),s?r.setSingleRange(i[0],"backward"):r.setRanges(i),{win:n,rangeInfos:o,restored:!1}):(t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null)}function l(e){var t,n=[],r=e.length;for(t=r-1;t>=0;t--)n[t]=u(e[t],!0);return n}function c(t,n){var r,i,s,o;t.restored||(r=t.rangeInfos,i=e.getSelection(t.win),s=l(r),o=r.length,1==o&&n&&e.features.selectionHasExtend&&r[0].backward?(i.removeAllRanges(),i.addRange(s[0],!0)):i.setRanges(s),t.restored=!0)}function h(e,t){var r=n(t,e);r&&r.parentNode.removeChild(r)}function p(e){var t,n,r,i=e.rangeInfos;for(t=0,n=i.length;n>t;++t)r=i[t],r.collapsed?h(e.doc,r.markerId):(h(e.doc,r.startMarkerId),h(e.doc,r.endMarkerId))}var d=e.dom,v="﻿";e.util.extend(e,{saveRange:o,restoreRange:u,saveRanges:a,restoreRanges:l,saveSelection:f,restoreSelection:c,removeMarkerElement:h,removeMarkers:p})})},this),Base=function(){},Base.extend=function(e,t){var n,r,i,s=Base.prototype.extend;return Base._prototyping=!0,n=new this,s.call(n,e),n.base=function(){},delete Base._prototyping,r=n.constructor,i=n.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==i)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||s).call(arguments[0],n)},i.ancestor=this,i.extend=this.extend,i.forEach=this.forEach,i.implement=this.implement,i.prototype=n,i.toString=this.toString,i.valueOf=function(e){return"object"==e?i:r.valueOf()},s.call(i,t),"function"==typeof i.init&&i.init(),i},Base.prototype={extend:function(e,t){var n,r,i,s,o,u,a;if(arguments.length>1)n=this[e],!n||"function"!=typeof t||n.valueOf&&n.valueOf()==t.valueOf()||!/\bbase\b/.test(t)||(r=t.valueOf(),t=function(){var e,t=this.base||Base.prototype.base;return this.base=n,e=r.apply(this,arguments),this.base=t,e},t.valueOf=function(e){return"object"==e?t:r},t.toString=Base.toString),this[e]=t;else if(e){for(i=Base.prototype.extend,Base._prototyping||"function"==typeof this||(i=this.extend||i),s={toSource:null},o=["constructor","toString","valueOf"],u=Base._prototyping?0:1;a=o[u++];)e[a]!=s[a]&&i.call(this,a,e[a]);for(a in e)s[a]||i.call(this,a,e[a])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,n){for(var r in e)void 0===this.prototype[r]&&t.call(n,e[r],r,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return this.valueOf()+""}}),wysihtml5.browser=function(){function e(e){return+(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function t(e){return+(e.match(/android (\d+)/)||[void 0,0])[1]}function n(e,t){var n,r=-1;return"Microsoft Internet Explorer"==navigator.appName?n=RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(n=RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")),n&&null!=n.exec(navigator.userAgent)&&(r=parseFloat(RegExp.$1)),-1===r?!1:e?t?"<"===t?r>e:">"===t?e>r:"<="===t?r>=e:">="===t?e>=r:void 0:e===r:!0}var r=navigator.userAgent,i=document.createElement("div"),s=-1!==r.indexOf("Gecko")&&-1===r.indexOf("KHTML"),o=-1!==r.indexOf("AppleWebKit/"),u=-1!==r.indexOf("Chrome/"),a=-1!==r.indexOf("Opera/");return{USER_AGENT:r,supported:function(){var n=this.USER_AGENT.toLowerCase(),r="contentEditable"in i,s=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,o=document.querySelector&&document.querySelectorAll,u=this.isIos()&&e(n)<5||this.isAndroid()&&t(n)<4||-1!==n.indexOf("opera mobi")||-1!==n.indexOf("hpwos/");return r&&s&&o&&!u},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return-1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return n()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return n()},hasCurrentStyleProperty:function(){return"currentStyle"in i},hasHistoryIssue:function(){return s&&"Mac"===navigator.platform.substr(0,3)},insertsLineBreaksOnReturn:function(){return s},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in i||function(){return i.setAttribute("on"+e,"return;"),"function"==typeof i["on"+e]}()},supportsEventsInIframeCorrectly:function(){return!a},supportsHTML5Tags:function(e){var t=e.createElement("div"),n="<article>foo</article>";return t.innerHTML=n,t.innerHTML.toLowerCase()===n},supportsCommand:function(){var e={formatBlock:n(10,"<="),insertUnorderedList:n(),insertOrderedList:n()},t={insertHTML:s};return function(n,r){var i=e[r];if(!i){try{return n.queryCommandSupported(r)}catch(s){}try{return n.queryCommandEnabled(r)}catch(o){return!!t[r]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return s||a||o},supportsGetAttributeCorrectly:function(){var e=document.createElement("td");return"1"!=e.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return s||n()||a},autoScrollsToCaret:function(){return!o},autoClosesUnclosedTags:function(){var e,t,n=i.cloneNode(!1);return n.innerHTML="<p><div></div>",t=n.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function(){return-1!==(document.getElementsByClassName+"").indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},needsSpaceAfterLineBreak:function(){return a},supportsSpeechApiOn:function(e){var t=r.match(/Chrome\/(\d+)/)||[void 0,0];return t[1]>=11&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(e){return n(9)&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return n()},hasProblemsSettingCaretAfterImg:function(){return n()},hasUndoInContextMenu:function(){return s||u||a},hasInsertNodeIssue:function(){return a},hasIframeFocusIssue:function(){return n()},createsNestedInvalidMarkupAfterPaste:function(){return o},supportsMutationEvents:function(){return"MutationEvent"in window},supportsModenPaste:function(){return!("clipboardData"in window)}}}(),wysihtml5.lang.array=function(e){return{contains:function(t){if(Array.isArray(t)){for(var n=t.length;n--;)if(-1!==wysihtml5.lang.array(e).indexOf(t[n]))return!0;return!1}return-1!==wysihtml5.lang.array(e).indexOf(t)},indexOf:function(t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},without:function(t){t=wysihtml5.lang.array(t);for(var n=[],r=0,i=e.length;i>r;r++)t.contains(e[r])||n.push(e[r]);return n},get:function(){for(var t=0,n=e.length,r=[];n>t;t++)r.push(e[t]);return r},map:function(t,n){if(Array.prototype.map)return e.map(t,n);for(var r=e.length>>>0,i=Array(r),s=0;r>s;s++)i[s]=t.call(n,e[s],s,e);return i},unique:function(){for(var t=[],n=e.length,r=0;n>r;)wysihtml5.lang.array(t).contains(e[r])||t.push(e[r]),r++;return t}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},off:function(e,t){this.events=this.events||{};var n,r,i=0;if(e){for(n=this.events[e]||[],r=[];i<n.length;i++)n[i]!==t&&t&&r.push(n[i]);this.events[e]=r}else this.events={};return this},fire:function(e,t){this.events=this.events||{};for(var n=this.events[e]||[],r=0;r<n.length;r++)n[r].call(this,t);return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(e){return{merge:function(t){for(var n in t)e[n]=t[n];return this},get:function(){return e},clone:function(t){var n,r={};if(null===e||!wysihtml5.lang.object(e).isPlainObject())return e;for(n in e)e.hasOwnProperty(n)&&(r[n]=t?wysihtml5.lang.object(e[n]).clone(t):e[n]);return r},isArray:function(){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(e)},isPlainObject:function(){return"[object Object]"===Object.prototype.toString.call(e)}}},function(){var e=/^\s+/,t=/\s+$/,n=/[&<>\t"]/g,r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","	":"&nbsp; "};wysihtml5.lang.string=function(i){return i+="",{trim:function(){return i.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)i=this.replace("#{"+t+"}").by(e[t]);return i},replace:function(e){return{by:function(t){return i.split(e).join(t)}}},escapeHTML:function(e,t){var s=i.replace(n,function(e){return r[e]});return e&&(s=s.replace(/(?:\r\n|\r|\n)/g,"<br />")),t&&(s=s.replace(/  /gi,"&nbsp; ")),s}}}}(),function(e){function t(e,t){return s(e,t)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),o(e,t))}function n(e){return e.replace(a,function(e,t){var n,r,i=(t.match(f)||[])[1]||"",s=c[i];return t=t.replace(f,""),t.split(s).length>t.split(i).length&&(t+=i,i=""),n=t,r=t,t.length>l&&(r=r.substr(0,l)+"..."),"www."===n.substr(0,4)&&(n="http://"+n),'<a href="'+n+'">'+r+"</a>"+i})}function r(e){var t=e._wysihtml5_tempElement;return t||(t=e._wysihtml5_tempElement=e.createElement("div")),t}function i(t){var i=t.parentNode,s=e.lang.string(t.data).escapeHTML(),o=r(i.ownerDocument);for(o.innerHTML="<span></span>"+n(s),o.removeChild(o.firstChild);o.firstChild;)i.insertBefore(o.firstChild,t);i.removeChild(t)}function s(t,n){for(var r;t.parentNode;){if(t=t.parentNode,r=t.nodeName,t.className&&e.lang.array(t.className.split(" ")).contains(n))return!0;if(u.contains(r))return!0;if("body"===r)return!1}return!1}function o(t,n){if(!(u.contains(t.nodeName)||t.className&&e.lang.array(t.className.split(" ")).contains(n))){if(t.nodeType===e.TEXT_NODE&&t.data.match(a))return i(t),void 0;for(var r=e.lang.array(t.childNodes).get(),s=r.length,f=0;s>f;f++)o(r[f],n);return t}}var u=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),a=/((https?:\/\/|www\.)[^\s<]{3,})/gi,f=/([^\w\/\-](,?))$/i,l=100,c={")":"(","]":"[","}":"{"};e.dom.autoLink=t,e.dom.autoLink.URL_REG_EXP=a}(wysihtml5),function(e){var t=e.dom;t.addClass=function(e,n){var r=e.classList;return r?r.add(n):(t.hasClass(e,n)||(e.className+=" "+n),void 0)},t.removeClass=function(e,t){var n=e.classList;return n?n.remove(t):(e.className=e.className.replace(RegExp("(^|\\s+)"+t+"(\\s+|$)")," "),void 0)},t.hasClass=function(e,t){var n,r=e.classList;return r?r.contains(t):(n=e.className,n.length>0&&(n==t||RegExp("(^|\\s)"+t+"(\\s|$)").test(n)))}}(wysihtml5),wysihtml5.dom.contains=function(){var e=document.documentElement;return e.contains?function(e,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),e!==t&&e.contains(t)}:e.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0}(),wysihtml5.dom.convertToList=function(){function e(e,t){var n=e.createElement("li");return t.appendChild(n),n}function t(e,t){return e.createElement(t)}function n(n,r,i){if("UL"===n.nodeName||"OL"===n.nodeName||"MENU"===n.nodeName)return n;var s,o,u,f,l,c,h,p,d,v=n.ownerDocument,m=t(v,r),g=n.querySelectorAll("br"),y=g.length;for(d=0;y>d;d++)for(f=g[d];(l=f.parentNode)&&l!==n&&l.lastChild===f;){if("block"===wysihtml5.dom.getStyle("display").from(l)){l.removeChild(f);break}wysihtml5.dom.insert(f).after(f.parentNode)}for(s=wysihtml5.lang.array(n.childNodes).get(),o=s.length,d=0;o>d;d++)p=p||e(v,m),u=s[d],c="block"===wysihtml5.dom.getStyle("display").from(u),h="BR"===u.nodeName,!c||i&&wysihtml5.dom.hasClass(u,i)?h?p=p.firstChild?null:p:p.appendChild(u):(p=p.firstChild?e(v,m):p,p.appendChild(u),p=null);return 0===s.length&&e(v,m),n.parentNode.replaceChild(m,n),m}return n}(),wysihtml5.dom.copyAttributes=function(e){return{from:function(t){return{to:function(n){for(var r,i=0,s=e.length;s>i;i++)r=e[i],void 0!==t[r]&&""!==t[r]&&(n[r]=t[r]);return{andTo:arguments.callee}}}}}},function(e){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],n=function(t){return r(t)?parseInt(e.getStyle("width").from(t),10)<t.offsetWidth:!1},r=function(n){for(var r=0,i=t.length;i>r;r++)if("border-box"===e.getStyle(t[r]).from(n))return t[r]};e.copyStyles=function(r){return{from:function(i){n(i)&&(r=wysihtml5.lang.array(r).without(t));for(var s,o="",u=r.length,f=0;u>f;f++)s=r[f],o+=s+":"+e.getStyle(s).from(i)+";";return{to:function(t){return e.setStyles(o).on(t),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(e){e.dom.delegate=function(t,n,r,i){return e.dom.observe(t,r,function(r){for(var s=r.target,o=e.lang.array(t.querySelectorAll(n));s&&s!==t;){if(o.contains(s)){i.call(s,r);break}s=s.parentNode}})}}(wysihtml5),function(e){e.dom.domNode=function(t){var n=[e.ELEMENT_NODE,e.TEXT_NODE],r=function(t){return t.nodeType===e.TEXT_NODE&&/^\s*$/g.test(t.data)};return{prev:function(i){var s=t.previousSibling,o=i&&i.nodeTypes?i.nodeTypes:n;return s?!e.lang.array(o).contains(s.nodeType)||i&&i.ignoreBlankTexts&&r(s)?e.dom.domNode(s).prev(i):s:null},next:function(i){var s=t.nextSibling,o=i&&i.nodeTypes?i.nodeTypes:n;return s?!e.lang.array(o).contains(s.nodeType)||i&&i.ignoreBlankTexts&&r(s)?e.dom.domNode(s).next(i):s:null}}}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var e=function(e,t){var n=t.createElement("div");n.style.display="none",t.body.appendChild(n);try{n.innerHTML=e}catch(r){}return t.body.removeChild(n),n},t=function(e){if(!e._wysihtml5_supportsHTML5Tags){for(var t=0,r=n.length;r>t;t++)e.createElement(n[t]);e._wysihtml5_supportsHTML5Tags=!0}},n=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(n,r){r=r||document;var i;return"object"==typeof n&&n.nodeType?(i=r.createElement("div"),i.appendChild(n)):wysihtml5.browser.supportsHTML5Tags(r)?(i=r.createElement("div"),i.innerHTML=n):(t(r),i=e(n,r)),i}}(),wysihtml5.dom.getParentElement=function(){function e(e,t){return t&&t.length?"string"==typeof t?e===t:wysihtml5.lang.array(t).contains(e):!0}function t(e){return e.nodeType===wysihtml5.ELEMENT_NODE}function n(e,t,n){var r=(e.className||"").match(n)||[];return t?r[r.length-1]===t:!!r.length}function r(e,t,n){var r=(e.getAttribute("style")||"").match(n)||[];return t?r[r.length-1]===t:!!r.length}return function(i,s,o,u){var f=s.cssStyle||s.styleRegExp,l=s.className||s.classRegExp;for(o=o||50;o--&&i&&"BODY"!==i.nodeName&&(!u||i!==u);){if(t(i)&&e(i.nodeName,s.nodeName)&&(!f||r(i,s.cssStyle,s.styleRegExp))&&(!l||n(i,s.className,s.classRegExp)))return i;i=i.parentNode}return null}}(),wysihtml5.dom.getStyle=function(){function e(e){return e.replace(n,function(e){return e.charAt(1).toUpperCase()})}var t={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},n=/\-[a-z]/g;return function(n){return{from:function(r){var i,s,o,u,f,l,h,p,d;if(r.nodeType===wysihtml5.ELEMENT_NODE){if(i=r.ownerDocument,s=t[n]||e(n),o=r.style,u=r.currentStyle,f=o[s],f)return f;if(u)try{return u[s]}catch(v){}return l=i.defaultView||i.parentWindow,h=("height"===n||"width"===n)&&"TEXTAREA"===r.nodeName,l.getComputedStyle?(h&&(p=o.overflow,o.overflow="hidden"),d=l.getComputedStyle(r,null).getPropertyValue(n),h&&(o.overflow=p||""),d):void 0}}}}}(),wysihtml5.dom.getTextNodes=function(e,t){var n=[];for(e=e.firstChild;e;e=e.nextSibling)3==e.nodeType?t&&/^\s*$/.test(e.innerText||e.textContent)||n.push(e):n=n.concat(wysihtml5.dom.getTextNodes(e,t));return n},wysihtml5.dom.hasElementWithTagName=function(){function e(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=n++)}var t={},n=1;return function(n,r){var i=e(n)+":"+r,s=t[i];return s||(s=t[i]=n.getElementsByTagName(r)),s.length>0}}(),function(e){function t(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=r++)}var n={},r=1;e.dom.hasElementWithClassName=function(r,i){if(!e.browser.supportsNativeGetElementsByClassName())return!!r.querySelector("."+i);var s=t(r)+":"+i,o=n[s];return o||(o=n[s]=r.getElementsByClassName(i)),o.length>0}}(wysihtml5),wysihtml5.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},wysihtml5.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var n,r,i=t.createElement("style");return i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(t.createTextNode(e)),n=t.querySelector("head link"),n?(n.parentNode.insertBefore(i,n),void 0):(r=t.querySelector("head"),r&&r.appendChild(i),void 0)}}},function(e){e.dom.lineBreaks=function(t){function n(e){return"BR"===e.nodeName}function r(t){return n(t)?!0:"block"===e.dom.getStyle("display").from(t)?!0:!1}return{add:function(){var n=t.ownerDocument,i=e.dom.domNode(t).next({ignoreBlankTexts:!0}),s=e.dom.domNode(t).prev({ignoreBlankTexts:!0});i&&!r(i)&&e.dom.insert(n.createElement("br")).after(t),s&&!r(s)&&e.dom.insert(n.createElement("br")).before(t)},remove:function(){var r=e.dom.domNode(t).next({ignoreBlankTexts:!0}),i=e.dom.domNode(t).prev({ignoreBlankTexts:!0});r&&n(r)&&r.parentNode.removeChild(r),i&&n(i)&&i.parentNode.removeChild(i)}}}}(wysihtml5),wysihtml5.dom.observe=function(e,t,n){t="string"==typeof t?[t]:t;for(var r,i,s=0,o=t.length;o>s;s++)i=t[s],e.addEventListener?e.addEventListener(i,n,!1):(r=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},n.call(e,t)},e.attachEvent("on"+i,r));return{stop:function(){for(var i,s=0,o=t.length;o>s;s++)i=t[s],e.removeEventListener?e.removeEventListener(i,n,!1):e.detachEvent("on"+i,r)}}},wysihtml5.dom.parse=function(e,t){function n(e,t){var n,s,o,u,a,f,l,c,h;for(wysihtml5.lang.object(b).merge(y).merge(t.rules).get(),n=t.context||e.ownerDocument||document,s=n.createDocumentFragment(),o="string"==typeof e,u=!1,t.clearInternals===!0&&(u=!0),a=o?wysihtml5.dom.getAsDom(e,n):e,b.selectors&&i(a,b.selectors);a.firstChild;)l=a.firstChild,f=r(l,t.cleanUp,u,t.uneditableClass),f&&s.appendChild(f),l!==f&&a.removeChild(l);if(t.unjoinNbsps)for(c=wysihtml5.dom.getTextNodes(s),h=c.length;h--;)c[h].nodeValue=c[h].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ");return a.innerHTML="",a.appendChild(s),o?wysihtml5.quirks.getCorrectInnerHTML(a):a}function r(e,t,n,i){var s,o,u,a=e.nodeType,f=e.childNodes,l=f.length,c=v[a],h=0;if(i&&1===a&&wysihtml5.dom.hasClass(e,i))return e;if(o=c&&c(e,n),!o){if(o===!1){for(s=e.ownerDocument.createDocumentFragment(),h=l;h--;)f[h]&&(u=r(f[h],t,n,i),u&&(f[h]===u&&h--,s.insertBefore(u,s.firstChild)));return"block"===wysihtml5.dom.getStyle("display").from(e)&&s.appendChild(e.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(e.nodeName.toLowerCase())&&e.parentNode.lastChild!==e&&(e.nextSibling&&3===e.nextSibling.nodeType&&/^\s/.test(e.nextSibling.nodeValue)||s.appendChild(e.ownerDocument.createTextNode(" "))),s.normalize&&s.normalize(),s}return null}for(h=0;l>h;h++)f[h]&&(u=r(f[h],t,n,i),u&&(f[h]===u&&h--,o.appendChild(u)));if(t&&o.nodeName.toLowerCase()===m&&(!o.childNodes.length||/^\s*$/gi.test(o.innerHTML)&&(n||"_wysihtml5-temp-placeholder"!==e.className&&"rangySelectionBoundary"!==e.className)||!o.attributes.length)){for(s=o.ownerDocument.createDocumentFragment();o.firstChild;)s.appendChild(o.firstChild);return s.normalize&&s.normalize(),s}return o.normalize&&o.normalize(),o}function i(e,t){var n,r,i,s;for(n in t)if(t.hasOwnProperty(n))for(wysihtml5.lang.object(t[n]).isFunction()?r=t[n]:"string"==typeof t[n]&&N[t[n]]&&(r=N[t[n]]),i=e.querySelectorAll(n),s=i.length;s--;)r(i[s])}function s(e,t){var n,r,i,s=b.tags,u=e.nodeName.toLowerCase(),f=e.scopeName;if(e._wysihtml5)return null;if(e._wysihtml5=1,"wysihtml5-temp"===e.className)return null;if(f&&"HTML"!=f&&(u=f+":"+u),"outerHTML"in e&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(u="div")),u in s){if(n=s[u],!n||n.remove)return null;if(n.unwrap)return!1;n="string"==typeof n?{rename_tag:n}:n}else{if(!e.firstChild)return null;n={rename_tag:m}}if(n.one_of_type&&!o(e,b,n.one_of_type,t)){if(!n.remove_action)return null;if("unwrap"===n.remove_action)return!1;if("rename"!==n.remove_action)return null;i=n.remove_action_rename_to||m}return r=e.ownerDocument.createElement(i||n.rename_tag||u),h(e,r,n,t),a(e,r,n),e=null,r.normalize&&r.normalize(),r}function o(e,t,n,r){var i,s;if("SPAN"!==e.nodeName||!!r||"_wysihtml5-temp-placeholder"!==e.className&&"rangySelectionBoundary"!==e.className){for(s in n)if(n.hasOwnProperty(s)&&t.type_definitions&&t.type_definitions[s]&&(i=t.type_definitions[s],u(e,i)))return!0;return!1}return!0}function u(e,t){var n,r,i,s,o,u,a,f,l=e.getAttribute("class"),c=e.getAttribute("style");if(t.methods)for(u in t.methods)if(t.methods.hasOwnProperty(u)&&T[u]&&T[u](e))return!0;if(l&&t.classes)for(l=l.replace(/^\s+/g,"").replace(/\s+$/g,"").split(g),n=l.length,a=0;n>a;a++)if(t.classes[l[a]])return!0;if(c&&t.styles){c=c.split(";");for(r in t.styles)if(t.styles.hasOwnProperty(r))for(f=c.length;f--;)if(o=c[f].split(":"),o[0].replace(/\s/g,"").toLowerCase()===r&&(t.styles[r]===!0||1===t.styles[r]||wysihtml5.lang.array(t.styles[r]).contains(o[1].replace(/\s/g,"").toLowerCase())))return!0}if(t.attrs)for(i in t.attrs)if(t.attrs.hasOwnProperty(i)&&(s=wysihtml5.dom.getAttribute(e,i),"string"==typeof s&&s.search(t.attrs[i])>-1))return!0;return!1}function a(e,t,n){var r,i;if(n&&n.keep_styles)for(r in n.keep_styles)if(n.keep_styles.hasOwnProperty(r)){if(i="float"===r?e.style.styleFloat||e.style.cssFloat:e.style[r],n.keep_styles[r]instanceof RegExp&&!n.keep_styles[r].test(i))continue;"float"===r?t.style[e.style.styleFloat?"styleFloat":"cssFloat"]=i:e.style[r]&&(t.style[r]=i)}}function f(e,t){var n,r=[];for(n in t)t.hasOwnProperty(n)&&0===n.indexOf(e)&&r.push(n);return r}function l(e,t,n,r){var i,s=E[n];return s&&(t||"alt"===e&&"IMG"==r)&&(i=s(t),"string"==typeof i)?i:!1}function c(e,t){var n,r,i,s,o,u=wysihtml5.lang.object(b.attributes||{}).clone(),a=wysihtml5.lang.object(u).merge(wysihtml5.lang.object(t||{}).clone()).get(),c={},h=wysihtml5.dom.getAttributes(e);for(n in a)if(/\*$/.test(n))for(i=f(n.slice(0,-1),h),s=0,o=i.length;o>s;s++)r=l(i[s],h[i[s]],a[n],e.nodeName),r!==!1&&(c[i[s]]=r);else r=l(n,h[n],a[n],e.nodeName),r!==!1&&(c[n]=r);return c}function h(e,t,n,r){var i,s,o,u,a,f={},l=n.set_class,h=n.add_class,p=n.add_style,d=n.set_attributes,v=b.classes,m=0,y=[],w=[],E=[],T=[];if(d&&(f=wysihtml5.lang.object(d).clone()),f=wysihtml5.lang.object(f).merge(c(e,n.check_attributes)).get(),l&&y.push(l),h)for(u in h)a=x[h[u]],a&&(o=a(wysihtml5.dom.getAttribute(e,u)),"string"==typeof o&&y.push(o));if(p)for(u in p)a=S[p[u]],a&&(newStyle=a(wysihtml5.dom.getAttribute(e,u)),"string"==typeof newStyle&&w.push(newStyle));if("string"==typeof v&&"any"===v&&e.getAttribute("class"))if(b.classes_blacklist){for(T=e.getAttribute("class"),T&&(y=y.concat(T.split(g))),i=y.length;i>m;m++)s=y[m],b.classes_blacklist[s]||E.push(s);E.length&&(f["class"]=wysihtml5.lang.array(E).unique().join(" "))}else f["class"]=e.getAttribute("class");else{for(r||(v["_wysihtml5-temp-placeholder"]=1,v._rangySelectionBoundary=1,v["wysiwyg-tmp-selected-cell"]=1),T=e.getAttribute("class"),T&&(y=y.concat(T.split(g))),i=y.length;i>m;m++)s=y[m],v[s]&&E.push(s);E.length&&(f["class"]=wysihtml5.lang.array(E).unique().join(" "))}f["class"]&&r&&(f["class"]=f["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(f["class"])&&delete f["class"]),w.length&&(f.style=wysihtml5.lang.array(w).unique().join(" "));for(u in f)try{t.setAttribute(u,f[u])}catch(N){}f.src&&(void 0!==f.width&&t.setAttribute("width",f.width),void 0!==f.height&&t.setAttribute("height",f.height))}function p(e){var t,n=e.nextSibling;return n&&n.nodeType===wysihtml5.TEXT_NODE?(n.data=e.data.replace(w,"")+n.data.replace(w,""),void 0):(t=e.data.replace(w,""),e.ownerDocument.createTextNode(t))}function d(e){return b.comments?e.ownerDocument.createComment(e.nodeValue):void 0}var v={1:s,3:p,8:d},m="span",g=/\s+/,y={tags:{},classes:{}},b={},w=/\uFEFF/g,E={url:function(){var e=/^https?:\/\//i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),src:function(){var e=/^(\/|https?:\/\/)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),href:function(){var e=/^(#|\/|https?:\/\/|mailto:)/i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t){return t?t.replace(e,""):""}}(),numbers:function(){var e=/\D/g;return function(t){return t=(t||"").replace(e,""),t||null}}(),any:function(){return function(e){return e}}()},S={align_text:function(){var e={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(t){return e[(t+"").toLowerCase()]}}()},x={align_img:function(){var e={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return e[(t+"").toLowerCase()]}}(),align_text:function(){var e={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return e[(t+"").toLowerCase()]}}(),clear_br:function(){var e={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return e[(t+"").toLowerCase()]}}(),size_font:function(){var e={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return e[(t+"").charAt(0)]}}()},T={has_visible_contet:function(){var e,t=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(n){if(e=(n.innerText||n.textContent).replace(/\s/g,""),e&&e.length>0)return!0;for(var r=t.length;r--;)if(n.querySelector(t[r]))return!0;return n.offsetWidth&&n.offsetWidth>0&&n.offsetHeight&&n.offsetHeight>0?!0:!1}}()},N={unwrap:function(e){wysihtml5.dom.unwrap(e)},remove:function(e){e.parentNode.removeChild(e)}};return n(e,t)},wysihtml5.dom.removeEmptyTextNodes=function(e){for(var t,n=wysihtml5.lang.array(e.childNodes).get(),r=n.length,i=0;r>i;i++)t=n[i],t.nodeType===wysihtml5.TEXT_NODE&&""===t.data&&t.parentNode.removeChild(t)},wysihtml5.dom.renameElement=function(e,t){for(var n,r=e.ownerDocument.createElement(t);n=e.firstChild;)r.appendChild(n);return wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(r),e.parentNode.replaceChild(r,e),r},wysihtml5.dom.replaceWithChildNodes=function(e){if(e.parentNode){if(!e.firstChild)return e.parentNode.removeChild(e),void 0;for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null}},function(e){function t(t){return"block"===e.getStyle("display").from(t)}function n(e){return"BR"===e.nodeName}function r(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}function i(e,i){if(e.nodeName.match(/^(MENU|UL|OL)$/)){var s,o,u,a,f,l,h=e.ownerDocument,p=h.createDocumentFragment(),v=wysihtml5.dom.domNode(e).prev({ignoreBlankTexts:!0});if(i)for(!v||t(v)||n(v)||r(p);l=e.firstElementChild||e.firstChild;){for(o=l.lastChild;s=l.firstChild;)u=s===o,a=u&&!t(s)&&!n(s),p.appendChild(s),a&&r(p);l.parentNode.removeChild(l)}else for(;l=e.firstElementChild||e.firstChild;){if(l.querySelector&&l.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6"))for(;s=l.firstChild;)p.appendChild(s);else{for(f=h.createElement("p");s=l.firstChild;)f.appendChild(s);p.appendChild(f)}l.parentNode.removeChild(l)}e.parentNode.replaceChild(p,e)}}e.resolveList=i}(wysihtml5.dom),function(e){var t=document,n=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],r=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],i=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(t,n){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.editableArea=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=t.getElementById(e)),e.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var n=this,r=t.createElement("iframe");return r.className="wysihtml5-sandbox",e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(r),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(r.src="javascript:'<html></html>'"),r.onload=function(){r.onreadystatechange=r.onload=null,n._onLoadIframe(r)},r.onreadystatechange=function(){/loaded|complete/.test(r.readyState)&&(r.onreadystatechange=r.onload=null,n._onLoadIframe(r))},r},_onLoadIframe:function(s){var o,u,f,l,h,p,v;if(e.dom.contains(t.documentElement,s)){if(o=this,u=s.contentWindow,f=s.contentWindow.document,l=t.characterSet||t.charset||"utf-8",h=this._getHtml({charset:l,stylesheets:this.config.stylesheets}),f.open("text/html","replace"),f.write(h),f.close(),this.getWindow=function(){return s.contentWindow},this.getDocument=function(){return s.contentWindow.document},u.onerror=function(e,t,n){throw Error("wysihtml5.Sandbox: "+e,t,n)},!e.browser.supportsSandboxedIframes()){for(p=0,v=n.length;v>p;p++)this._unset(u,n[p]);for(p=0,v=r.length;v>p;p++)this._unset(u,r[p],e.EMPTY_FUNCTION);for(p=0,v=i.length;v>p;p++)this._unset(f,i[p]);this._unset(f,"cookie","",!0)}this.loaded=!0,setTimeout(function(){o.callback(o)},0)}},_getHtml:function(t){var n,r=t.stylesheets,i="",s=0;if(r="string"==typeof r?[r]:r,r)for(n=r.length;n>s;s++)i+='<link rel="stylesheet" href="'+r[s]+'">';return t.stylesheets=i,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,n,r,i){try{t[n]=r}catch(s){}try{t.__defineGetter__(n,function(){return r})}catch(s){}if(i)try{t.__defineSetter__(n,function(){})}catch(s){}if(!e.browser.crashesWhenDefineProperty(n))try{var o={get:function(){return r}};i&&(o.set=function(){}),Object.defineProperty(t,n,o)}catch(s){}}})}(wysihtml5),function(e){var t=document;e.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(t,n,r){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(n).get(),this.element=r?this._bindElement(r):this._createElement()},_createElement:function(){var e=t.createElement("div");return e.className="wysihtml5-sandbox",this._loadElement(e),e},_bindElement:function(e){return e.className=e.className&&""!=e.className?e.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(e,!0),e},_loadElement:function(e,t){var n,r=this;t||(n=this._getHtml(),e.innerHTML=n),this.getWindow=function(){return e.ownerDocument.defaultView},this.getDocument=function(){return e.ownerDocument},this.loaded=!0,setTimeout(function(){r.callback(r)},0)},_getHtml:function(){return""}})}(wysihtml5),function(){var e={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(n){for(var r in t)n.setAttribute(e[r]||r,t[r])}}}}(),wysihtml5.dom.setStyles=function(e){return{on:function(t){var n,r=t.style;if("string"==typeof e)return r.cssText+=";"+e,void 0;for(n in e)"float"===n?(r.cssFloat=e[n],r.styleFloat=e[n]):r[n]=e[n]}}},function(e){e.simulatePlaceholder=function(t,n,r){var i="placeholder",s=function(){var t=n.element.offsetWidth>0&&n.element.offsetHeight>0;n.hasPlaceholderSet()&&(n.clear(),n.element.focus(),t&&setTimeout(function(){var e=n.selection.getSelection();e.focusNode&&e.anchorNode||n.selection.selectNode(n.element.firstChild||n.element)},0)),n.placeholderSet=!1,e.removeClass(n.element,i)},o=function(){n.isEmpty()&&(n.placeholderSet=!0,n.setValue(r),e.addClass(n.element,i))};t.on("set_placeholder",o).on("unset_placeholder",s).on("focus:composer",s).on("paste:composer",s).on("blur:composer",o),o()}}(wysihtml5.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml5.dom),wysihtml5.dom.getAttribute=function(e,t){var n,r,i,s=!wysihtml5.browser.supportsGetAttributeCorrectly();return t=t.toLowerCase(),n=e.nodeName,"IMG"==n&&"src"==t&&wysihtml5.dom.isLoadedImage(e)===!0?e.src:s&&"outerHTML"in e?(r=e.outerHTML.toLowerCase(),i=-1!=r.indexOf(" "+t+"="),i?e.getAttribute(t):null):e.getAttribute(t)},wysihtml5.dom.getAttributes=function(e){var t,n=!wysihtml5.browser.supportsGetAttributeCorrectly(),r=e.nodeName,i=[];for(t in e.attributes)(e.attributes.hasOwnProperty&&e.attributes.hasOwnProperty(t)||!e.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(e.attributes,t))&&e.attributes[t].specified&&("IMG"==r&&"src"==e.attributes[t].name.toLowerCase()&&wysihtml5.dom.isLoadedImage(e)===!0?i.src=e.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(e.attributes[t].name.toLowerCase())&&n?1!==e.attributes[t].value&&(i[e.attributes[t].name]=e.attributes[t].value):i[e.attributes[t].name]=e.attributes[t].value);return i},wysihtml5.dom.isLoadedImage=function(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&"complete"===e.readyState)return!0}},function(e){function t(e,t){var n,r,i,s,o=[];for(r=0,i=e.length;i>r;r++)if(n=e[r].querySelectorAll(t),n)for(s=n.length;s--;o.unshift(n[s]));return o}function n(e){e.parentNode.removeChild(e)}function r(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function i(e,t){for(var n=e.nextSibling;1!=n.nodeType;)if(n=n.nextSibling,!t||t==n.tagName.toLowerCase())return n;return null}var s=e.dom,o=function(e){this.el=e,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},u=function(e,t){e?(this.cell=e,this.table=s.getParentElement(e,{nodeName:["TABLE"]})):t&&(this.table=t,this.cell=this.table.querySelectorAll("th, td")[0])};u.prototype={addSpannedCellToMap:function(e,t,n,r,i,s){var u,a,f=[],l=n+(s?parseInt(s,10)-1:0),c=r+(i?parseInt(i,10)-1:0);for(u=n;l>=u;u++)for(void 0===t[u]&&(t[u]=[]),a=r;c>=a;a++)t[u][a]=new o(e),t[u][a].isColspan=i&&parseInt(i,10)>1,t[u][a].isRowspan=s&&parseInt(s,10)>1,t[u][a].firstCol=a==r,t[u][a].lastCol=a==c,t[u][a].firstRow=u==n,t[u][a].lastRow=u==l,t[u][a].isReal=a==r&&u==n,t[u][a].spanCollection=f,f.push(t[u][a])},setCellAsModified:function(e){if(e.modified=!0,e.spanCollection.length>0)for(var t=0,n=e.spanCollection.length;n>t;t++)e.spanCollection[t].modified=!0},setTableMap:function(){var e,t,n,r,i,u,a,f,l=[],c=this.getTableRows();for(e=0;e<c.length;e++)for(t=c[e],n=this.getRowCells(t),u=0,void 0===l[e]&&(l[e]=[]),r=0;r<n.length;r++){for(i=n[r];void 0!==l[e][u];)u++;a=s.getAttribute(i,"colspan"),f=s.getAttribute(i,"rowspan"),a||f?(this.addSpannedCellToMap(i,l,e,u,a,f),u+=a?parseInt(a,10):1):(l[e][u]=new o(i),u++)}return this.map=l,l},getRowCells:function(n){var r=this.table.querySelectorAll("table"),i=r?t(r,"th, td"):[],s=n.querySelectorAll("th, td"),o=i.length>0?e.lang.array(s).without(i):s;return o},getTableRows:function(){var n=this.table.querySelectorAll("table"),r=n?t(n,"tr"):[],i=this.table.querySelectorAll("tr"),s=r.length>0?e.lang.array(i).without(r):i;return s},getMapIndex:function(e){var t,n,r=this.map.length,i=this.map&&this.map[0]?this.map[0].length:0;for(t=0;r>t;t++)for(n=0;i>n;n++)if(this.map[t][n].el===e)return{row:t,col:n};return!1},getElementAtIndex:function(e){return this.setTableMap(),this.map[e.row]&&this.map[e.row][e.col]&&this.map[e.row][e.col].el?this.map[e.row][e.col].el:null},getMapElsTo:function(e){var t,n,r,i,s,o,u=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(t=this.idx_start,this.idx_start=this.idx_end,this.idx_end=t),this.idx_start.col>this.idx_end.col&&(n=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=n),null!=this.idx_start&&null!=this.idx_end)for(r=this.idx_start.row,i=this.idx_end.row;i>=r;r++)for(s=this.idx_start.col,o=this.idx_end.col;o>=s;s++)u.push(this.map[r][s].el);return u},orderSelectionEnds:function(e){var t,n;return this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(e),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(t=this.idx_start,this.idx_start=this.idx_end,this.idx_end=t),this.idx_start.col>this.idx_end.col&&(n=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=n),{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(e,t,n){var r,i,s,o=this.table.ownerDocument,u=o.createDocumentFragment();for(i=0;t>i;i++){if(r=o.createElement(e),n)for(s in n)n.hasOwnProperty(s)&&r.setAttribute(s,n[s]);r.appendChild(document.createTextNode(" ")),u.appendChild(r)}return u},correctColIndexForUnreals:function(e,t){var n,r,i=this.map[t],s=-1;for(n=0,r=e;e>n;n++)i[n].isReal&&s++;return s},getLastNewCellOnRow:function(e,t){var n,r,i,s,o=this.getRowCells(e);for(i=0,s=o.length;s>i;i++)if(n=o[i],r=this.getMapIndex(n),r===!1||void 0!==t&&r.row!=t)return n;return null},removeEmptyTable:function(){var e=this.table.querySelectorAll("td, th");return e&&0!=e.length?!1:(n(this.table),!0)},splitRowToCells:function(e){var t,n,i;e.isColspan&&(t=parseInt(s.getAttribute(e.el,"colspan")||1,10),n=e.el.tagName.toLowerCase(),t>1&&(i=this.createCells(n,t-1),r(e.el,i)),e.el.removeAttribute("colspan"))},getRealRowEl:function(e,t){var n,r,i=null,o=null;for(t=t||this.idx,n=0,r=this.map[t.row].length;r>n;n++)if(o=this.map[t.row][n],o.isReal&&(i=s.getParentElement(o.el,{nodeName:["TR"]}),i))return i;return null===i&&e&&(i=s.getParentElement(this.map[t.row][t.col].el,{nodeName:["TR"]})||null),i},injectRowAt:function(e,t,n,i,o){var u,a,f=this.getRealRowEl(!1,{row:e,col:t}),l=this.createCells(i,n);f?(u=this.correctColIndexForUnreals(t,e),u>=0?r(this.getRowCells(f)[u],l):f.insertBefore(l,f.firstChild)):(a=this.table.ownerDocument.createElement("tr"),a.appendChild(l),r(s.getParentElement(o.el,{nodeName:["TR"]}),a))},canMerge:function(e){var t,n,r,i,s,o;for(this.to=e,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(t=this.idx_start,this.idx_start=this.idx_end,this.idx_end=t),this.idx_start.col>this.idx_end.col&&(n=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=n),r=this.idx_start.row,i=this.idx_end.row;i>=r;r++)for(s=this.idx_start.col,o=this.idx_end.col;o>=s;s++)if(this.map[r][s].isColspan||this.map[r][s].isRowspan)return!1;return!0},decreaseCellSpan:function(e,t){var n=parseInt(s.getAttribute(e.el,t),10)-1;n>=1?e.el.setAttribute(t,n):(e.el.removeAttribute(t),"colspan"==t&&(e.isColspan=!1),"rowspan"==t&&(e.isRowspan=!1),e.firstCol=!0,e.lastCol=!0,e.firstRow=!0,e.lastRow=!0,e.isReal=!0)},removeSurplusLines:function(){var e,t,r,i,o,u,a,f;if(this.setTableMap(),this.map){for(r=0,i=this.map.length;i>r;r++){for(e=this.map[r],a=!0,o=0,u=e.length;u>o;o++)if(t=e[o],!(s.getAttribute(t.el,"rowspan")&&parseInt(s.getAttribute(t.el,"rowspan"),10)>1&&t.firstRow!==!0)){a=!1;break}if(a)for(o=0;u>o;o++)this.decreaseCellSpan(e[o],"rowspan")}for(f=this.getTableRows(),r=0,i=f.length;i>r;r++)e=f[r],0==e.childNodes.length&&/^\s*$/.test(e.textContent||e.innerText)&&n(e)}},fillMissingCells:function(){var e,t,n,i=0,s=0,u=null;if(this.setTableMap(),this.map){for(i=this.map.length,e=0;i>e;e++)this.map[e].length>s&&(s=this.map[e].length);for(t=0;i>t;t++)for(n=0;s>n;n++)this.map[t]&&!this.map[t][n]&&n>0&&(this.map[t][n]=new o(this.createCells("td",1)),u=this.map[t][n-1],u&&u.el&&u.el.parent&&r(this.map[t][n-1].el,this.map[t][n].el))}},rectify:function(){return this.removeEmptyTable()?!1:(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){var e,t,n,r,i,o;if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){if(e=this.map[this.idx.row][this.idx.col],t=s.getAttribute(e.el,"colspan")?parseInt(s.getAttribute(e.el,"colspan"),10):1,n=e.el.tagName.toLowerCase(),e.isRowspan){if(r=parseInt(s.getAttribute(e.el,"rowspan"),10),r>1)for(i=1,o=r-1;o>=i;i++)this.injectRowAt(this.idx.row+i,this.idx.col,t,n,e);e.el.removeAttribute("rowspan")}this.splitRowToCells(e)}},merge:function(e){var t,r,i,s,o,u;if(this.rectify())if(this.canMerge(e)){for(t=this.idx_end.row-this.idx_start.row+1,r=this.idx_end.col-this.idx_start.col+1,i=this.idx_start.row,s=this.idx_end.row;s>=i;i++)for(o=this.idx_start.col,u=this.idx_end.col;u>=o;o++)i==this.idx_start.row&&o==this.idx_start.col?(t>1&&this.map[i][o].el.setAttribute("rowspan",t),r>1&&this.map[i][o].el.setAttribute("colspan",r)):(/^\s*<br\/?>\s*$/.test(this.map[i][o].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[i][o].el.innerHTML),n(this.map[i][o].el));this.rectify()}else window.console&&void 0},collapseCellToNextRow:function(e){var t,n,i,o=this.getMapIndex(e.el),u=o.row+1,a={row:u,col:o.col};u<this.map.length&&(t=this.getRealRowEl(!1,a),null!==t&&(n=this.correctColIndexForUnreals(a.col,a.row),n>=0?r(this.getRowCells(t)[n],e.el):(i=this.getLastNewCellOnRow(t,u),null!==i?r(i,e.el):t.insertBefore(e.el,t.firstChild)),parseInt(s.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(s.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")))},removeRowCell:function(e){e.isReal?e.isRowspan?this.collapseCellToNextRow(e):n(e.el):parseInt(s.getAttribute(e.el,"rowspan"),10)>2?e.el.setAttribute("rowspan",parseInt(s.getAttribute(e.el,"rowspan"),10)-1):e.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var e,t,n,r=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(e=this.map[this.idx.row],t=0,n=e.length;n>t;t++)e[t].isReal&&r.push(e[t].el);return r},getColumnElementsByCell:function(){var e,t,n=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(e=0,t=this.map.length;t>e;e++)this.map[e][this.idx.col]&&this.map[e][this.idx.col].isReal&&n.push(this.map[e][this.idx.col].el);return n},removeRow:function(){var e,t,r,i=s.getParentElement(this.cell,{nodeName:["TR"]});if(i){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(e=this.map[this.idx.row],t=0,r=e.length;r>t;t++)e[t].modified||(this.setCellAsModified(e[t]),this.removeRowCell(e[t]));n(i)}},removeColCell:function(e){e.isColspan?parseInt(s.getAttribute(e.el,"colspan"),10)>2?e.el.setAttribute("colspan",parseInt(s.getAttribute(e.el,"colspan"),10)-1):e.el.removeAttribute("colspan"):e.isReal&&n(e.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1)for(var e=0,t=this.map.length;t>e;e++)this.map[e][this.idx.col].modified||(this.setCellAsModified(this.map[e][this.idx.col]),this.removeColCell(this.map[e][this.idx.col]))},remove:function(e){if(this.rectify()){switch(e){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(e){var t,n,i,o,u,a=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==e&&s.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(s.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(t=this.map[this.idx.row],n=a.createElement("tr"),i=0,o=t.length;o>i;i++)t[i].modified||(this.setCellAsModified(t[i]),this.addRowCell(t[i],n,e));switch(e){case"below":r(this.getRealRowEl(!0),n);break;case"above":u=s.getParentElement(this.map[this.idx.row][this.idx.col].el,{nodeName:["TR"]}),u&&u.parentNode.insertBefore(n,u)}}},addRowCell:function(e,t,n){var r=e.isColspan?{colspan:s.getAttribute(e.el,"colspan")}:null;e.isReal?"above"!=n&&e.isRowspan?e.el.setAttribute("rowspan",parseInt(s.getAttribute(e.el,"rowspan"),10)+1):t.appendChild(this.createCells("td",1,r)):"above"!=n&&e.isRowspan&&e.lastRow?t.appendChild(this.createCells("td",1,r)):c.isRowspan&&e.el.attr("rowspan",parseInt(s.getAttribute(e.el,"rowspan"),10)+1)},add:function(e){this.rectify()&&(("below"==e||"above"==e)&&this.addRow(e),("before"==e||"after"==e)&&this.addColumn(e))},addColCell:function(e,t,n){var i,o=e.el.tagName.toLowerCase();switch(n){case"before":i=!e.isColspan||e.firstCol;break;case"after":i=!e.isColspan||e.lastCol||e.isColspan&&c.el==this.cell}if(i){switch(n){case"before":e.el.parentNode.insertBefore(this.createCells(o,1),e.el);break;case"after":r(e.el,this.createCells(o,1))}e.isRowspan&&this.handleCellAddWithRowspan(e,t+1,n)}else e.el.setAttribute("colspan",parseInt(s.getAttribute(e.el,"colspan"),10)+1)},addColumn:function(e){var t,n,r,i;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==e&&s.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(s.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1)for(r=0,i=this.map.length;i>r;r++)t=this.map[r],t[this.idx.col]&&(n=t[this.idx.col],n.modified||(this.setCellAsModified(n),this.addColCell(n,r,e)))},handleCellAddWithRowspan:function(e,t,n){var o,u,a,l,c=parseInt(s.getAttribute(this.cell,"rowspan"),10)-1,h=s.getParentElement(e.el,{nodeName:["TR"]}),p=e.el.tagName.toLowerCase(),d=this.table.ownerDocument;for(l=0;c>l;l++)if(o=this.correctColIndexForUnreals(this.idx.col,t+l),h=i(h,"tr"),h)if(o>0)switch(n){case"before":u=this.getRowCells(h),o>0&&this.map[t+l][this.idx.col].el!=u[o]&&o==u.length-1?r(u[o],this.createCells(p,1)):u[o].parentNode.insertBefore(this.createCells(p,1),u[o]);break;case"after":r(this.getRowCells(h)[o],this.createCells(p,1))}else h.insertBefore(this.createCells(p,1),h.firstChild);else a=d.createElement("tr"),a.appendChild(this.createCells(p,1)),this.table.appendChild(a)}},s.table={getCellsBetween:function(e,t){var n=new u(e);return n.getMapElsTo(t)},addCells:function(e,t){var n=new u(e);n.add(t)},removeCells:function(e,t){var n=new u(e);n.remove(t)},mergeCellsBetween:function(e,t){var n=new u(e);n.merge(t)},unmergeCell:function(e){var t=new u(e);t.unmerge()},orderSelectionEnds:function(e,t){var n=new u(e);return n.orderSelectionEnds(t)},indexOf:function(e){var t=new u(e);return t.setTableMap(),t.getMapIndex(e)},findCell:function(e,t){var n=new u(null,e);return n.getElementAtIndex(t)},findRowByCell:function(e){var t=new u(e);return t.getRowElementsByCell()},findColumnByCell:function(e){var t=new u(e);return t.getColumnElementsByCell()},canMerge:function(e,t){var n=new u(e);return n.canMerge(t)}}}(wysihtml5),wysihtml5.dom.query=function(e,t){var n,r,i,s,o=[];for(e.nodeType&&(e=[e]),r=0,i=e.length;i>r;r++)if(n=e[r].querySelectorAll(t),n)for(s=n.length;s--;o.unshift(n[s]));return o},wysihtml5.dom.compareDocumentPosition=function(){var e=document.documentElement;return e.compareDocumentPosition?function(e,t){return e.compareDocumentPosition(t)}:function(e,t){var n,r,i,s,o,u,a,f,l;if(n=9===e.nodeType?e:e.ownerDocument,r=9===t.nodeType?t:t.ownerDocument,e===t)return 0;if(e===t.ownerDocument)return 20;if(e.ownerDocument===t)return 10;if(n!==r)return 1;if(2===e.nodeType&&e.childNodes&&-1!==wysihtml5.lang.array(e.childNodes).indexOf(t))return 20;if(2===t.nodeType&&t.childNodes&&-1!==wysihtml5.lang.array(t.childNodes).indexOf(e))return 10;for(i=e,s=[],o=null;i;){if(i==t)return 10;s.push(i),i=i.parentNode}for(i=t,o=null;i;){if(i==e)return 20;if(u=wysihtml5.lang.array(s).indexOf(i),-1!==u)return a=s[u],f=wysihtml5.lang.array(a.childNodes).indexOf(s[u-1]),l=wysihtml5.lang.array(a.childNodes).indexOf(o),f>l?2:4;o=i,i=i.parentNode}return 1}}(),wysihtml5.dom.unwrap=function(e){if(e.parentNode){for(;e.lastChild;)wysihtml5.dom.insert(e.lastChild).after(e);e.parentNode.removeChild(e)}},wysihtml5.dom.getPastedHtml=function(e){var t;return e.clipboardData&&(wysihtml5.lang.array(e.clipboardData.types).contains("text/html")?t=e.clipboardData.getData("text/html"):wysihtml5.lang.array(e.clipboardData.types).contains("text/plain")&&(t=wysihtml5.lang.string(e.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),t},wysihtml5.dom.getPastedHtmlWithDiv=function(e,t){var n=e.selection.getBookmark(),r=e.element.ownerDocument,i=r.createElement("DIV");r.body.appendChild(i),i.style.width="1px",i.style.height="1px",i.style.overflow="hidden",i.setAttribute("contenteditable","true"),i.focus(),setTimeout(function(){e.selection.setBookmark(n),t(i.innerHTML),i.parentNode.removeChild(i)},0)},wysihtml5.quirks.cleanPastedHTML=function(){var e=function(e){var t=wysihtml5.lang.string(e).trim(),n=t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return RegExp("^((?!^"+n+"$).)*$","i")},t=function(t,n){var r,i,s=wysihtml5.lang.object(t).clone(!0);for(r in s.tags)if(s.tags.hasOwnProperty(r)&&s.tags[r].keep_styles)for(i in s.tags[r].keep_styles)s.tags[r].keep_styles.hasOwnProperty(i)&&n[i]&&(s.tags[r].keep_styles[i]=e(n[i]));return s},n=function(e,t){var n,r,i;if(!e)return null;for(r=0,i=e.length;i>r;r++)if(e[r].condition||(n=e[r].set),e[r].condition&&e[r].condition.test(t))return e[r].set;return n};return function(e,r){var i,s={color:wysihtml5.dom.getStyle("color").from(r.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(r.referenceNode)},o=t(n(r.rules,e)||{},s);return i=wysihtml5.dom.parse(e,{rules:o,cleanUp:!0,context:r.referenceNode.ownerDocument,uneditableClass:r.uneditableClass,clearInternals:!0,unjoinNbsps:!0}),i}}(),wysihtml5.quirks.ensureProperClearing=function(){var e=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();("<p>&nbsp;</p>"==t||"<p>&nbsp;</p><p>&nbsp;</p>"==t)&&(e.innerHTML="")},0)};return function(t){wysihtml5.dom.observe(t.element,["cut","keydown"],e)}}(),function(e){var t="%7E";e.quirks.getCorrectInnerHTML=function(n){var r,i,s,o,u,f=n.innerHTML;if(-1===f.indexOf(t))return f;for(r=n.querySelectorAll("[href*='~'], [src*='~']"),u=0,o=r.length;o>u;u++)i=r[u].href||r[u].src,s=e.lang.string(i).replace("~").by(t),f=e.lang.string(f).replace(s).by(i);return f}}(wysihtml5),function(e){var t="wysihtml5-quirks-redraw";e.quirks.redraw=function(n){e.dom.addClass(n,t),e.dom.removeClass(n,t);try{var r=n.ownerDocument;r.execCommand("italic",!1,null),r.execCommand("italic",!1,null)}catch(i){}}}(wysihtml5),wysihtml5.quirks.tableCellsSelection=function(e,t){function n(){return l.observe(e,"mousedown",function(e){var t=wysihtml5.dom.getParentElement(e.target,{nodeName:["TD","TH"]});t&&r(t)}),c}function r(n){c.start=n,c.end=n,c.cells=[n],c.table=l.getParentElement(c.start,{nodeName:["TABLE"]}),c.table&&(i(),l.addClass(n,h),p=l.observe(e,"mousemove",o),d=l.observe(e,"mouseup",u),t.fire("tableselectstart").fire("tableselectstart:composer"))}function i(){var t,n;if(e&&(t=e.querySelectorAll("."+h),t.length>0))for(n=0;n<t.length;n++)l.removeClass(t[n],h)}function s(e){for(var t=0;t<e.length;t++)l.addClass(e[t],h)}function o(e){var n,r=null,o=l.getParentElement(e.target,{nodeName:["TD","TH"]});o&&c.table&&c.start&&(r=l.getParentElement(o,{nodeName:["TABLE"]}),r&&r===c.table&&(i(),n=c.end,c.end=o,c.cells=l.table.getCellsBetween(c.start,o),c.cells.length>1&&t.composer.selection.deselect(),s(c.cells),c.end!==n&&t.fire("tableselectchange").fire("tableselectchange:composer")))}function u(){p.stop(),d.stop(),t.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){a()},0)}function a(){var n=l.observe(e.ownerDocument,"click",function(e){n.stop(),l.getParentElement(e.target,{nodeName:["TABLE"]})!=c.table&&(i(),c.table=null,c.start=null,c.end=null,t.fire("tableunselect").fire("tableunselect:composer"))})}function f(e,n){c.start=e,c.end=n,c.table=l.getParentElement(c.start,{nodeName:["TABLE"]}),selectedCells=l.table.getCellsBetween(c.start,c.end),s(selectedCells),a(),t.fire("tableselect").fire("tableselect:composer")}var l=wysihtml5.dom,c={table:null,start:null,end:null,cells:null,select:f},h="wysiwyg-tmp-selected-cell",p=null,d=null;return n()},function(e){var t=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,n=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,r=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,i=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,s=function(e){return RegExp("(^|\\s|;)"+e+"\\s*:\\s*[^;$]+","gi")};e.quirks.styleParser={parseColor:function(o,u){var l,h,p,v=s(u),m=o.match(v),g=10;if(m){for(p=m.length;p--;)m[p]=e.lang.string(m[p].split(":")[1]).trim();if(l=m[m.length-1],t.test(l))h=l.match(t);else if(n.test(l))h=l.match(n);else if(r.test(l))h=l.match(r),g=16;else if(i.test(l))return h=l.match(i),h.shift(),h.push(1),e.lang.array(h).map(function(e,t){return 3>t?16*parseInt(e,16)+parseInt(e,16):parseFloat(e)});if(h)return h.shift(),h[3]||h.push(1),e.lang.array(h).map(function(e,t){return 3>t?parseInt(e,g):parseFloat(e)})}return!1},unparseColor:function(e,t){if(t){if("hex"==t)return e[0].toString(16).toUpperCase()+e[1].toString(16).toUpperCase()+e[2].toString(16).toUpperCase();if("hash"==t)return"#"+e[0].toString(16).toUpperCase()+e[1].toString(16).toUpperCase()+e[2].toString(16).toUpperCase();if("rgb"==t)return"rgb("+e[0]+","+e[1]+","+e[2]+")";if("rgba"==t)return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")";if("csv"==t)return e[0]+","+e[1]+","+e[2]+","+e[3]}return e[3]&&1!==e[3]?"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")":"rgb("+e[0]+","+e[1]+","+e[2]+")"},parseFontSize:function(t){var n=t.match(s("font-size"));return n?e.lang.string(n[n.length-1].split(":")[1]).trim():!1}}}(wysihtml5),function(e){function t(e){var t=0;if(e.parentNode)do t+=e.offsetTop||0,e=e.offsetParent;while(e);return t}function n(e,t){for(var n=0;t!==e;)if(n++,t=t.parentNode,!t)throw Error("not a descendant of ancestor!");return n}function r(e){if(!e.canSurroundContents())for(var t=e.commonAncestorContainer,r=n(t,e.startContainer),i=n(t,e.endContainer);!e.canSurroundContents();)r>i?(e.setStartBefore(e.startContainer),r=n(t,e.startContainer)):(e.setEndAfter(e.endContainer),i=n(t,e.endContainer))}var i=e.dom;e.Selection=Base.extend({constructor:function(e,t,n){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc,this.contain=t,this.unselectableClass=n||!1},getBookmark:function(){var e=this.getRange();return e&&r(e),e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},setAfter:function(e){var t=rangy.createRange(this.doc);return t.setStartAfter(e),t.setEndAfter(e),this.setSelection(t)},selectNode:function(t,n){var r=rangy.createRange(this.doc),s=t.nodeType===e.ELEMENT_NODE,o="canHaveHTML"in t?t.canHaveHTML:"IMG"!==t.nodeName,u=s?t.innerHTML:t.data,f=""===u||u===e.INVISIBLE_SPACE,l=i.getStyle("display").from(t),c="block"===l||"list-item"===l;if(f&&s&&o&&!n)try{t.innerHTML=e.INVISIBLE_SPACE}catch(h){}o?r.selectNodeContents(t):r.selectNode(t),o&&f&&s?r.collapse(c):o&&f&&(r.setStartAfter(t),r.setEndAfter(t)),this.setSelection(r)},getSelectedNode:function(e){var t,n;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(n=this.doc.selection.createRange(),n&&n.length)?n.item(0):(t=this.getSelection(this.doc),t.focusNode===t.anchorNode?t.focusNode:(n=this.getRange(this.doc),n?n.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var e=this.getRange();r(e),this.setSelection(e)},getSelectedOwnNodes:function(){var e,t,n=this.getOwnRanges(),r=[];for(e=0,t=n.length;t>e;e++)r.push(n[e].commonAncestorContainer||this.doc.body);return r},findNodesInSelection:function(t){var n,r,i,s=this.getOwnRanges(),o=[];for(r=0,i=s.length;i>r;r++)n=s[r].getNodes([1],function(n){return e.lang.array(t).contains(n.nodeName)}),o=o.concat(n);return o},containsUneditable:function(){var e,t,n=this.getOwnUneditables(),r=this.getSelection();for(e=0,t=n.length;t>e;e++)if(r.containsNode(n[e]))return!0;return!1},deleteContents:function(){var e,t=this.getOwnRanges();for(e=t.length;e--;)t[e].deleteContents();this.setSelection(t[0])},getPreviousNode:function(t,n){var r,i,s;return t||(r=this.getSelection(),t=r.anchorNode),t===this.contain?!1:(i=t.previousSibling,i===this.contain?!1:(i&&3!==i.nodeType&&1!==i.nodeType?i=this.getPreviousNode(i,n):i&&3===i.nodeType&&/^\s*$/.test(i.textContent)?i=this.getPreviousNode(i,n):n&&i&&1===i.nodeType&&!e.lang.array(["BR","HR","IMG"]).contains(i.nodeName)&&/^[\s]*$/.test(i.innerHTML)?i=this.getPreviousNode(i,n):i||t===this.contain||(s=t.parentNode,s!==this.contain&&(i=this.getPreviousNode(s,n))),i!==this.contain?i:!1))},getSelectionParentsByTag:function(){var t,n,r,i=this.getSelectedOwnNodes(),s=[];for(n=0,r=i.length;r>n;n++)t=i[n].nodeName&&"LI"===i[n].nodeName?i[n]:e.dom.getParentElement(i[n],{nodeName:["LI"]},!1,this.contain),t&&s.push(t);return s.length?s:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var e=this.getRange(),t=e.startContainer,n=e.startOffset,r=rangy.createRange(this.doc);return r.selectNodeContents(t),r.setStart(t,n),r}},caretIsLastInSelection:function(){var e=(rangy.createRange(this.doc),this.getSelection(),this.getRangeToNodeEnd().cloneContents()),t=e.textContent;return/^\s*$/.test(t)},caretIsFirstInSelection:function(){var t=rangy.createRange(this.doc),n=this.getSelection(),r=this.getRange(),i=r.startContainer;return i.nodeType===e.TEXT_NODE?this.isCollapsed()&&i.nodeType===e.TEXT_NODE&&/^\s*$/.test(i.data.substr(0,r.startOffset)):(t.selectNodeContents(this.getRange().commonAncestorContainer),t.collapse(!0),this.isCollapsed()&&(t.startContainer===n.anchorNode||t.endContainer===n.anchorNode)&&t.startOffset===n.anchorOffset)},caretIsInTheBeginnig:function(t){var n=this.getSelection(),r=n.anchorNode,i=n.anchorOffset;return t?0===i&&(r.nodeName&&r.nodeName===t.toUpperCase()||e.dom.getParentElement(r.parentNode,{nodeName:t},1)):0===i&&!this.getPreviousNode(r,!0)},caretIsBeforeUneditable:function(){var e,t,n,r,i=this.getSelection(),s=i.anchorNode,o=i.anchorOffset;if(0===o&&(e=this.getPreviousNode(s,!0),e))for(t=this.getOwnUneditables(),n=0,r=t.length;r>n;n++)if(e===t[n])return t[n];return!1},executeAndRestoreRangy:function(e){var t=this.doc.defaultView||this.doc.parentWindow,n=rangy.saveSelection(t);if(n)try{e()}catch(r){setTimeout(function(){throw r},0)}else e();rangy.restoreSelection(n)},executeAndRestore:function(t,n){var r,s,o,u,f,l,c,h,p,d=this.doc.body,v=n&&d.scrollTop,m=n&&d.scrollLeft,g="_wysihtml5-temp-placeholder",y='<span class="'+g+'">'+e.INVISIBLE_SPACE+"</span>",b=this.getRange(!0);if(!b)return t(d,d),void 0;b.collapsed||(c=b.cloneRange(),l=c.createContextualFragment(y),c.collapse(!1),c.insertNode(l),c.detach()),f=b.createContextualFragment(y),b.insertNode(f),l&&(r=this.contain.querySelectorAll("."+g),b.setStartBefore(r[0]),b.setEndAfter(r[r.length-1])),this.setSelection(b);try{t(b.startContainer,b.endContainer)}catch(w){setTimeout(function(){throw w},0)}if(r=this.contain.querySelectorAll("."+g),r&&r.length)for(h=rangy.createRange(this.doc),o=r[0].nextSibling,r.length>1&&(u=r[r.length-1].previousSibling),u&&o?(h.setStartBefore(o),h.setEndAfter(u)):(s=this.doc.createTextNode(e.INVISIBLE_SPACE),i.insert(s).after(r[0]),h.setStartBefore(s),h.setEndAfter(s)),this.setSelection(h),p=r.length;p--;)r[p].parentNode.removeChild(r[p]);else this.contain.focus();n&&(d.scrollTop=v,d.scrollLeft=m);try{r.parentNode.removeChild(r)}catch(E){}},set:function(e,t){var n=rangy.createRange(this.doc);n.setStart(e,t||0),this.setSelection(n)},insertHTML:function(e){var t,n=(rangy.createRange(this.doc),this.doc.createElement("DIV")),r=this.doc.createDocumentFragment();for(n.innerHTML=e,t=n.lastChild;n.firstChild;)r.appendChild(n.firstChild);this.insertNode(r),t&&this.setAfter(t)},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},surround:function(e){var t,n,r=this.getOwnRanges(),i=[];if(0==r.length)return i;for(n=r.length;n--;){t=this.doc.createElement(e.nodeName),i.push(t),e.className&&(t.className=e.className),e.cssStyle&&t.setAttribute("style",e.cssStyle);try{r[n].surroundContents(t),this.selectNode(t)}catch(s){t.appendChild(r[n].extractContents()),r[n].insertNode(t)}}return i},deblockAndSurround:function(t){var n,r,i,s=this.doc.createElement("div"),o=rangy.createRange(this.doc);if(s.className=t.className,this.composer.commands.exec("formatBlock",t.nodeName,t.className),n=this.contain.querySelectorAll("."+t.className),n[0])for(n[0].parentNode.insertBefore(s,n[0]),o.setStartBefore(n[0]),o.setEndAfter(n[n.length-1]),r=o.extractContents();r.firstChild;)if(i=r.firstChild,1==i.nodeType&&e.dom.hasClass(i,t.className)){for(;i.firstChild;)s.appendChild(i.firstChild);"BR"!==i.nodeName&&s.appendChild(this.doc.createElement("br")),r.removeChild(i)}else s.appendChild(i);else s=null;return s},scrollIntoView:function(){var n,r=this.doc,i=5,s=r.documentElement.scrollHeight>r.documentElement.offsetHeight,o=r._wysihtml5ScrollIntoViewElement=r._wysihtml5ScrollIntoViewElement||function(){var t=r.createElement("span");return t.innerHTML=e.INVISIBLE_SPACE,t}();s&&(this.insertNode(o),n=t(o),o.parentNode.removeChild(o),n>=r.body.scrollTop+r.documentElement.offsetHeight-i&&(r.body.scrollTop=n))},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var e=this.doc.defaultView,t=e.getSelection();t.modify("move","left","lineboundary"),t.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var e,t,n,r,i,s=this.doc.selection.createRange(),o=s.boundingTop,u=this.doc.body.scrollWidth;if(s.moveToPoint){for(0===o&&(n=this.doc.createElement("span"),this.insertNode(n),o=n.offsetTop,n.parentNode.removeChild(n)),o+=1,r=-10;u>r;r+=2)try{s.moveToPoint(r,o);break}catch(a){}for(e=o,t=this.doc.selection.createRange(),i=u;i>=0;i--)try{t.moveToPoint(i,e);break}catch(f){}s.setEndPoint("EndToEnd",t),s.select()}},getText:function(){var e=this.getSelection();return e?""+e:""},getNodes:function(e,t){var n=this.getRange();return n?n.getNodes([e],t):[]},fixRangeOverflow:function(e){var t,n;this.contain&&this.contain.firstChild&&e&&(t=e.compareNode(this.contain),2!==t?(1===t&&e.setStartBefore(this.contain.firstChild),0===t&&e.setEndAfter(this.contain.lastChild),3===t&&(e.setStartBefore(this.contain.firstChild),e.setEndAfter(this.contain.lastChild))):this._detectInlineRangeProblems(e)&&(n=e.endContainer.previousElementSibling,n&&e.setEnd(n,this._endOffsetForNode(n))))},_endOffsetForNode:function(e){var t=document.createRange();return t.selectNodeContents(e),t.endOffset},_detectInlineRangeProblems:function(e){var t=i.compareDocumentPosition(e.startContainer,e.endContainer);return 0==e.endOffset&&4&t},getRange:function(e){var t=this.getSelection(),n=t&&t.rangeCount&&t.getRangeAt(0);return e!==!0&&this.fixRangeOverflow(n),n},getOwnUneditables:function(){var t=i.query(this.contain,"."+this.unselectableClass),n=i.query(t,"."+this.unselectableClass);return e.lang.array(t).without(n)},getOwnRanges:function(){var e,t,n,r,i,s,o,u=[],a=this.getRange();if(a&&u.push(a),this.unselectableClass&&this.contain&&a&&(t=this.getOwnUneditables(),t.length>0))for(r=0,i=t.length;i>r;r++)for(e=[],s=0,o=u.length;o>s;s++){if(u[s])switch(u[s].compareNode(t[r])){case 2:break;case 3:n=u[s].cloneRange(),n.setEndBefore(t[r]),e.push(n),n=u[s].cloneRange(),n.setStartAfter(t[r]),e.push(n);break;default:e.push(u[s])}u=e}return u},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(e){var t=this.doc.defaultView||this.doc.parentWindow,n=rangy.getSelection(t);return n.setSingleRange(e)},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},isEndToEndInNode:function(t){var n=this.getRange(),r=n.commonAncestorContainer,i=n.startContainer,s=n.endContainer;if(r.nodeType===e.TEXT_NODE&&(r=r.parentNode),i.nodeType===e.TEXT_NODE&&!/^\s*$/.test(i.data.substr(n.startOffset)))return!1;if(s.nodeType===e.TEXT_NODE&&!/^\s*$/.test(s.data.substr(n.endOffset)))return!1;for(;i&&i!==r;){if(i.nodeType!==e.TEXT_NODE&&!e.dom.contains(r,i))return!1;if(e.dom.domNode(i).prev({ignoreBlankTexts:!0}))return!1;i=i.parentNode}for(;s&&s!==r;){if(s.nodeType!==e.TEXT_NODE&&!e.dom.contains(r,s))return!1;if(e.dom.domNode(s).next({ignoreBlankTexts:!0}))return!1;s=s.parentNode}return e.lang.array(t).contains(r.nodeName)?r:!1},deselect:function(){var e=this.getSelection();e&&e.removeAllRanges()}})}(wysihtml5),function(e,t){function n(e,t,n){if(!e.className)return!1;var r=e.className.match(n)||[];return r[r.length-1]===t}function r(e,t){return!e.getAttribute||!e.getAttribute("style")?!1:(e.getAttribute("style").match(t),e.getAttribute("style").match(t)?!0:!1)}function i(e,t,n){e.getAttribute("style")?(u(e,n),e.getAttribute("style")&&!/^\s*$/.test(e.getAttribute("style"))?e.setAttribute("style",t+";"+e.getAttribute("style")):e.setAttribute("style",t)):e.setAttribute("style",t)}function s(e,t,n){e.className?(o(e,n),e.className+=" "+t):e.className=t}function o(e,t){e.className&&(e.className=e.className.replace(t,""))}function u(e,t){var n,r,i=[];if(e.getAttribute("style")){for(n=e.getAttribute("style").split(";"),r=n.length;r--;)n[r].match(t)||/^\s*$/.test(n[r])||i.push(n[r]);i.length?e.setAttribute("style",i.join(";")):e.removeAttribute("style")}}function a(e,t){var n,r,i,s=[],o=t.split(";"),u=e.getAttribute("style");if(u){for(u=u.replace(/\s/gi,"").toLowerCase(),s.push(RegExp("(^|\\s|;)"+t.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi")),n=o.length;n-->0;)/^\s*$/.test(o[n])||s.push(RegExp("(^|\\s|;)"+o[n].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"));for(r=0,i=s.length;i>r;r++)if(u.match(s[r]))return s[r]}return!1}function f(n,r,i,s){return i?a(n,i):s?e.dom.hasClass(n,s):t.dom.arrayContains(r,n.tagName.toLowerCase())}function l(e,t,n,r){for(var i=e.length;i--;)if(!f(e[i],t,n,r))return!1;return e.length?!0:!1}function c(e,t,n){var r=a(e,t);return r?(u(e,r),"remove"):(i(e,t,n),"change")}function h(e,t){return e.className.replace(w," ")==t.className.replace(w," ")}function p(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}function d(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,r,i,s=0,o=e.attributes.length;o>s;++s)if(n=e.attributes[s],i=n.name,"class"!=i){if(r=t.attributes.getNamedItem(i),n.specified!=r.specified)return!1;if(n.specified&&n.nodeValue!==r.nodeValue)return!1}return!0}function v(e,n){return t.dom.isCharacterDataNode(e)?0==n?!!e.previousSibling:n==e.length?!!e.nextSibling:!0:n>0&&n<e.childNodes.length}function m(e,n,r,i){var s,o;if(t.dom.isCharacterDataNode(n)&&(0==r?(r=t.dom.getNodeIndex(n),n=n.parentNode):r==n.length?(r=t.dom.getNodeIndex(n)+1,n=n.parentNode):s=t.dom.splitDataNode(n,r)),!(s||i&&n===i)){for(s=n.cloneNode(!1),s.id&&s.removeAttribute("id");o=n.childNodes[r];)s.appendChild(o);t.dom.insertAfter(s,n)}return n==e?s:m(e,s.parentNode,t.dom.getNodeIndex(s),i)}function g(t){this.isElementMerge=t.nodeType==e.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function y(e,t,n,r,i,s,o){this.tagNames=e||[b],this.cssClass=t||(t===!1?!1:""),this.similarClassRegExp=n,this.cssStyle=i||"",this.similarStyleRegExp=s,this.normalize=r,this.applyToAnyTagName=!1,this.container=o}var b="span",w=/\s+/g;g.prototype={doMerge:function(){var e,t,n,r,i,s=[];for(r=0,i=this.textNodes.length;i>r;++r)e=this.textNodes[r],t=e.parentNode,s[r]=e.data,r&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=n=s.join(""),n},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){var e,t,n=[];for(e=0,t=this.textNodes.length;t>e;++e)n[e]="'"+this.textNodes[e].data+"'";return"[Merge("+n.join(",")+")]"}},y.prototype={getAncestorWithClass:function(r){for(var i;r;){if(i=this.cssClass?n(r,this.cssClass,this.similarClassRegExp):""!==this.cssStyle?!1:!0,r.nodeType==e.ELEMENT_NODE&&"false"!=r.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,r.tagName.toLowerCase())&&i)return r;r=r.parentNode}return!1},getAncestorWithStyle:function(n){for(var i;n;){if(i=this.cssStyle?r(n,this.similarStyleRegExp):!1,n.nodeType==e.ELEMENT_NODE&&"false"!=n.getAttribute("contenteditable")&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&i)return n;n=n.parentNode}return!1},getMatchingAncestor:function(e){var t=this.getAncestorWithClass(e),n=!1;return t?this.cssStyle&&(n="class"):(t=this.getAncestorWithStyle(e),t&&(n="style")),{element:t,type:n}},postApply:function(e,t){var n,r,i,s,o,u,a=e[0],f=e[e.length-1],l=[],c=a,h=f,p=0,d=f.length;for(s=0,o=e.length;o>s;++s)r=e[s],i=null,r&&r.parentNode&&(i=this.getAdjacentMergeableTextNode(r.parentNode,!1)),i?(n||(n=new g(i),l.push(n)),n.textNodes.push(r),r===a&&(c=n.firstTextNode,p=c.length),r===f&&(h=n.firstTextNode,d=n.getLength())):n=null;if(f&&f.parentNode&&(u=this.getAdjacentMergeableTextNode(f.parentNode,!0),u&&(n||(n=new g(f),l.push(n)),n.textNodes.push(u))),l.length){for(s=0,o=l.length;o>s;++s)l[s].doMerge();t.setStart(c,p),t.setEnd(h,d)}},getAdjacentMergeableTextNode:function(t,n){var r,i=t.nodeType==e.TEXT_NODE,s=i?t.parentNode:t,o=n?"nextSibling":"previousSibling";if(i){if(r=t[o],r&&r.nodeType==e.TEXT_NODE)return r}else if(r=s[o],r&&this.areElementsMergeable(t,r))return r[n?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,n){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(n.tagName||"").toLowerCase())&&h(e,n)&&d(e,n)},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),this.cssStyle&&t.setAttribute("style",this.cssStyle),t},applyToTextNode:function(e){var n,r=e.parentNode;1==r.childNodes.length&&t.dom.arrayContains(this.tagNames,r.tagName.toLowerCase())?(this.cssClass&&s(r,this.cssClass,this.similarClassRegExp),this.cssStyle&&i(r,this.cssStyle,this.similarStyleRegExp)):(n=this.createContainer(t.dom.getDocument(e)),e.parentNode.insertBefore(n,e),n.appendChild(e))},isRemovable:function(n){return t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&""===e.lang.string(n.className).trim()&&(!n.getAttribute("style")||""===e.lang.string(n.getAttribute("style")).trim())},undoToTextNode:function(e,t,n,r){var i,s=n?!1:!0,u=n||r,a=!1;t.containsNode(u)||(i=t.cloneRange(),i.selectNode(u),i.isPointInRange(t.endContainer,t.endOffset)&&v(t.endContainer,t.endOffset)&&(m(u,t.endContainer,t.endOffset,this.container),t.setEndAfter(u)),i.isPointInRange(t.startContainer,t.startOffset)&&v(t.startContainer,t.startOffset)&&(u=m(u,t.startContainer,t.startOffset,this.container))),!s&&this.similarClassRegExp&&o(u,this.similarClassRegExp),s&&this.similarStyleRegExp&&(a="change"===c(u,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(u)&&!a&&p(u)},applyToRange:function(t){var n,r,i,s,o,u;for(r=t.length;r--;){if(n=t[r].getNodes([e.TEXT_NODE]),!n.length)try{return i=this.createContainer(t[r].endContainer.ownerDocument),t[r].surroundContents(i),this.selectNode(t[r],i),void 0}catch(a){}if(t[r].splitBoundaries(),n=t[r].getNodes([e.TEXT_NODE]),n.length){for(o=0,u=n.length;u>o;++o)s=n[o],this.getMatchingAncestor(s).element||this.applyToTextNode(s);t[r].setStart(n[0],0),s=n[n.length-1],t[r].setEnd(s,s.length),this.normalize&&this.postApply(n,t[r])}}},undoToRange:function(t){var n,r,i,s,o,u,a,f;for(s=t.length;s--;){for(n=t[s].getNodes([e.TEXT_NODE]),n.length?(t[s].splitBoundaries(),n=t[s].getNodes([e.TEXT_NODE])):(o=t[s].endContainer.ownerDocument,u=o.createTextNode(e.INVISIBLE_SPACE),t[s].insertNode(u),t[s].selectNode(u),n=[u]),a=0,f=n.length;f>a;++a)t[s].isValid()&&(r=n[a],i=this.getMatchingAncestor(r),"style"===i.type?this.undoToTextNode(r,t[s],!1,i.element):i.element&&this.undoToTextNode(r,t[s],i.element));1==f?this.selectNode(t[s],n[0]):(t[s].setStart(n[0],0),r=n[n.length-1],t[s].setEnd(r,r.length),this.normalize&&this.postApply(n,t[s]))}},selectNode:function(t,n){var r=n.nodeType===e.ELEMENT_NODE,i="canHaveHTML"in n?n.canHaveHTML:!0,s=r?n.innerHTML:n.data,o=""===s||s===e.INVISIBLE_SPACE;if(o&&r&&i)try{n.innerHTML=e.INVISIBLE_SPACE}catch(u){}t.selectNodeContents(n),o&&r?t.collapse(!1):o&&(t.setStartAfter(n),t.setEndAfter(n))},getTextSelectedByRange:function(e,t){var n,r,i=t.cloneRange();return i.selectNodeContents(e),n=i.intersection(t),r=n?""+n:"",i.detach(),r},isAppliedToRange:function(t){var n,r,i,s,o,u,a=[],f="full";for(i=t.length;i--;){if(r=t[i].getNodes([e.TEXT_NODE]),!r.length)return n=this.getMatchingAncestor(t[i].startContainer).element,n?{elements:[n],coverage:f}:!1;for(s=0,o=r.length;o>s;++s)u=this.getTextSelectedByRange(r[s],t[i]),n=this.getMatchingAncestor(r[s]).element,n&&""!=u?(a.push(n),1===e.dom.getTextNodes(n,!0).length?f="full":"full"===f&&(f="inline")):n||(f="partial")}return a.length?{elements:a,coverage:f}:!1},toggleRange:function(e){var t,n=this.isAppliedToRange(e);n?"full"===n.coverage?this.undoToRange(e):"inline"===n.coverage?(t=l(n.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(e),t||this.applyToRange(e)):(l(n.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(e),this.applyToRange(e)):this.applyToRange(e)}},e.selection.HTMLApplier=y}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return wysihtml5.browser.supportsCommand(this.doc,e)},exec:function(e,t){var n=wysihtml5.commands[e],r=wysihtml5.lang.array(arguments).get(),i=n&&n.exec,s=null;if(this.editor.fire("beforecommand:composer"),i)r.unshift(this.composer),s=i.apply(n,r);else try{s=this.doc.execCommand(e,!1,t)}catch(o){}return this.editor.fire("aftercommand:composer"),s},state:function(e){var t=wysihtml5.commands[e],n=wysihtml5.lang.array(arguments).get(),r=t&&t.state;if(r)return n.unshift(this.composer),r.apply(t,n);try{return this.doc.queryCommandState(e)}catch(i){return!1}},stateValue:function(e){var t=wysihtml5.commands[e],n=wysihtml5.lang.array(arguments).get(),r=t&&t.stateValue;return r?(n.unshift(this.composer),r.apply(t,n)):!1}}),wysihtml5.commands.bold={exec:function(e,t){wysihtml5.commands.formatInline.execWithToggle(e,t,"b")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"b")}},function(e){function t(t,n){var o,u,l,c,h,p,v,m,g,y=t.doc,b="_wysihtml5-temp-"+ +(new Date),w=/non-matching-class/g,E=0;for(e.commands.formatInline.exec(t,r,i,b,w,r,r,!0,!0),u=y.querySelectorAll(i+"."+b),o=u.length;o>E;E++){l=u[E],l.removeAttribute("class");for(g in n)"text"!==g&&l.setAttribute(g,n[g])}p=l,1===o&&(v=s.getTextContent(l),c=!!l.querySelector("*"),h=""===v||v===e.INVISIBLE_SPACE,!c&&h&&(s.setTextContent(l,n.text||l.href),m=y.createTextNode(" "),t.selection.setAfter(l),s.insert(m).after(l),p=m)),t.selection.setAfter(p)}function n(e,t,n){var r,i,s,o;for(i=t.length;i--;){for(r=t[i].attributes,s=r.length;s--;)t[i].removeAttribute(r.item(s).name);for(o in n)n.hasOwnProperty(o)&&t[i].setAttribute(o,n[o])}}var r,i="A",s=e.dom;e.commands.createLink={exec:function(e,r,i){var s=this.state(e,r);s?e.selection.executeAndRestore(function(){n(e,s,i)}):(i="object"==typeof i?i:{href:i},t(e,i))},state:function(t,n){return e.commands.formatInline.state(t,n,"A")}}}(wysihtml5),function(e){function t(e,t){for(var r,i,s,o=t.length,u=0;o>u;u++)r=t[u],i=n.getParentElement(r,{nodeName:"code"}),s=n.getTextContent(r),s.match(n.autoLink.URL_REG_EXP)&&!i?i=n.renameElement(r,"code"):n.replaceWithChildNodes(r)}var n=e.dom;e.commands.removeLink={exec:function(e,n){var r=this.state(e,n);r&&e.selection.executeAndRestore(function(){t(e,r)})},state:function(t,n){return e.commands.formatInline.state(t,n,"A")}}}(wysihtml5),function(e){var t=/wysiwyg-font-size-[0-9a-z\-]+/g;e.commands.fontSize={exec:function(n,r,i){e.commands.formatInline.execWithToggle(n,r,"span","wysiwyg-font-size-"+i,t)},state:function(n,r,i){return e.commands.formatInline.state(n,r,"span","wysiwyg-font-size-"+i,t)}}}(wysihtml5),function(e){var t=/(\s|^)font-size\s*:\s*[^;\s]+;?/gi;e.commands.fontSizeStyle={exec:function(n,r,i){i="object"==typeof i?i.size:i,/^\s*$/.test(i)||e.commands.formatInline.execWithToggle(n,r,"span",!1,!1,"font-size:"+i,t)},state:function(n,r){return e.commands.formatInline.state(n,r,"span",!1,!1,"font-size",t)},stateValue:function(t,n){var r,i=this.state(t,n);return i&&e.lang.object(i).isArray()&&(i=i[0]),i&&(r=i.getAttribute("style"),r)?e.quirks.styleParser.parseFontSize(r):!1}}}(wysihtml5),function(e){var t=/wysiwyg-color-[0-9a-z]+/g;e.commands.foreColor={exec:function(n,r,i){e.commands.formatInline.execWithToggle(n,r,"span","wysiwyg-color-"+i,t)},state:function(n,r,i){return e.commands.formatInline.state(n,r,"span","wysiwyg-color-"+i,t)}}}(wysihtml5),function(e){var t=/(\s|^)color\s*:\s*[^;\s]+;?/gi;e.commands.foreColorStyle={exec:function(n,r,i){var s,o=e.quirks.styleParser.parseColor("object"==typeof i?"color:"+i.color:"color:"+i,"color");o&&(s="color: rgb("+o[0]+","+o[1]+","+o[2]+");",1!==o[3]&&(s+="color: rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+");"),e.commands.formatInline.execWithToggle(n,r,"span",!1,!1,s,t))},state:function(n,r){return e.commands.formatInline.state(n,r,"span",!1,!1,"color",t)},stateValue:function(t,n,r){var i,s=this.state(t,n);return s&&e.lang.object(s).isArray()&&(s=s[0]),s&&(i=s.getAttribute("style"),i&&i)?(val=e.quirks.styleParser.parseColor(i,"color"),e.quirks.styleParser.unparseColor(val,r)):!1}}}(wysihtml5),function(e){var t=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi;e.commands.bgColorStyle={exec:function(n,r,i){var s,o=e.quirks.styleParser.parseColor("object"==typeof i?"background-color:"+i.color:"background-color:"+i,"background-color");o&&(s="background-color: rgb("+o[0]+","+o[1]+","+o[2]+");",1!==o[3]&&(s+="background-color: rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+");"),e.commands.formatInline.execWithToggle(n,r,"span",!1,!1,s,t))},state:function(n,r){return e.commands.formatInline.state(n,r,"span",!1,!1,"background-color",t)},stateValue:function(t,n,r){var i,s=this.state(t,n),o=!1;return s&&e.lang.object(s).isArray()&&(s=s[0]),s&&(i=s.getAttribute("style"),i)?(o=e.quirks.styleParser.parseColor(i,"background-color"),e.quirks.styleParser.unparseColor(o,r)):!1}}}(wysihtml5),function(e){function t(t,n,i){t.className?(r(t,i),t.className=e.lang.string(t.className+" "+n).trim()):t.className=n}function n(t,n,r){i(t,r),t.getAttribute("style")?t.setAttribute("style",e.lang.string(t.getAttribute("style")+" "+n).trim()):t.setAttribute("style",n)}function r(t,n){var r=n.test(t.className);return t.className=t.className.replace(n,""),""==e.lang.string(t.className).trim()&&t.removeAttribute("class"),r}function i(t,n){var r=n.test(t.getAttribute("style"));return t.setAttribute("style",(t.getAttribute("style")||"").replace(n,"")),""==e.lang.string(t.getAttribute("style")||"").trim()&&t.removeAttribute("style"),r}function s(e){var t=e.lastChild;t&&o(t)&&t.parentNode.removeChild(t)}function o(e){return"BR"===e.nodeName}function u(t,n){var r,i,o;for(t.selection.isCollapsed()&&t.selection.selectLine(),r=t.selection.surround(n),i=0,o=r.length;o>i;i++)e.dom.lineBreaks(r[i]).remove(),s(r[i])}function a(t){return!!e.lang.string(t.className).trim()}function f(t){return!!e.lang.string(t.getAttribute("style")||"").trim()}var l=e.dom,c=["H1","H2","H3","H4","H5","H6","P","PRE","DIV"];e.commands.formatBlock={exec:function(s,o,p,v,m,g,y){var w,E,S,x,T,N=(s.doc,this.state(s,o,p,v,m,g,y)),C=s.config.useLineBreaks,L=C?"DIV":"P";return p="string"==typeof p?p.toUpperCase():p,N.length?(s.selection.executeAndRestoreRangy(function(){var t,n,s;for(t=N.length;t--;){if(m&&(E=r(N[t],m)),y&&(x=i(N[t],y)),(x||E)&&null===p&&N[t].nodeName!=L)return;n=a(N[t]),s=f(N[t]),n||s||!C&&"P"!==p?l.renameElement(N[t],"P"===p?"DIV":L):(e.dom.lineBreaks(N[t]).add(),l.replaceWithChildNodes(N[t]))}}),void 0):((null!==p&&!e.lang.array(c).contains(p)||(w=s.selection.findNodesInSelection(c).concat(s.selection.getSelectedOwnNodes()),s.selection.executeAndRestoreRangy(function(){for(var e=w.length;e--;)T=l.getParentElement(w[e],{nodeName:c}),T==s.element&&(T=null),T&&(p&&(T=l.renameElement(T,p)),v&&t(T,v,m),g&&n(T,g,y),S=!0)}),!S))&&u(s,{nodeName:p||L,className:v||null,cssStyle:g||null}),void 0)},state:function(t,n,r,i,s,o,u){var a,f,c,h=t.selection.getSelectedOwnNodes(),p=[];for(r="string"==typeof r?r.toUpperCase():r,f=0,c=h.length;c>f;f++)a=l.getParentElement(h[f],{nodeName:r,className:i,classRegExp:s,cssStyle:o,styleRegExp:u}),a&&-1==e.lang.array(p).indexOf(a)&&p.push(a);return 0==p.length?!1:p}}}(wysihtml5),wysihtml5.commands.formatCode={exec:function(e,t,n){var r,i,s,o=this.state(e);o?e.selection.executeAndRestore(function(){r=o.querySelector("code"),wysihtml5.dom.replaceWithChildNodes(o),r&&wysihtml5.dom.replaceWithChildNodes(r)}):(i=e.selection.getRange(),s=i.extractContents(),o=e.doc.createElement("pre"),r=e.doc.createElement("code"),n&&(r.className=n),o.appendChild(r),r.appendChild(s),i.insertNode(o),e.selection.selectNode(o))},state:function(e){var t=e.selection.getSelectedNode();return t&&t.nodeName&&"PRE"==t.nodeName&&t.firstChild&&t.firstChild.nodeName&&"CODE"==t.firstChild.nodeName?t:wysihtml5.dom.getParentElement(t,{nodeName:"CODE"})&&wysihtml5.dom.getParentElement(t,{nodeName:"PRE"})}},function(e){function t(e){var t=r[e];return t?[e.toLowerCase(),t.toLowerCase()]:[e.toLowerCase()]}function n(n,r,s,o,u,f){var l=n;return r&&(l+=":"+r),o&&(l+=":"+o),i[l]||(i[l]=new e.selection.HTMLApplier(t(n),r,s,!0,o,u,f)),i[l]}var r={strong:"b",em:"i",b:"strong",i:"em"},i={};e.commands.formatInline={exec:function(e,t,r,i,s,o,u,a,f){var l=e.selection.createRange(),h=e.selection.getOwnRanges();return h&&0!=h.length?(e.selection.getSelection().removeAllRanges(),n(r,i,s,o,u,e.element).toggleRange(h),a?f||e.cleanUp():(l.setStart(h[0].startContainer,h[0].startOffset),l.setEnd(h[h.length-1].endContainer,h[h.length-1].endOffset),e.selection.setSelection(l),e.selection.executeAndRestore(function(){f||e.cleanUp()},!0,!0)),void 0):!1},execWithToggle:function(t,n,r,i,s,o,u){var f,l=this;this.state(t,n,r,i,s,o,u)&&t.selection.isCollapsed()&&!t.selection.caretIsLastInSelection()&&!t.selection.caretIsFirstInSelection()?(f=l.state(t,n,r,i,s)[0],t.selection.executeAndRestoreRangy(function(){f.parentNode,t.selection.selectNode(f,!0),e.commands.formatInline.exec(t,n,r,i,s,o,u,!0,!0)})):this.state(t,n,r,i,s,o,u)&&!t.selection.isCollapsed()?t.selection.executeAndRestoreRangy(function(){e.commands.formatInline.exec(t,n,r,i,s,o,u,!0,!0)}):e.commands.formatInline.exec(t,n,r,i,s,o,u)},state:function(t,i,s,o,u,f,l){var h,p,v=t.doc,m=r[s]||s;return e.dom.hasElementWithTagName(v,s)||e.dom.hasElementWithTagName(v,m)?o&&!e.dom.hasElementWithClassName(v,o)?!1:(h=t.selection.getOwnRanges(),h&&0!==h.length?(p=n(s,o,u,f,l,t.element).isAppliedToRange(h),p&&p.elements?p.elements:!1):!1):!1}}}(wysihtml5),function(e){e.commands.insertBlockQuote={exec:function(t,n){var r=this.state(t,n),i=t.selection.isEndToEndInNode(["H1","H2","H3","H4","H5","H6","P"]);t.selection.executeAndRestore(function(){if(r)t.config.useLineBreaks&&e.dom.lineBreaks(r).add(),e.dom.unwrap(r);else if(t.selection.isCollapsed()&&t.selection.selectLine(),i){var n=i.ownerDocument.createElement("blockquote");e.dom.insert(n).after(i),n.appendChild(i)}else t.selection.surround({nodeName:"blockquote"})})},state:function(t){var n=t.selection.getSelectedNode(),r=e.dom.getParentElement(n,{nodeName:"BLOCKQUOTE"},!1,t.element);return r?r:!1}}}(wysihtml5),wysihtml5.commands.insertHTML={exec:function(e,t,n){e.commands.support(t)?e.doc.execCommand(t,!1,n):e.selection.insertHTML(n)},state:function(){return!1}},function(e){var t="IMG";e.commands.insertImage={exec:function(n,r,i){var s,o,u,f,l;if(i="object"==typeof i?i:{src:i},s=n.doc,o=this.state(n),o)return n.selection.setBefore(o),f=o.parentNode,f.removeChild(o),e.dom.removeEmptyTextNodes(f),"A"!==f.nodeName||f.firstChild||(n.selection.setAfter(f),f.parentNode.removeChild(f)),e.quirks.redraw(n.element),void 0;o=s.createElement(t);for(l in i)o.setAttribute("className"===l?"class":l,i[l]);n.selection.insertNode(o),e.browser.hasProblemsSettingCaretAfterImg()?(u=s.createTextNode(e.INVISIBLE_SPACE),n.selection.insertNode(u),n.selection.setAfter(u)):n.selection.setAfter(o)},state:function(n){var r,i,s,o=n.doc;return e.dom.hasElementWithTagName(o,t)?(r=n.selection.getSelectedNode(),r?r.nodeName===t?r:r.nodeType!==e.ELEMENT_NODE?!1:(i=n.selection.getText(),i=e.lang.string(i).trim(),i?!1:(s=n.selection.getNodes(e.ELEMENT_NODE,function(e){return"IMG"===e.nodeName}),1!==s.length?!1:s[0])):!1):!1}}}(wysihtml5),function(e){var t="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(n,r){n.commands.support(r)?(n.doc.execCommand(r,!1,null),e.browser.autoScrollsToCaret()||n.selection.scrollIntoView()):n.commands.exec("insertHTML",t)},state:function(){return!1}}}(wysihtml5),wysihtml5.commands.insertOrderedList={exec:function(e,t){wysihtml5.commands.insertList.exec(e,t,"OL")},state:function(e,t){return wysihtml5.commands.insertList.state(e,t,"OL")}},wysihtml5.commands.insertUnorderedList={exec:function(e,t){wysihtml5.commands.insertList.exec(e,t,"UL")},state:function(e,t){return wysihtml5.commands.insertList.state(e,t,"UL")}},wysihtml5.commands.insertList=function(e){var t=function(e,t){if(e&&e.nodeName){"string"==typeof t&&(t=[t]);for(var n=t.length;n--;)if(e.nodeName===t[n])return!0}return!1},n=function(n,r,i){var s,o,u={el:null,other:!1};return n&&(s=e.dom.getParentElement(n,{nodeName:"LI"}),o="UL"===r?"OL":"UL",t(n,r)?u.el=n:t(n,o)?u={el:n,other:!0}:s&&(t(s.parentNode,r)?u.el=s.parentNode:t(s.parentNode,o)&&(u={el:s.parentNode,other:!0}))),u.el&&!i.element.contains(u.el)&&(u.el=null),u},r=function(t,n,r){var i,o="UL"===n?"OL":"UL";r.selection.executeAndRestore(function(){var u,l,h=s(o,r);if(h.length)for(u=h.length;u--;)e.dom.renameElement(h[u],n.toLowerCase());else{for(i=s(["OL","UL"],r),l=i.length;l--;)e.dom.resolveList(i[l],r.config.useLineBreaks);e.dom.resolveList(t,r.config.useLineBreaks)}})},i=function(t,n,r){var i="UL"===n?"OL":"UL";r.selection.executeAndRestore(function(){var o,u=[t].concat(s(i,r));for(o=u.length;o--;)e.dom.renameElement(u[o],n.toLowerCase())})},s=function(e,n){var r,i=n.selection.getOwnRanges(),s=[];for(r=i.length;r--;)s=s.concat(i[r].getNodes([1],function(n){return t(n,e)}));return s},o=function(t,n){n.selection.executeAndRestoreRangy(function(){var r,i,s="_wysihtml5-temp-"+(new Date).getTime(),o=n.selection.deblockAndSurround({nodeName:"div",className:s}),u=/\uFEFF/g;o.innerHTML=o.innerHTML.replace(u,""),o&&(r=e.lang.array(["","<br>",e.INVISIBLE_SPACE]).contains(o.innerHTML),i=e.dom.convertToList(o,t.toLowerCase(),n.parent.config.uneditableContainerClassname),r&&n.selection.selectNode(i.querySelector("li"),!0))})};return{exec:function(e,t,s){var u=e.doc,a="OL"===s?"insertOrderedList":"insertUnorderedList",f=e.selection.getSelectedNode(),l=n(f,s,e);l.el?l.other?i(l.el,s,e):r(l.el,s,e):e.commands.support(a)?u.execCommand(a,!1,null):o(s,e)},state:function(e,t,r){var i=e.selection.getSelectedNode(),s=n(i,r,e);return s.el&&!s.other?s.el:!1}}}(wysihtml5),wysihtml5.commands.italic={exec:function(e,t){wysihtml5.commands.formatInline.execWithToggle(e,t,"i")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"i")}},function(e){var t="wysiwyg-text-align-center",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyCenter={exec:function(r){return e.commands.formatBlock.exec(r,"formatBlock",null,t,n)},state:function(r){return e.commands.formatBlock.state(r,"formatBlock",null,t,n)}}}(wysihtml5),function(e){var t="wysiwyg-text-align-left",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyLeft={exec:function(r){return e.commands.formatBlock.exec(r,"formatBlock",null,t,n)},state:function(r){return e.commands.formatBlock.state(r,"formatBlock",null,t,n)}}}(wysihtml5),function(e){var t="wysiwyg-text-align-right",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyRight={exec:function(r){return e.commands.formatBlock.exec(r,"formatBlock",null,t,n)},state:function(r){return e.commands.formatBlock.state(r,"formatBlock",null,t,n)}}}(wysihtml5),function(e){var t="wysiwyg-text-align-justify",n=/wysiwyg-text-align-[0-9a-z]+/g;e.commands.justifyFull={exec:function(r){return e.commands.formatBlock.exec(r,"formatBlock",null,t,n)},state:function(r){return e.commands.formatBlock.state(r,"formatBlock",null,t,n)}}}(wysihtml5),function(e){var t="text-align: right;",n=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;e.commands.alignRightStyle={exec:function(r){return e.commands.formatBlock.exec(r,"formatBlock",null,null,null,t,n)},state:function(r){return e.commands.formatBlock.state(r,"formatBlock",null,null,null,t,n)}}}(wysihtml5),function(e){var t="text-align: left;",n=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;e.commands.alignLeftStyle={exec:function(r){return e.commands.formatBlock.exec(r,"formatBlock",null,null,null,t,n)},state:function(r){return e.commands.formatBlock.state(r,"formatBlock",null,null,null,t,n)}}}(wysihtml5),function(e){var t="text-align: center;",n=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;e.commands.alignCenterStyle={exec:function(r){return e.commands.formatBlock.exec(r,"formatBlock",null,null,null,t,n)},state:function(r){return e.commands.formatBlock.state(r,"formatBlock",null,null,null,t,n)}}}(wysihtml5),wysihtml5.commands.redo={exec:function(e){return e.undoManager.redo()},state:function(){return!1}},wysihtml5.commands.underline={exec:function(e,t){wysihtml5.commands.formatInline.execWithToggle(e,t,"u")},state:function(e,t){return wysihtml5.commands.formatInline.state(e,t,"u")}},wysihtml5.commands.undo={exec:function(e){return e.undoManager.undo()},state:function(){return!1}},wysihtml5.commands.createTable={exec:function(e,t,n){var r,i,s;if(n&&n.cols&&n.rows&&parseInt(n.cols,10)>0&&parseInt(n.rows,10)>0){for(s=n.tableStyle?'<table style="'+n.tableStyle+'">':"<table>",s+="<tbody>",i=0;i<n.rows;i++){for(s+="<tr>",r=0;r<n.cols;r++)s+="<td>&nbsp;</td>";s+="</tr>"}s+="</tbody></table>",e.commands.exec("insertHTML",s)}},state:function(){return!1}},wysihtml5.commands.mergeTableCells={exec:function(e,t){e.tableSelection&&e.tableSelection.start&&e.tableSelection.end&&(this.state(e,t)?wysihtml5.dom.table.unmergeCell(e.tableSelection.start):wysihtml5.dom.table.mergeCellsBetween(e.tableSelection.start,e.tableSelection.end))},state:function(e){if(e.tableSelection){var t=e.tableSelection.start,n=e.tableSelection.end;if(t&&n&&t==n&&(wysihtml5.dom.getAttribute(t,"colspan")&&parseInt(wysihtml5.dom.getAttribute(t,"colspan"),10)>1||wysihtml5.dom.getAttribute(t,"rowspan")&&parseInt(wysihtml5.dom.getAttribute(t,"rowspan"),10)>1))return[t]}return!1}},wysihtml5.commands.addTableCells={exec:function(e,t,n){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){var r=wysihtml5.dom.table.orderSelectionEnds(e.tableSelection.start,e.tableSelection.end);"before"==n||"above"==n?wysihtml5.dom.table.addCells(r.start,n):("after"==n||"below"==n)&&wysihtml5.dom.table.addCells(r.end,n),setTimeout(function(){e.tableSelection.select(r.start,r.end)},0)}},state:function(){return!1}},wysihtml5.commands.deleteTableCells={exec:function(e,t,n){if(e.tableSelection&&e.tableSelection.start&&e.tableSelection.end){var r,i=wysihtml5.dom.table.orderSelectionEnds(e.tableSelection.start,e.tableSelection.end),s=wysihtml5.dom.table.indexOf(i.start),o=e.tableSelection.table;wysihtml5.dom.table.removeCells(i.start,n),setTimeout(function(){r=wysihtml5.dom.table.findCell(o,s),r||("row"==n&&(r=wysihtml5.dom.table.findCell(o,{row:s.row-1,col:s.col})),"column"==n&&(r=wysihtml5.dom.table.findCell(o,{row:s.row,col:s.col-1}))),r&&e.tableSelection.select(r,r)},0)}},state:function(){return!1}},wysihtml5.commands.indentList={exec:function(e){var t=e.selection.getSelectionParentsByTag("LI");return t?this.tryToPushLiLevel(t,e.selection):!1},state:function(){return!1},tryToPushLiLevel:function(e,t){var n,r,i,s,o,u=!1;return t.executeAndRestoreRangy(function(){for(var t=e.length;t--;)s=e[t],n="OL"===s.parentNode.nodeName?"OL":"UL",r=s.ownerDocument.createElement(n),i=wysihtml5.dom.domNode(s).prev({nodeTypes:[wysihtml5.ELEMENT_NODE]}),o=i?i.querySelector("ul, ol"):null,i&&(o?o.appendChild(s):(r.appendChild(s),i.appendChild(r)),u=!0)}),u}},wysihtml5.commands.outdentList={exec:function(e){var t=e.selection.getSelectionParentsByTag("LI");return t?this.tryToPullLiLevel(t,e):!1},state:function(){return!1},tryToPullLiLevel:function(e,t){var n,r,i,s,o,u=!1,a=this;return t.selection.executeAndRestoreRangy(function(){var l,p;for(l=e.length;l--;)if(s=e[l],s.parentNode&&(n=s.parentNode,"OL"===n.tagName||"UL"===n.tagName)){if(u=!0,r=wysihtml5.dom.getParentElement(n.parentNode,{nodeName:["OL","UL"]},!1,t.element),i=wysihtml5.dom.getParentElement(n.parentNode,{nodeName:["LI"]},!1,t.element),r&&i)s.nextSibling&&(o=a.getAfterList(n,s),s.appendChild(o)),r.insertBefore(s,i.nextSibling);else{for(s.nextSibling&&(o=a.getAfterList(n,s),s.appendChild(o)),p=s.childNodes.length;p--;)n.parentNode.insertBefore(s.childNodes[p],n.nextSibling);n.parentNode.insertBefore(document.createElement("br"),n.nextSibling),s.parentNode.removeChild(s)}0===n.childNodes.length&&n.parentNode.removeChild(n)}}),u},getAfterList:function(e,t){for(var n=e.nodeName,r=document.createElement(n);t.nextSibling;)r.appendChild(t.nextSibling);return r}},function(e){var t=90,n=89,r=8,i=46,s=25,o="data-wysihtml5-selection-node",u="data-wysihtml5-selection-offset",a=('<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",'<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",e.dom);e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var e,s=this;this.composer.sandbox.getDocument(),a.observe(this.element,"keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var r=e.keyCode,i=r===t&&!e.shiftKey,o=r===t&&e.shiftKey||r===n;i?(s.undo(),e.preventDefault()):o&&(s.redo(),e.preventDefault())}}),a.observe(this.element,"keydown",function(t){var n=t.keyCode;n!==e&&(e=n,(n===r||n===i)&&s.transact())}),this.editor.on("newword:composer",function(){s.transact()}).on("beforecommand:composer",function(){s.transact()})},transact:function(){var t,n,r,i,a,l,c,p=this.historyStr[this.position-1],d=this.composer.getValue(!1,!1),v=this.element.offsetWidth>0&&this.element.offsetHeight>0;d!==p&&(l=this.historyStr.length=this.historyDom.length=this.position,l>s&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,v&&(t=this.composer.selection.getRange(),n=t&&t.startContainer?t.startContainer:this.element,r=t&&t.startOffset?t.startOffset:0,n.nodeType===e.ELEMENT_NODE?i=n:(i=n.parentNode,a=this.getChildNodeIndex(i,n)),i.setAttribute(u,r),void 0!==a&&i.setAttribute(o,a)),c=this.element.cloneNode(!!d),this.historyDom.push(c),this.historyStr.push(d),i&&(i.removeAttribute(u),i.removeAttribute(o)))},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(e){var t,n,r,i,s,a;for(this.element.innerHTML="",t=0,n=e.childNodes,r=e.childNodes.length;r>t;t++)this.element.appendChild(n[t].cloneNode(!0));e.hasAttribute(u)?(i=e.getAttribute(u),a=e.getAttribute(o),s=this.element):(s=this.element.querySelector("["+u+"]")||this.element,i=s.getAttribute(u),a=s.getAttribute(o),s.removeAttribute(u),s.removeAttribute(o)),null!==a&&(s=this.getChildNodeByIndex(s,+a)),this.composer.selection.set(s,i)},getChildNodeIndex:function(e,t){for(var n=0,r=e.childNodes,i=r.length;i>n;n++)if(r[n]===t)return n},getChildNodeByIndex:function(e,t){return e.childNodes[t]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(e,t,n){this.parent=e,this.element=t,this.config=n,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.on("beforeload",function(){e.parent.on("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,n=e.browser;e.views.Composer=e.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,n){this.base(e,t,n),this.config.noTextarea?this.editableArea=t:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=n.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t,n){var r=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t!==!1&&(r=this.parent.parse(r,n===!1?!1:!0)),r},setValue:function(e,t){t&&(e=this.parent.parse(e));try{this.element.innerHTML=e}catch(n){this.element.innerText=e}},cleanUp:function(){this.parent.parse(this.element)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=t.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var n=this.element.lastChild;t&&n&&this.selection&&("BR"===n.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var e=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(e)||""===e||"<br>"===e||"<p></p>"===e||"<p><br></p>"===e||this.hasPlaceholderSet()},_initContentEditableArea:function(){var e=this;this.config.noTextarea?this.sandbox=new t.ContentEditableArea(function(){e._create()},{},this.editableArea):(this.sandbox=new t.ContentEditableArea(function(){e._create()}),this.editableArea=this.sandbox.getContentEditable(),t.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var e,n=this;this.sandbox=new t.Sandbox(function(){n._create()},{stylesheets:this.config.stylesheets}),this.editableArea=this.sandbox.getIframe(),e=this.textarea.element,t.insert(this.editableArea).after(e),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var e=document.createElement("input");e.type="hidden",e.name="_wysihtml5_mode",e.value=1,t.insert(e).after(this.textarea.element)}},_create:function(){var r,i,s=this;this.doc=this.sandbox.getDocument(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new e.Selection(this.parent,this.element,this.config.uneditableContainerClassname),this.commands=new e.Commands(this.parent),this.config.noTextarea||t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),t.addClass(this.element,this.config.composerClassName),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe(),r=this.config.name,r&&(t.addClass(this.element,r),this.config.contentEditableMode||t.addClass(this.editableArea,r)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable(),i="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"),i&&t.simulatePlaceholder(this.parent,this,i),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||n.isIos()||setTimeout(function(){s.focus(!0)},100),n.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var r,i,s,o=this,u=n.canDisableAutoLinking(),f=n.doesAutoLinkingInContentEditable();u&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink&&((!f||f&&u)&&(this.parent.on("newword:composer",function(){t.getTextContent(o.element).match(t.autoLink.URL_REG_EXP)&&o.selection.executeAndRestore(function(n,r){var i,s=o.element.querySelectorAll("."+o.config.uneditableContainerClassname),u=!1;for(i=s.length;i--;)e.dom.contains(s[i],r)&&(u=!0);u||t.autoLink(r.parentNode,[o.config.uneditableContainerClassname])})}),t.observe(this.element,"blur",function(){t.autoLink(o.element,[o.config.uneditableContainerClassname])})),r=this.sandbox.getDocument().getElementsByTagName("a"),i=t.autoLink.URL_REG_EXP,s=function(n){var r=e.lang.string(t.getTextContent(n)).trim();return"www."===r.substr(0,4)&&(r="http://"+r),r},t.observe(this.element,"keydown",function(e){if(r.length){var n,u=o.selection.getSelectedNode(e.target.ownerDocument),a=t.getParentElement(u,{nodeName:"A"},4);a&&(n=s(a),setTimeout(function(){var e=s(a);e!==n&&e.match(i)&&a.setAttribute("href",e)},0))}}))},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),n.supportsEvent("resizeend")){var r=["width","height"],i=r.length,s=this.element;t.observe(s,"resizeend",function(t){var n,o=t.target||t.srcElement,u=o.style,l=0;if("IMG"===o.nodeName){for(;i>l;l++)n=r[l],u[n]&&(o.setAttribute(n,parseInt(u[n],10)),u[n]="");e.quirks.redraw(s)}})}},_initUndoManager:function(){this.undoManager=new e.UndoManager(this.parent)},_initLineBreaking:function(){function r(e){var n=t.getParentElement(e,{nodeName:["P","DIV"]},2);n&&t.contains(i.element,n)&&i.selection.executeAndRestore(function(){i.config.useLineBreaks?t.replaceWithChildNodes(n):"P"!==n.nodeName&&t.renameElement(n,"p")})}var i=this,s=["LI","P","H1","H2","H3","H4","H5","H6"],o=["UL","OL","MENU"];this.config.useLineBreaks||t.observe(this.element,["focus","keydown"],function(){if(i.isEmpty()){var e=i.doc.createElement("P");i.element.innerHTML="",i.element.appendChild(e),n.displaysCaretInEmptyContentEditableCorrectly()?i.selection.selectNode(e,!0):(e.innerHTML="<br>",i.selection.setBefore(e.firstChild))}}),t.observe(this.element,"keydown",function(n){var u,l=n.keyCode;if(!n.shiftKey&&(l===e.ENTER_KEY||l===e.BACKSPACE_KEY))return u=t.getParentElement(i.selection.getSelectedNode(),{nodeName:s},4),u?(setTimeout(function(){var n,s=i.selection.getSelectedNode();if("LI"===u.nodeName){if(!s)return;n=t.getParentElement(s,{nodeName:o},2),n||r(s)}l===e.ENTER_KEY&&u.nodeName.match(/^H[1-6]$/)&&r(s)},0),void 0):(i.config.useLineBreaks&&l===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(n.preventDefault(),i.commands.exec("insertLineBreak")),void 0)})}})}(wysihtml5),function(e){var t=e.dom,n=document,r=window,i=n.createElement("div"),s=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],o=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],u=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],a=function(e){if(e.setActive)try{e.setActive()}catch(i){}else{var s=e.style,o=n.documentElement.scrollTop||n.body.scrollTop,u=n.documentElement.scrollLeft||n.body.scrollLeft,a={position:s.position,top:s.top,left:s.left,WebkitUserSelect:s.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(a).on(e),r.scrollTo&&r.scrollTo(u,o)}};e.views.Composer.prototype.style=function(){var r,l,p=this,d=n.querySelector(":focus"),v=this.textarea.element,m=v.hasAttribute("placeholder"),y=m&&v.getAttribute("placeholder"),w=v.style.display,E=v.disabled;return this.focusStylesHost=i.cloneNode(!1),this.blurStylesHost=i.cloneNode(!1),this.disabledStylesHost=i.cloneNode(!1),m&&v.removeAttribute("placeholder"),v===d&&v.blur(),v.disabled=!1,v.style.display=r="none",(v.getAttribute("rows")&&"auto"===t.getStyle("height").from(v)||v.getAttribute("cols")&&"auto"===t.getStyle("width").from(v))&&(v.style.display=r=w),t.copyStyles(o).from(v).to(this.editableArea).andTo(this.blurStylesHost),t.copyStyles(s).from(v).to(this.element).andTo(this.blurStylesHost),t.insertCSS(u).into(this.element.ownerDocument),v.disabled=!0,t.copyStyles(o).from(v).to(this.disabledStylesHost),t.copyStyles(s).from(v).to(this.disabledStylesHost),v.disabled=E,v.style.display=w,a(v),v.style.display=r,t.copyStyles(o).from(v).to(this.focusStylesHost),t.copyStyles(s).from(v).to(this.focusStylesHost),v.style.display=w,t.copyStyles(["display"]).from(v).to(this.editableArea),l=e.lang.array(o).without(["display"]),d?d.focus():v.blur(),m&&v.setAttribute("placeholder",y),this.parent.on("focus:composer",function(){t.copyStyles(l).from(p.focusStylesHost).to(p.editableArea),t.copyStyles(s).from(p.focusStylesHost).to(p.element)}),this.parent.on("blur:composer",function(){t.copyStyles(l).from(p.blurStylesHost).to(p.editableArea),t.copyStyles(s).from(p.blurStylesHost).to(p.element)}),this.parent.observe("disable:composer",function(){t.copyStyles(l).from(p.disabledStylesHost).to(p.editableArea),t.copyStyles(s).from(p.disabledStylesHost).to(p.element)}),this.parent.observe("enable:composer",function(){t.copyStyles(l).from(p.blurStylesHost).to(p.editableArea),t.copyStyles(s).from(p.blurStylesHost).to(p.element)}),this}}(wysihtml5),function(e){var t=e.dom,n=e.browser,r={66:"bold",73:"italic",85:"underline"},i=function(e,t,n){var r,i=e.getPreviousNode(t,!0),s=e.getSelectedNode();if(1!==s.nodeType&&s.parentNode!==n&&(s=s.parentNode),i)if(1==s.nodeType){if(r=s.firstChild,1==i.nodeType)for(;s.firstChild;)i.appendChild(s.firstChild);else for(;s.firstChild;)t.parentNode.insertBefore(s.firstChild,t);s.parentNode&&s.parentNode.removeChild(s),e.setBefore(r)}else 1==i.nodeType?i.appendChild(s):t.parentNode.insertBefore(s,t),e.setBefore(s)},s=function(e,t,n,r){var s,o,u;t.isCollapsed()?t.caretIsInTheBeginnig("LI")?(e.preventDefault(),r.commands.exec("outdentList")):t.caretIsInTheBeginnig()?e.preventDefault():(t.caretIsFirstInSelection()&&t.getPreviousNode()&&t.getPreviousNode().nodeName&&/^H\d$/gi.test(t.getPreviousNode().nodeName)&&(s=t.getPreviousNode(),e.preventDefault(),/^\s*$/.test(s.textContent||s.innerText)?s.parentNode.removeChild(s):(o=s.ownerDocument.createRange(),o.selectNodeContents(s),o.collapse(!1),t.setSelection(o))),u=t.caretIsBeforeUneditable(),u&&(e.preventDefault(),i(t,u,n))):t.containsUneditable()&&(e.preventDefault(),t.deleteContents())},o=function(e){if(e.selection.isCollapsed()){if(e.selection.caretIsInTheBeginnig("LI")&&e.commands.exec("indentList"))return}else e.selection.deleteContents();e.commands.exec("insertHTML","&emsp;")};e.views.Composer.prototype.observe=function(){var i,u,l=this,h=this.getValue(!1,!1),p=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),v=this.element,m=n.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?v:this.sandbox.getWindow(),y=["drop","paste","beforepaste"],w=["drop","paste","mouseup","focus","keyup"];t.observe(p,"DOMNodeRemoved",function(){clearInterval(i),l.parent.fire("destroy:composer")}),n.supportsMutationEvents()||(i=setInterval(function(){t.contains(document.documentElement,p)||(clearInterval(i),l.parent.fire("destroy:composer"))},250)),t.observe(m,w,function(){setTimeout(function(){l.parent.fire("interaction").fire("interaction:composer")},0)}),this.config.handleTables&&(!this.tableClickHandle&&this.doc.execCommand&&e.browser.supportsCommand(this.doc,"enableObjectResizing")&&e.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.tableClickHandle=t.observe(p,["focus","mouseup","mouseover"],function(){l.doc.execCommand("enableObjectResizing",!1,"false"),l.doc.execCommand("enableInlineTableEditing",!1,"false"),l.tableClickHandle.stop()}):setTimeout(function(){l.doc.execCommand("enableObjectResizing",!1,"false"),l.doc.execCommand("enableInlineTableEditing",!1,"false")},0)),this.tableSelection=e.quirks.tableCellsSelection(v,l.parent)),t.observe(m,"focus",function(e){l.parent.fire("focus",e).fire("focus:composer",e),setTimeout(function(){h=l.getValue(!1,!1)},0)}),t.observe(m,"blur",function(e){if(h!==l.getValue(!1,!1)){var t=e;"function"==typeof Object.create&&(t=Object.create(e,{type:{value:"change"}})),l.parent.fire("change",t).fire("change:composer",t)}l.parent.fire("blur",e).fire("blur:composer",e)}),t.observe(v,"dragenter",function(){l.parent.fire("unset_placeholder")}),t.observe(v,y,function(e){l.parent.fire(e.type,e).fire(e.type+":composer",e)}),this.config.copyedFromMarking&&t.observe(v,"copy",function(e){e.clipboardData&&(e.clipboardData.setData("text/html",l.config.copyedFromMarking+l.selection.getHtml()),e.preventDefault()),l.parent.fire(e.type,e).fire(e.type+":composer",e)}),t.observe(v,"keyup",function(t){var n=t.keyCode;(n===e.SPACE_KEY||n===e.ENTER_KEY)&&l.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){l.parent.fire("newword:composer")},0)}),n.canSelectImagesInContentEditable()||t.observe(v,"mousedown",function(t){var n=t.target,r=v.querySelectorAll("img"),i=v.querySelectorAll("."+l.config.uneditableContainerClassname+" img"),s=e.lang.array(r).without(i);"IMG"===n.nodeName&&e.lang.array(s).contains(n)&&l.selection.selectNode(n)}),n.canSelectImagesInContentEditable()||t.observe(v,"drop",function(){setTimeout(function(){l.selection.getSelection().removeAllRanges()},0)}),n.hasHistoryIssue()&&n.supportsSelectionModify()&&t.observe(v,"keydown",function(e){if(e.metaKey||e.ctrlKey){var t=e.keyCode,n=v.ownerDocument.defaultView,r=n.getSelection();(37===t||39===t)&&(37===t&&(r.modify("extend","left","lineboundary"),e.shiftKey||r.collapseToStart()),39===t&&(r.modify("extend","right","lineboundary"),e.shiftKey||r.collapseToEnd()),e.preventDefault())}}),t.observe(v,"keydown",function(e){var t=e.keyCode,n=r[t];(e.ctrlKey||e.metaKey)&&!e.altKey&&n&&(l.commands.exec(n),e.preventDefault()),8===t?s(e,l.selection,v,l):l.config.handleTabKey&&9===t&&(e.preventDefault(),o(l,v))}),t.observe(v,"keydown",function(t){var n,r=l.selection.getSelectedNode(!0),i=t.keyCode;!r||"IMG"!==r.nodeName||i!==e.BACKSPACE_KEY&&i!==e.DELETE_KEY||(n=r.parentNode,n.removeChild(r),"A"!==n.nodeName||n.firstChild||n.parentNode.removeChild(n),setTimeout(function(){e.quirks.redraw(v)},0),t.preventDefault())}),!this.config.contentEditableMode&&n.hasIframeFocusIssue()&&(t.observe(p,"focus",function(){setTimeout(function(){l.doc.querySelector(":focus")!==l.element&&l.focus()},0)}),t.observe(this.element,"blur",function(){setTimeout(function(){l.selection.getSelection().removeAllRanges()},0)})),u={IMG:"Image: ",A:"Link: "},t.observe(v,"mouseover",function(e){var t,n,r=e.target,i=r.nodeName;("A"===i||"IMG"===i)&&(n=r.hasAttribute("title"),n||(t=u[i]+(r.getAttribute("href")||r.getAttribute("src")),r.setAttribute("title",t)))})}}(wysihtml5),function(e){var t=400;e.views.Synchronizer=Base.extend({constructor:function(e,t,n){this.editor=e,this.textarea=t,this.composer=n,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue(!1,!1)).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue(!1,!1);t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var n,r=this,i=this.textarea.element.form,s=function(){n=setInterval(function(){r.fromComposerToTextarea()},t)},o=function(){clearInterval(n),n=null};s(),i&&(e.dom.observe(i,"submit",function(){r.sync(!0)}),e.dom.observe(i,"reset",function(){setTimeout(function(){r.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(e){"composer"!==e||n?"textarea"===e&&(r.fromComposerToTextarea(!0),o()):(r.fromTextareaToComposer(!0),s())}),this.editor.on("destroy:composer",o)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,t,n){this.base(e,t,n),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e!==!1&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},cleanUp:function(){var e=this.parent.parse(this.element.value);this.element.value=e},hasPlaceholderSet:function(){var e=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,n=this.element.value,r=!n;return e&&r||n===t},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,n={focusin:"focus",focusout:"blur"},r=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];t.on("beforeload",function(){wysihtml5.dom.observe(e,r,function(e){var r=n[e.type]||e.type;t.fire(r).fire(r+":textarea")}),wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t,n={name:t,style:!0,toolbar:t,showToolbarAfterInit:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},pasteParserRulesets:null,parser:e.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:t,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,uneditableContainerClassname:"wysihtml5-uneditable-container",copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};e.Editor=e.lang.Dispatcher.extend({constructor:function(t,r){if(this.editableElement="string"==typeof t?document.getElementById(t):t,this.config=e.lang.object({}).merge(n).merge(r).get(),this._isCompatible=e.browser.supported(),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new e.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var i=this;return setTimeout(function(){i.fire("beforeload").fire("load")},0),void 0}e.dom.addClass(document.body,this.config.bodyClassName),this.composer=new e.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea||(this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer)),this.config.toolbar&&(this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e,t){return this.currentView.getValue(e,t)},setValue:function(e,t){return this.fire("unset_placeholder"),e?(this.currentView.setValue(e,t),this):this.clear()},cleanUp:function(){this.currentView.cleanUp()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t,n){var r=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,i=this.config.parser(t,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:r,uneditableClass:this.config.uneditableContainerClassname,clearInternals:n});return"object"==typeof t&&e.quirks.redraw(t),i},_initParser:function(){var t,n=this;e.browser.supportsModenPaste()?this.on("paste:composer",function(r){r.preventDefault(),t=e.dom.getPastedHtml(r),t&&n._cleanAndPaste(t)}):this.on("beforepaste:composer",function(t){t.preventDefault(),e.dom.getPastedHtmlWithDiv(n.composer,function(e){e&&n._cleanAndPaste(e)})})},_cleanAndPaste:function(t){var n=e.quirks.cleanPastedHTML(t,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.uneditableContainerClassname});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(n)}})}(wysihtml5),function(e){var t=e.dom,n="wysihtml5-command-dialog-opened",r="input, select, textarea",i="[data-wysihtml5-dialog-field]",s="data-wysihtml5-dialog-field";e.toolbar.Dialog=e.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){var i,s,o,u,f,l;if(!this._observed){for(i=this,s=function(e){var t=i._serialize();t==i.elementToChange?i.fire("edit",t):i.fire("save",t),i.hide(),e.preventDefault(),e.stopPropagation()},t.observe(i.link,"click",function(){t.hasClass(i.link,n)&&setTimeout(function(){i.hide()},0)}),t.observe(this.container,"keydown",function(t){var n=t.keyCode;n===e.ENTER_KEY&&s(t),n===e.ESCAPE_KEY&&(i.fire("cancel"),i.hide())}),t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",s),t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){i.fire("cancel"),i.hide(),e.preventDefault(),e.stopPropagation()}),o=this.container.querySelectorAll(r),u=0,f=o.length,l=function(){clearInterval(i.interval)};f>u;u++)t.observe(o[u],"change",l);this._observed=!0}},_serialize:function(){for(var e=this.elementToChange||{},t=this.container.querySelectorAll(i),n=t.length,r=0;n>r;r++)e[t[r].getAttribute(s)]=t[r].value;return e},_interpolate:function(e){for(var t,n,r,o=document.querySelector(":focus"),u=this.container.querySelectorAll(i),a=u.length,l=0;a>l;l++)t=u[l],t!==o&&(e&&"hidden"===t.type||(n=t.getAttribute(s),r=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(n)||"":t.defaultValue,t.value=r))},show:function(e){if(!t.hasClass(this.link,n)){var i=this,s=this.container.querySelector(r);if(this.elementToChange=e,this._observe(),this._interpolate(),e&&(this.interval=setInterval(function(){i._interpolate(!0)},500)),t.addClass(this.link,n),this.container.style.display="",this.fire("show"),s&&!e)try{s.focus()}catch(o){}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,t.removeClass(this.link,n),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(e){var t=e.dom,n={position:"relative"},r={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},i={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},s={"x-webkit-speech":"",speech:""};e.toolbar.Speech=function(o,u){var l,h,p,v=document.createElement("input");return e.browser.supportsSpeechApiOn(v)?(l=o.editor.textarea.element.getAttribute("lang"),l&&(s.lang=l),h=document.createElement("div"),e.lang.object(r).merge({width:u.offsetWidth+"px",height:u.offsetHeight+"px"}),t.insert(v).into(h),t.insert(h).into(u),t.setStyles(i).on(v),t.setAttributes(s).on(v),t.setStyles(r).on(h),t.setStyles(n).on(u),p="onwebkitspeechchange"in v?"webkitspeechchange":"speechchange",t.observe(v,p,function(){o.execCommand("insertText",v.value),v.value=""}),t.observe(v,"click",function(e){t.hasClass(u,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()}),void 0):(u.style.display="none",void 0)}}(wysihtml5),function(e){var t="wysihtml5-command-disabled",n="wysihtml5-commands-disabled",r="wysihtml5-command-active",i="wysihtml5-action-active",s=e.dom;e.toolbar.Toolbar=Base.extend({constructor:function(s,o,u){this.editor=s,this.container="string"==typeof o?document.getElementById(o):o,this.composer=s.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),u&&this.show(),null!=s.config.classNameCommandDisabled&&(t=s.config.classNameCommandDisabled),null!=s.config.classNameCommandsDisabled&&(n=s.config.classNameCommandsDisabled),null!=s.config.classNameCommandActive&&(r=s.config.classNameCommandActive),null!=s.config.classNameActionActive&&(i=s.config.classNameActionActive);for(var f=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),l=f.length,h=0;l>h;h++)new e.toolbar.Speech(this,f[h])},_getLinks:function(t){for(var n,r,i,s,o,u=this[t+"Links"]=e.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),f=u.length,l=0,c=this[t+"Mapping"]={};f>l;l++)n=u[l],i=n.getAttribute("data-wysihtml5-"+t),s=n.getAttribute("data-wysihtml5-"+t+"-value"),r=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+i+"']"),o=this._getDialog(n,i),c[i+":"+s]={link:n,group:r,name:i,value:s,dialog:o,state:!1}},_getDialog:function(t,n){var r,i,s=this,o=this.container.querySelector("[data-wysihtml5-dialog='"+n+"']");return o&&(r=e.toolbar["Dialog_"+n]?new e.toolbar["Dialog_"+n](t,o):new e.toolbar.Dialog(t,o),r.on("show",function(){i=s.composer.selection.getBookmark(),s.editor.fire("show:dialog",{command:n,dialogContainer:o,commandLink:t})}),r.on("save",function(e){i&&s.composer.selection.setBookmark(i),s._execCommand(n,e),s.editor.fire("save:dialog",{command:n,dialogContainer:o,commandLink:t})}),r.on("cancel",function(){s.editor.focus(!1),s.editor.fire("cancel:dialog",{command:n,dialogContainer:o,commandLink:t})})),r},execCommand:function(e,t){if(!this.commandsDisabled){var n=this.commandMapping[e+":"+t];n&&n.dialog&&!n.state?n.dialog.show():this._execCommand(e,t)}},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;"change_view"===e&&t.textarea&&(t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea")),"showSource"==e&&t.fire("showSource")},_observe:function(){for(var e=this,t=this.editor,r=this.container,i=this.commandLinks.concat(this.actionLinks),o=i.length,u=0;o>u;u++)"A"===i[u].nodeName?s.setAttributes({href:"javascript:;",unselectable:"on"}).on(i[u]):s.setAttributes({unselectable:"on"}).on(i[u]);s.delegate(r,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(e){e.preventDefault()}),s.delegate(r,"[data-wysihtml5-command]","click",function(t){var n=this,r=n.getAttribute("data-wysihtml5-command"),i=n.getAttribute("data-wysihtml5-command-value");e.execCommand(r,i),t.preventDefault()}),s.delegate(r,"[data-wysihtml5-action]","click",function(t){var n=this.getAttribute("data-wysihtml5-action");e.execAction(n),t.preventDefault()}),t.on("interaction:composer",function(){e._updateLinkStates()}),t.on("focus:composer",function(){e.bookmark=null}),this.editor.config.handleTables&&(t.on("tableselect:composer",function(){e.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""}),t.on("tableunselect:composer",function(){e.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})),t.on("change_view",function(i){t.textarea&&setTimeout(function(){e.commandsDisabled="composer"!==i,e._updateLinkStates(),e.commandsDisabled?s.addClass(r,n):s.removeClass(r,n)},0)})},_updateLinkStates:function(){var n,o,u,l,c=this.commandMapping,h=this.actionMapping;for(n in c)l=c[n],this.commandsDisabled?(o=!1,s.removeClass(l.link,r),l.group&&s.removeClass(l.group,r),l.dialog&&l.dialog.hide()):(o=this.composer.commands.state(l.name,l.value),s.removeClass(l.link,t),l.group&&s.removeClass(l.group,t)),l.state!==o&&(l.state=o,o?(s.addClass(l.link,r),l.group&&s.addClass(l.group,r),l.dialog&&("object"==typeof o||e.lang.object(o).isArray()?(!l.dialog.multiselect&&e.lang.object(o).isArray()&&(o=1===o.length?o[0]:!0,l.state=o),l.dialog.show(o)):l.dialog.hide())):(s.removeClass(l.link,r),l.group&&s.removeClass(l.group,r),l.dialog&&l.dialog.hide()));for(n in h)u=h[n],"change_view"===u.name&&(u.state=this.editor.currentView===this.editor.textarea,u.state?s.addClass(u.link,i):s.removeClass(u.link,i))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(e){e.toolbar.Dialog_createTable=e.toolbar.Dialog.extend({show:function(e){this.base(e)}})}(wysihtml5),function(e){var t=(e.dom,"[data-wysihtml5-dialog-field]"),n="data-wysihtml5-dialog-field";e.toolbar.Dialog_foreColorStyle=e.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var e={},r=this.container.querySelectorAll(t),i=r.length,s=0;i>s;s++)e[r[s].getAttribute(n)]=r[s].value;return e},_interpolate:function(r){for(var i,s=document.querySelector(":focus"),o=this.container.querySelectorAll(t),u=o.length,f=0,l=this.elementToChange?e.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,h=l?l.getAttribute("style"):null,p=h?e.quirks.styleParser.parseColor(h,"color"):null;u>f;f++)i=o[f],i!==s&&(r&&"hidden"===i.type||"color"===i.getAttribute(n)&&(i.value=p?p[3]&&1!=p[3]?"rgba("+p[0]+","+p[1]+","+p[2]+","+p[3]+");":"rgb("+p[0]+","+p[1]+","+p[2]+");":"rgb(0,0,0);"))}})}(wysihtml5),function(e){e.dom,e.toolbar.Dialog_fontSizeStyle=e.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(){var t=document.querySelector(":focus"),n=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),r=this.elementToChange?e.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,i=r?r.getAttribute("style"):null,s=i?e.quirks.styleParser.parseFontSize(i):null;n&&n!==t&&s&&!/^\s*$/.test(s)&&(n.value=s)}})}(wysihtml5),Handlebars=function(){var e=function(){"use strict";function e(e){this.string=e}var t;return e.prototype.toString=function(){return""+this.string},t=e}(),t=function(e){"use strict";function t(e){return l[e]||"&amp;"}function n(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}function r(e){return e instanceof f?""+e:e||0===e?(e=""+e,h.test(e)?e.replace(c,t):e):""}function i(e){return e||0===e?u(e)&&0===e.length?!0:!1:!0}var s,o,u,a={},f=e,l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},c=/[&<>"'`]/g,h=/[&<>"'`]/;return a.extend=n,s=Object.prototype.toString,a.toString=s,o=function(e){return"function"==typeof e},o(/x/)&&(o=function(e){return"function"==typeof e&&"[object Function]"===s.call(e)}),a.isFunction=o,u=Array.isArray||function(e){return e&&"object"==typeof e?"[object Array]"===s.call(e):!1},a.isArray=u,a.escapeExpression=r,a.isEmpty=i,a}(e),n=function(){"use strict";function e(e,t){var r,i,s;for(t&&t.firstLine&&(r=t.firstLine,e+=" - "+r+":"+t.firstColumn),i=Error.prototype.constructor.call(this,e),s=0;s<n.length;s++)this[n[s]]=i[n[s]];r&&(this.lineNumber=r,this.column=t.firstColumn)}var t,n=["description","fileName","lineNumber","message","name","number","stack"];return e.prototype=Error(),t=e}(),r=function(e,t){"use strict";function n(e,t){this.helpers=e||{},this.partials=t||{},r(this)}function r(e){e.registerHelper("helperMissing",function(e){if(2===arguments.length)return void 0;throw new v("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,n){var r=n.inverse||function(){},i=n.fn;return a(t)&&(t=t.call(this)),t===!0?i(this):t===!1||null==t?r(this):u(t)?t.length>0?e.helpers.each(t,n):r(this):i(t)}),e.registerHelper("each",function(e,t){var n,r,i,s=t.fn,o=t.inverse,f=0,l="";if(a(e)&&(e=e.call(this)),t.data&&(n=h(t.data)),e&&"object"==typeof e)if(u(e))for(r=e.length;r>f;f++)n&&(n.index=f,n.first=0===f,n.last=f===e.length-1),l+=s(e[f],{data:n});else for(i in e)e.hasOwnProperty(i)&&(n&&(n.key=i,n.index=f,n.first=0===f),l+=s(e[i],{data:n}),f++);return 0===f&&(l=o(this)),l}),e.registerHelper("if",function(e,t){return a(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||d.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),e.registerHelper("with",function(e,t){return a(e)&&(e=e.call(this)),d.isEmpty(e)?void 0:t.fn(e)}),e.registerHelper("log",function(t,n){var r=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;e.log(r,t)})}function i(e,t){c.log(e,t)}var s,o,u,a,f,l,c,h,p={},d=e,v=t,m="1.3.0";return p.VERSION=m,s=4,p.COMPILER_REVISION=s,o={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},p.REVISION_CHANGES=o,u=d.isArray,a=d.isFunction,f=d.toString,l="[object Object]",p.HandlebarsEnvironment=n,n.prototype={constructor:n,logger:c,log:i,registerHelper:function(e,t,n){if(f.call(e)===l){if(n||t)throw new v("Arg not supported with multiple helpers");d.extend(this.helpers,e)}else n&&(t.not=n),this.helpers[e]=t},registerPartial:function(e,t){f.call(e)===l?d.extend(this.partials,e):this.partials[e]=t}},c={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(c.level<=e){var n=c.methodMap[e];"undefined"!=typeof console&&console[n]&&console[n].call(console,t)}}},p.logger=c,p.log=i,h=function(e){var t={};return d.extend(t,e),t},p.createFrame=h,p}(t,n),i=function(e,t,n){"use strict";function r(e){var t,n,r=e&&e[0]||1,i=h;if(r!==i)throw i>r?(t=p[i],n=p[r],new c("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+t+") or downgrade your runtime to an older version ("+n+").")):new c("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}function i(e,t){if(!t)throw new c("No environment passed to template");var n=function(e,n,r,i,s,o){var u,a=t.VM.invokePartial.apply(this,arguments);if(null!=a)return a;if(t.compile)return u={helpers:i,partials:s,data:o},s[n]=t.compile(e,{data:void 0!==o},t),s[n](r,u);throw new c("The partial "+n+" could not be compiled when running in runtime-only mode")},r={escapeExpression:l.escapeExpression,invokePartial:n,programs:[],program:function(e,t,n){var r=this.programs[e];return n?r=o(e,t,n):r||(r=this.programs[e]=o(e,t)),r},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n={},l.extend(n,t),l.extend(n,e)),n},programWithDepth:t.VM.programWithDepth,noop:t.VM.noop,compilerInfo:null};return function(n,i){var s,o,u,a;return i=i||{},u=i.partial?i:t,i.partial||(s=i.helpers,o=i.partials),a=e.call(r,u,n,s,o,i.data),i.partial||t.VM.checkRevision(r.compilerInfo),a}}function s(e,t,n){var r=Array.prototype.slice.call(arguments,3),i=function(e,i){return i=i||{},t.apply(this,[e,i.data||n].concat(r))};return i.program=e,i.depth=r.length,i}function o(e,t,n){var r=function(e,r){return r=r||{},t(e,r.data||n)};return r.program=e,r.depth=0,r}function u(e,t,n,r,i,s){var o={partial:!0,helpers:r,partials:i,data:s};if(void 0===e)throw new c("The partial "+t+" could not be found");return e instanceof Function?e(n,o):void 0}function a(){return""}var f={},l=e,c=t,h=n.COMPILER_REVISION,p=n.REVISION_CHANGES;return f.checkRevision=r,f.template=i,f.programWithDepth=s,f.program=o,f.invokePartial=u,f.noop=a,f}(t,n,r),s=function(e,t,n,r,i){"use strict";var s,o=e,u=t,a=n,f=r,l=i,c=function(){var e=new o.HandlebarsEnvironment;return f.extend(e,o),e.SafeString=u,e.Exception=a,e.Utils=f,e.VM=l,e.template=function(t){return l.template(t,e)},e},h=c();return h.create=c,s=h}(r,e,n,t,i);return s}(),this.wysihtml5=this.wysihtml5||{},this.wysihtml5.tpl=this.wysihtml5.tpl||{},this.wysihtml5.tpl.blockquote=Handlebars.template(function(e,t,n,r,i){function s(e){var t,n="";return n+="btn-"+c((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===l?t.apply(e):t)),n}function o(){return' \n      <span class="fa fa-quote-left"></span>\n    '}function u(){return'\n      <span class="glyphicon glyphicon-quote"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,f="",l="function",c=this.escapeExpression,h=this;return f+='<li>\n  <a class="btn ',a=n["if"].call(t,(a=t&&t.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.size),{hash:{},inverse:h.noop,fn:h.program(1,s,i),data:i}),(a||0===a)&&(f+=a),f+=' btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="blockquote" data-wysihtml5-display-format-name="false" tabindex="-1">\n    ',a=n["if"].call(t,(a=t&&t.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.fa),{hash:{},inverse:h.program(5,u,i),fn:h.program(3,o,i),data:i}),(a||0===a)&&(f+=a),f+="\n  </a>\n</li>\n",f}),this.wysihtml5.tpl.color=Handlebars.template(function(e,t,n,r,i){function s(e){var t,n="";return n+="btn-"+f((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===a?t.apply(e):t)),n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var o,u="",a="function",f=this.escapeExpression,l=this;return u+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',o=n["if"].call(t,(o=t&&t.options,o=null==o||o===!1?o:o.toolbar,null==o||o===!1?o:o.size),{hash:{},inverse:l.noop,fn:l.program(1,s,i),data:i}),(o||0===o)&&(u+=o),u+='" data-toggle="dropdown" tabindex="-1">\n    <span class="current-color">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.black,typeof o===a?o.apply(t):o))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="black"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="black">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.black,typeof o===a?o.apply(t):o))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="silver"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="silver">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.silver,typeof o===a?o.apply(t):o))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="gray"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="gray">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.gray,typeof o===a?o.apply(t):o))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="maroon"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="maroon">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.maroon,typeof o===a?o.apply(t):o))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="red"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.red,typeof o===a?o.apply(t):o))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="purple"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.purple,typeof o===a?o.apply(t):o))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="green"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.green,typeof o===a?o.apply(t):o))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="olive"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.olive,typeof o===a?o.apply(t):o))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="navy"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="navy">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.navy,typeof o===a?o.apply(t):o))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="blue"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.blue,typeof o===a?o.apply(t):o))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="orange"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="orange">'+f((o=t&&t.locale,o=null==o||o===!1?o:o.colours,o=null==o||o===!1?o:o.orange,typeof o===a?o.apply(t):o))+"</a></li>\n  </ul>\n</li>\n",u}),this.wysihtml5.tpl.emphasis=Handlebars.template(function(e,t,n,r,i){function s(e){var t,n="";return n+="btn-"+l((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===f?t.apply(e):t)),n}function o(e,t){var r,i="";return i+='\n    <a class="btn ',r=n["if"].call(e,(r=e&&e.options,r=null==r||r===!1?r:r.toolbar,null==r||r===!1?r:r.size),{hash:{},inverse:c.noop,fn:c.program(1,s,t),data:t}),(r||0===r)&&(i+=r),i+=' btn-default" data-wysihtml5-command="small" title="CTRL+S" tabindex="-1">'+l((r=e&&e.locale,r=null==r||r===!1?r:r.emphasis,r=null==r||r===!1?r:r.small,typeof r===f?r.apply(e):r))+"</a>\n    ",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var u,a="",f="function",l=this.escapeExpression,c=this;return a+='<li>\n  <div class="btn-group">\n    <a class="btn ',u=n["if"].call(t,(u=t&&t.options,u=null==u||u===!1?u:u.toolbar,null==u||u===!1?u:u.size),{hash:{},inverse:c.noop,fn:c.program(1,s,i),data:i}),(u||0===u)&&(a+=u),a+=' btn-default" data-wysihtml5-command="bold" title="CTRL+B" tabindex="-1">'+l((u=t&&t.locale,u=null==u||u===!1?u:u.emphasis,u=null==u||u===!1?u:u.bold,typeof u===f?u.apply(t):u))+'</a>\n    <a class="btn ',u=n["if"].call(t,(u=t&&t.options,u=null==u||u===!1?u:u.toolbar,null==u||u===!1?u:u.size),{hash:{},inverse:c.noop,fn:c.program(1,s,i),data:i}),(u||0===u)&&(a+=u),a+=' btn-default" data-wysihtml5-command="italic" title="CTRL+I" tabindex="-1">'+l((u=t&&t.locale,u=null==u||u===!1?u:u.emphasis,u=null==u||u===!1?u:u.italic,typeof u===f?u.apply(t):u))+'</a>\n    <a class="btn ',u=n["if"].call(t,(u=t&&t.options,u=null==u||u===!1?u:u.toolbar,null==u||u===!1?u:u.size),{hash:{},inverse:c.noop,fn:c.program(1,s,i),data:i}),(u||0===u)&&(a+=u),a+=' btn-default" data-wysihtml5-command="underline" title="CTRL+U" tabindex="-1">'+l((u=t&&t.locale,u=null==u||u===!1?u:u.emphasis,u=null==u||u===!1?u:u.underline,typeof u===f?u.apply(t):u))+"</a>\n    ",u=n["if"].call(t,(u=t&&t.options,u=null==u||u===!1?u:u.toolbar,u=null==u||u===!1?u:u.emphasis,null==u||u===!1?u:u.small),{hash:{},inverse:c.noop,fn:c.program(3,o,i),data:i}),(u||0===u)&&(a+=u),a+="\n  </div>\n</li>\n",a}),this.wysihtml5.tpl["font-styles"]=Handlebars.template(function(e,t,n,r,i){function s(e){var t,n="";return n+="btn-"+c((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===l?t.apply(e):t)),n}function o(){return'\n      <span class="fa fa-font"></span>\n    '}function u(){return'\n      <span class="glyphicon glyphicon-font"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,f="",l="function",c=this.escapeExpression,h=this;return f+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',a=n["if"].call(t,(a=t&&t.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.size),{hash:{},inverse:h.noop,fn:h.program(1,s,i),data:i}),(a||0===a)&&(f+=a),f+='" data-toggle="dropdown">\n    ',a=n["if"].call(t,(a=t&&t.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.fa),{hash:{},inverse:h.program(5,u,i),fn:h.program(3,o,i),data:i}),(a||0===a)&&(f+=a),f+='\n    <span class="current-font">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.normal,typeof a===l?a.apply(t):a))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" tabindex="-1">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.normal,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" tabindex="-1">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h1,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" tabindex="-1">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h2,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" tabindex="-1">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h3,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h4" tabindex="-1">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h4,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h5" tabindex="-1">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h5,typeof a===l?a.apply(t):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h6" tabindex="-1">'+c((a=t&&t.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h6,typeof a===l?a.apply(t):a))+"</a></li>\n  </ul>\n</li>\n",f}),this.wysihtml5.tpl.html=Handlebars.template(function(e,t,n,r,i){function s(e){var t,n="";return n+="btn-"+c((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===l?t.apply(e):t)),n}function o(){return'\n        <span class="fa fa-pencil"></span>\n      '}function u(){return'\n        <span class="glyphicon glyphicon-pencil"></span>\n      '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var a,f="",l="function",c=this.escapeExpression,h=this;return f+='<li>\n  <div class="btn-group">\n    <a class="btn ',a=n["if"].call(t,(a=t&&t.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.size),{hash:{},inverse:h.noop,fn:h.program(1,s,i),data:i}),(a||0===a)&&(f+=a),f+=' btn-default" data-wysihtml5-action="change_view" title="'+c((a=t&&t.locale,a=null==a||a===!1?a:a.html,a=null==a||a===!1?a:a.edit,typeof a===l?a.apply(t):a))+'" tabindex="-1">\n      ',a=n["if"].call(t,(a=t&&t.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.fa),{hash:{},inverse:h.program(5,u,i),fn:h.program(3,o,i),data:i}),(a||0===a)&&(f+=a),f+="\n    </a>\n  </div>\n</li>\n",f}),this.wysihtml5.tpl.image=Handlebars.template(function(e,t,n,r,i){function s(){return"modal-sm"}function o(e){var t,n="";return n+="btn-"+h((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===c?t.apply(e):t)),n}function u(){return'\n      <span class="fa fa-file-image-o"></span>\n    '}function a(){return'\n      <span class="glyphicon glyphicon-picture"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var f,l="",c="function",h=this.escapeExpression,p=this;return l+='<li>\n  <div class="bootstrap-wysihtml5-insert-image-modal modal fade" data-wysihtml5-dialog="insertImage">\n    <div class="modal-dialog ',f=n["if"].call(t,(f=t&&t.options,f=null==f||f===!1?f:f.toolbar,null==f||f===!1?f:f.smallmodals),{hash:{},inverse:p.noop,fn:p.program(1,s,i),data:i}),(f||0===f)&&(l+=f),l+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+h((f=t&&t.locale,f=null==f||f===!1?f:f.image,f=null==f||f===!1?f:f.insert,typeof f===c?f.apply(t):f))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-image-url form-control" data-wysihtml5-dialog-field="src">\n          </div> \n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+h((f=t&&t.locale,f=null==f||f===!1?f:f.image,f=null==f||f===!1?f:f.cancel,typeof f===c?f.apply(t):f))+'</a>\n          <a class="btn btn-primary" data-dismiss="modal"  data-wysihtml5-dialog-action="save" href="#">'+h((f=t&&t.locale,f=null==f||f===!1?f:f.image,f=null==f||f===!1?f:f.insert,typeof f===c?f.apply(t):f))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',f=n["if"].call(t,(f=t&&t.options,f=null==f||f===!1?f:f.toolbar,null==f||f===!1?f:f.size),{hash:{},inverse:p.noop,fn:p.program(3,o,i),data:i}),(f||0===f)&&(l+=f),l+=' btn-default" data-wysihtml5-command="insertImage" title="'+h((f=t&&t.locale,f=null==f||f===!1?f:f.image,f=null==f||f===!1?f:f.insert,typeof f===c?f.apply(t):f))+'" tabindex="-1">\n    ',f=n["if"].call(t,(f=t&&t.options,f=null==f||f===!1?f:f.toolbar,null==f||f===!1?f:f.fa),{hash:{},inverse:p.program(7,a,i),fn:p.program(5,u,i),data:i}),(f||0===f)&&(l+=f),l+="\n  </a>\n</li>\n",l}),this.wysihtml5.tpl.link=Handlebars.template(function(e,t,n,r,i){function s(){return"modal-sm"}function o(e){var t,n="";return n+="btn-"+h((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===c?t.apply(e):t)),n}function u(){return'\n      <span class="fa fa-share-square-o"></span>\n    '}function a(){return'\n      <span class="glyphicon glyphicon-share"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var f,l="",c="function",h=this.escapeExpression,p=this;return l+='<li>\n  <div class="bootstrap-wysihtml5-insert-link-modal modal fade" data-wysihtml5-dialog="createLink">\n    <div class="modal-dialog ',f=n["if"].call(t,(f=t&&t.options,f=null==f||f===!1?f:f.toolbar,null==f||f===!1?f:f.smallmodals),{hash:{},inverse:p.noop,fn:p.program(1,s,i),data:i}),(f||0===f)&&(l+=f),l+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+h((f=t&&t.locale,f=null==f||f===!1?f:f.link,f=null==f||f===!1?f:f.insert,typeof f===c?f.apply(t):f))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-link-url form-control" data-wysihtml5-dialog-field="href">\n          </div> \n          <div class="checkbox">\n            <label> \n              <input type="checkbox" class="bootstrap-wysihtml5-insert-link-target" checked>'+h((f=t&&t.locale,f=null==f||f===!1?f:f.link,f=null==f||f===!1?f:f.target,typeof f===c?f.apply(t):f))+'\n            </label>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+h((f=t&&t.locale,f=null==f||f===!1?f:f.link,f=null==f||f===!1?f:f.cancel,typeof f===c?f.apply(t):f))+'</a>\n          <a href="#" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save">'+h((f=t&&t.locale,f=null==f||f===!1?f:f.link,f=null==f||f===!1?f:f.insert,typeof f===c?f.apply(t):f))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',f=n["if"].call(t,(f=t&&t.options,f=null==f||f===!1?f:f.toolbar,null==f||f===!1?f:f.size),{hash:{},inverse:p.noop,fn:p.program(3,o,i),data:i}),(f||0===f)&&(l+=f),l+=' btn-default" data-wysihtml5-command="createLink" title="'+h((f=t&&t.locale,f=null==f||f===!1?f:f.link,f=null==f||f===!1?f:f.insert,typeof f===c?f.apply(t):f))+'" tabindex="-1">\n    ',f=n["if"].call(t,(f=t&&t.options,f=null==f||f===!1?f:f.toolbar,null==f||f===!1?f:f.fa),{hash:{},inverse:p.program(7,a,i),fn:p.program(5,u,i),data:i}),(f||0===f)&&(l+=f),l+="\n  </a>\n</li>\n",l}),this.wysihtml5.tpl.lists=Handlebars.template(function(e,t,n,r,i){function s(e){var t,n="";return n+="btn-"+g((t=e&&e.options,t=null==t||t===!1?t:t.toolbar,t=null==t||t===!1?t:t.size,typeof t===m?t.apply(e):t)),n}function o(){return'\n      <span class="fa fa-list-ul"></span>\n    '}function u(){return'\n      <span class="glyphicon glyphicon-list"></span>\n    '}function a(){return'\n      <span class="fa fa-list-ol"></span>\n    '}function f(){return'\n      <span class="glyphicon glyphicon-th-list"></span>\n    '}function l(){return'\n      <span class="fa fa-outdent"></span>\n    '}function c(){return'\n      <span class="glyphicon glyphicon-indent-right"></span>\n    '}function h(){return'\n      <span class="fa fa-indent"></span>\n    '}function p(){return'\n      <span class="glyphicon glyphicon-indent-left"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var d,v="",m="function",g=this.escapeExpression,y=this;return v+='<li>\n  <div class="btn-group">\n    <a class="btn ',d=n["if"].call(t,(d=t&&t.options,d=null==d||d===!1?d:d.toolbar,null==d||d===!1?d:d.size),{hash:{},inverse:y.noop,fn:y.program(1,s,i),data:i}),(d||0===d)&&(v+=d),v+=' btn-default" data-wysihtml5-command="insertUnorderedList" title="'+g((d=t&&t.locale,d=null==d||d===!1?d:d.lists,d=null==d||d===!1?d:d.unordered,typeof d===m?d.apply(t):d))+'" tabindex="-1">\n    ',d=n["if"].call(t,(d=t&&t.options,d=null==d||d===!1?d:d.toolbar,null==d||d===!1?d:d.fa),{hash:{},inverse:y.program(5,u,i),fn:y.program(3,o,i),data:i}),(d||0===d)&&(v+=d),v+='\n    </a>\n    <a class="btn ',d=n["if"].call(t,(d=t&&t.options,d=null==d||d===!1?d:d.toolbar,null==d||d===!1?d:d.size),{hash:{},inverse:y.noop,fn:y.program(1,s,i),data:i}),(d||0===d)&&(v+=d),v+=' btn-default" data-wysihtml5-command="insertOrderedList" title="'+g((d=t&&t.locale,d=null==d||d===!1?d:d.lists,d=null==d||d===!1?d:d.ordered,typeof d===m?d.apply(t):d))+'" tabindex="-1">\n    ',d=n["if"].call(t,(d=t&&t.options,d=null==d||d===!1?d:d.toolbar,null==d||d===!1?d:d.fa),{hash:{},inverse:y.program(9,f,i),fn:y.program(7,a,i),data:i}),(d||0===d)&&(v+=d),v+='\n    </a>\n    <a class="btn ',d=n["if"].call(t,(d=t&&t.options,d=null==d||d===!1?d:d.toolbar,null==d||d===!1?d:d.size),{hash:{},inverse:y.noop,fn:y.program(1,s,i),data:i}),(d||0===d)&&(v+=d),v+=' btn-default" data-wysihtml5-command="Outdent" title="'+g((d=t&&t.locale,d=null==d||d===!1?d:d.lists,d=null==d||d===!1?d:d.outdent,typeof d===m?d.apply(t):d))+'" tabindex="-1">\n    ',d=n["if"].call(t,(d=t&&t.options,d=null==d||d===!1?d:d.toolbar,null==d||d===!1?d:d.fa),{hash:{},inverse:y.program(13,c,i),fn:y.program(11,l,i),data:i}),(d||0===d)&&(v+=d),v+='\n    </a>\n    <a class="btn ',d=n["if"].call(t,(d=t&&t.options,d=null==d||d===!1?d:d.toolbar,null==d||d===!1?d:d.size),{hash:{},inverse:y.noop,fn:y.program(1,s,i),data:i}),(d||0===d)&&(v+=d),v+=' btn-default" data-wysihtml5-command="Indent" title="'+g((d=t&&t.locale,d=null==d||d===!1?d:d.lists,d=null==d||d===!1?d:d.indent,typeof d===m?d.apply(t):d))+'" tabindex="-1">\n    ',d=n["if"].call(t,(d=t&&t.options,d=null==d||d===!1?d:d.toolbar,null==d||d===!1?d:d.fa),{hash:{},inverse:y.program(17,p,i),fn:y.program(15,h,i),data:i}),(d||0===d)&&(v+=d),v+="\n    </a>\n  </div>\n</li>\n",v}),function(e){"use strict";"function"==typeof define&&define.amd?define("bootstrap.wysihtml5",["jquery","wysihtml5","bootstrap","bootstrap.wysihtml5.templates","bootstrap.wysihtml5.commands"],e):e(jQuery,wysihtml5)}(function(e,t){"use strict";var n=function(e,t){var n,r,i,s=function(e,n,r){return t.tpl[e]?t.tpl[e]({locale:n,options:r}):void 0},o=function(n,i){var s,o;this.el=n,s=e.extend(!0,{},r,i);for(o in s.customTemplates)s.customTemplates.hasOwnProperty(o)&&(t.tpl[o]=s.customTemplates[o]);this.toolbar=this.createToolbar(n,s),this.editor=this.createEditor(s)};o.prototype={constructor:o,createEditor:function(t){t=t||{},t=e.extend(!0,{},t),t.toolbar=this.toolbar[0],this.initializeEditor(this.el[0],t)},initializeEditor:function(e,n){var r,i=new t.Editor(this.el[0],n);if(i.on("beforeload",this.syncBootstrapDialogEvents),i.on("beforeload",this.loadParserRules),i.composer.editableArea.contentDocument?this.addMoreShortcuts(i,i.composer.editableArea.contentDocument.body||i.composer.editableArea.contentDocument,n.shortcuts):this.addMoreShortcuts(i,i.composer.editableArea,n.shortcuts),n&&n.events)for(r in n.events)n.events.hasOwnProperty(r)&&i.on(r,n.events[r]);return i},loadParserRules:function(){"string"===e.type(this.config.parserRules)&&e.ajax({dataType:"json",url:this.config.parserRules,context:this,error:function(e,t,n){void 0},success:function(e){this.config.parserRules=e,void 0}}),this.config.pasteParserRulesets&&"string"===e.type(this.config.pasteParserRulesets)&&e.ajax({dataType:"json",url:this.config.pasteParserRulesets,context:this,error:function(e,t,n){void 0},success:function(e){this.config.pasteParserRulesets=e}})},syncBootstrapDialogEvents:function(){var t=this;e.map(this.toolbar.commandMapping,function(e){return[e]}).filter(function(e){return e.dialog}).map(function(e){return e.dialog}).forEach(function(n){n.on("show",function(){e(this.container).modal("show")}),n.on("hide",function(){e(this.container).modal("hide"),setTimeout(t.composer.focus,0)}),e(n.container).on("shown.bs.modal",function(){e(this).find("input, select, textarea").first().focus()})}),this.on("change_view",function(){e(this.toolbar.container.children).find("a.btn").not('[data-wysihtml5-action="change_view"]').toggleClass("disabled")})},createToolbar:function(t,n){var o,u,l=this,c=e("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"}),h=n.locale||r.locale||"en";i.hasOwnProperty(h)||(void 0,h="en"),o=e.extend(!0,{},i.en,i[h]);for(u in n.toolbar)n.toolbar[u]&&c.append(s(u,o,n));return c.find('a[data-wysihtml5-command="formatBlock"]').click(function(t){var n=t.delegateTarget||t.target||t.srcElement,r=e(n),i=r.data("wysihtml5-display-format-name"),s=r.data("wysihtml5-format-name")||r.html();(void 0===i||"true"===i)&&l.toolbar.find(".current-font").text(s)}),c.find('a[data-wysihtml5-command="foreColor"]').click(function(t){var n=t.target||t.srcElement,r=e(n);l.toolbar.find(".current-color").text(r.html())}),this.el.before(c),c},addMoreShortcuts:function(e,n,r){t.dom.observe(n,"keydown",function(n){var i,s=n.keyCode,o=r[s];(n.ctrlKey||n.metaKey||n.altKey)&&o&&t.commands[o]&&(i=e.toolbar.commandMapping[o+":null"],i&&i.dialog&&!i.state?i.dialog.show():t.commands[o].exec(e.composer,o),n.preventDefault())})}},n={resetDefaults:function(){e.fn.wysihtml5.defaultOptions=e.extend(!0,{},e.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(t){return this.each(function(){var n=e(this);n.data("wysihtml5",new o(n,t))})},shallowExtend:function(t){var r=e.extend({},e.fn.wysihtml5.defaultOptions,t||{},e(this).data()),i=this;return n.bypassDefaults.apply(i,[r])},deepExtend:function(t){var r=e.extend(!0,{},e.fn.wysihtml5.defaultOptions,t||{}),i=this;return n.bypassDefaults.apply(i,[r])},init:function(e){var t=this;return n.shallowExtend.apply(t,[e])}},e.fn.wysihtml5=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(e.error("Method "+t+" does not exist on jQuery.wysihtml5"),void 0):n.init.apply(this,arguments)},e.fn.wysihtml5.Constructor=o,r=e.fn.wysihtml5.defaultOptions={toolbar:{"font-styles":!0,color:!1,emphasis:{small:!0},blockquote:!0,lists:!0,html:!1,link:!0,image:!0,smallmodals:!1},useLineBreaks:!1,parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},strong:{},em:{},p:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url"},set_attributes:{target:"_blank",rel:"nofollow"}},span:1,div:1,small:1,code:1,pre:1}},locale:"en",shortcuts:{83:"small",75:"createLink"}},void 0===e.fn.wysihtml5.defaultOptionsCache&&(e.fn.wysihtml5.defaultOptionsCache=e.extend(!0,{},e.fn.wysihtml5.defaultOptions)),i=e.fn.wysihtml5.locale={}};n(e,t)}),function(e){e.commands.small={exec:function(t,n){return e.commands.formatInline.exec(t,n,"small")},state:function(t,n){return e.commands.formatInline.state(t,n,"small")}}}(wysihtml5),function(e){"function"==typeof define&&define.amd?define("bootstrap.wysihtml5.en-US",["jquery","bootstrap.wysihtml5"],e):e(jQuery)}(function(e){e.fn.wysihtml5.locale.en=e.fn.wysihtml5.locale["en-US"]={font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline",small:"Small"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},html:{edit:"Edit HTML"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}});